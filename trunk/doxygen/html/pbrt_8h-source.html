<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>pbrt: pbrt.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>pbrt.h</h1><a href="pbrt_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment">    pbrt source code Copyright(c) 1998-2007 Matt Pharr and Greg Humphreys.</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">    This file is part of pbrt.</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">    pbrt is free software; you can redistribute it and/or modify</span>
<a name="l00008"></a>00008 <span class="comment">    it under the terms of the GNU General Public License as published by</span>
<a name="l00009"></a>00009 <span class="comment">    the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00010"></a>00010 <span class="comment">    (at your option) any later version.  Note that the text contents of</span>
<a name="l00011"></a>00011 <span class="comment">    the book "Physically Based Rendering" are *not* licensed under the</span>
<a name="l00012"></a>00012 <span class="comment">    GNU GPL.</span>
<a name="l00013"></a>00013 <span class="comment"></span>
<a name="l00014"></a>00014 <span class="comment">    pbrt is distributed in the hope that it will be useful,</span>
<a name="l00015"></a>00015 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00017"></a>00017 <span class="comment">    GNU General Public License for more details.</span>
<a name="l00018"></a>00018 <span class="comment"></span>
<a name="l00019"></a>00019 <span class="comment">    You should have received a copy of the GNU General Public License</span>
<a name="l00020"></a>00020 <span class="comment">    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00021"></a>00021 <span class="comment"></span>
<a name="l00022"></a>00022 <span class="comment"> */</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#ifndef PBRT_PBRT_H</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span><span class="preprocessor">#define PBRT_PBRT_H</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span><span class="comment">// pbrt.h*</span>
<a name="l00027"></a>00027 <span class="comment">// Global Include Files</span>
<a name="l00028"></a>00028 <span class="preprocessor">#if !defined(__APPLE__) &amp;&amp; !defined(__OpenBSD__)</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">#include &lt;malloc.h&gt;</span> <span class="comment">// for _alloca, memalign</span>
<a name="l00030"></a>00030 <span class="preprocessor">#endif</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span><span class="preprocessor">#if !defined(WIN32) &amp;&amp; !defined(__APPLE__) &amp;&amp; !defined(__OpenBSD__)</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span><span class="preprocessor">#include &lt;alloca.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#endif</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#ifdef __linux__</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">#include &lt;fpu_control.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#endif</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#ifdef WIN32</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#include &lt;float.h&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#endif</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span><span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#define _GNU_SOURCE 1 //NOBOOK</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00046"></a>00046 <span class="keyword">using</span> std::string;
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00048"></a>00048 <span class="keyword">using</span> std::vector;
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00050"></a>00050 <span class="keyword">using</span> std::ostream;
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00052"></a>00052 <span class="keyword">using</span> std::min;
<a name="l00053"></a>00053 <span class="keyword">using</span> std::max;
<a name="l00054"></a>00054 <span class="keyword">using</span> std::swap;
<a name="l00055"></a>00055 <span class="keyword">using</span> std::sort;
<a name="l00056"></a>00056 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span><span class="preprocessor">#define WIN32_LEAN_AND_MEAN</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span><span class="preprocessor">#include &lt;windows.h&gt;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#endif</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span><span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00061"></a>00061 <span class="comment">// Platform-specific definitions</span>
<a name="l00062"></a>00062 <span class="preprocessor">#if defined(WIN32)</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span><span class="preprocessor">#define memalign(a,b) _aligned_malloc(b, a)</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span><span class="preprocessor">#elif defined(__APPLE__)</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span><span class="preprocessor">#define memalign(a,b) valloc(b)</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span><span class="preprocessor">#elif defined(__OpenBSD__)</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor">#define memalign(a,b) malloc(b)</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span><span class="preprocessor">#ifdef sgi</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><span class="preprocessor">#define for if (0) ; else for</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="preprocessor">#ifdef __APPLE__</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span><span class="preprocessor">#define powf pow</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span><span class="preprocessor">#define sinf sin</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span><span class="preprocessor">#define cosf cos</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span><span class="preprocessor">#define tanf tan</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span><span class="preprocessor">#define asinf asin</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span><span class="preprocessor">#define acosf acos</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span><span class="preprocessor">#define atanf atan</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span><span class="preprocessor">#define atan2f atan2</span>
<a name="l00081"></a>00081 <span class="preprocessor"></span><span class="preprocessor">#define logf log</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span><span class="preprocessor">#define log10f log10</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span><span class="preprocessor">#define expf exp</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span><span class="preprocessor">#define sqrtf sqrt</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span><span class="preprocessor">#if __GNUC__ == 3</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
<a name="l00087"></a>00087   <span class="keywordtype">int</span> isinf(<span class="keywordtype">double</span>);
<a name="l00088"></a>00088   <span class="keywordtype">int</span> isnan(<span class="keywordtype">double</span>);
<a name="l00089"></a>00089 }
<a name="l00090"></a>00090 <span class="preprocessor">#endif // ONLY GCC 3</span>
<a name="l00091"></a>00091 <span class="preprocessor"></span><span class="preprocessor">#endif // __APPLE__</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>
<a name="l00093"></a>00093 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span><span class="preprocessor">#pragma warning (disable: 4267 4251 4065 4102)</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span><span class="preprocessor">#endif // WIN32</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span><span class="preprocessor">#ifdef WIN32</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span><span class="preprocessor">#pragma warning( disable: 4190 )</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span><span class="comment">// extern "C" nonsense when returning a template</span>
<a name="l00099"></a>00099 <span class="preprocessor">#endif</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span><span class="preprocessor">#ifdef WIN32</span>
<a name="l00101"></a>00101 <span class="preprocessor"></span><span class="preprocessor">#ifdef CORE_SOURCE</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span><span class="preprocessor">#define COREDLL __declspec(dllexport)</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00104"></a>00104 <span class="preprocessor"></span><span class="preprocessor">#define COREDLL __declspec(dllimport)</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span><span class="preprocessor">#define DLLEXPORT __declspec(dllexport)</span>
<a name="l00107"></a>00107 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00108"></a>00108 <span class="preprocessor"></span><span class="preprocessor">#define COREDLL</span>
<a name="l00109"></a>00109 <span class="preprocessor"></span><span class="preprocessor">#define DLLEXPORT</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span><span class="preprocessor">#ifdef WIN32</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span><span class="preprocessor">#define PBRT_PATH_SEP ";"</span>
<a name="l00113"></a>00113 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span><span class="preprocessor">#define PBRT_PATH_SEP ":"</span>
<a name="l00115"></a>00115 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span><span class="preprocessor">#ifdef WIN32</span>
<a name="l00117"></a>00117 <span class="preprocessor"></span><span class="preprocessor">#define isnan _isnan</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span><span class="preprocessor">#define isinf(f) (!_finite((f)))</span>
<a name="l00119"></a>00119 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00120"></a>00120 <span class="preprocessor"></span><span class="comment">// Global Type Declarations</span>
<a name="l00121"></a><a class="code" href="pbrt_8h.html#8c1c8901a052f5b154294299c55e52a6">00121</a> <span class="keyword">typedef</span> <span class="keywordtype">double</span> <a class="code" href="pbrt_8h.html#8c1c8901a052f5b154294299c55e52a6">StatsCounterType</a>;
<a name="l00122"></a><a class="code" href="pbrt_8h.html#e2b02ed168fc99cff3851603910b1fb6">00122</a> <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="pbrt_8h.html#e2b02ed168fc99cff3851603910b1fb6">u_char</a>;
<a name="l00123"></a><a class="code" href="pbrt_8h.html#a1a19deefc008737e6397f44d983cfd4">00123</a> <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="pbrt_8h.html#a1a19deefc008737e6397f44d983cfd4">u_short</a>;
<a name="l00124"></a><a class="code" href="pbrt_8h.html#c319c165d52643e43249fe003e18bdf3">00124</a> <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="pbrt_8h.html#c319c165d52643e43249fe003e18bdf3">u_int</a>;
<a name="l00125"></a><a class="code" href="pbrt_8h.html#8f25a50daf29ce2cee1ec038a4d744ea">00125</a> <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="pbrt_8h.html#8f25a50daf29ce2cee1ec038a4d744ea">u_long</a>;
<a name="l00126"></a>00126 <span class="comment">// Global Forward Declarations</span>
<a name="l00127"></a>00127 <span class="keyword">class </span><a class="code" href="classTimer.html">Timer</a>;
<a name="l00128"></a>00128 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T, <span class="keywordtype">int</span> logBlockSize = 2&gt; <span class="keyword">class </span><a class="code" href="classBlockedArray.html">BlockedArray</a>;
<a name="l00129"></a>00129 <span class="keyword">struct </span><a class="code" href="structMatrix4x4.html">Matrix4x4</a>;
<a name="l00130"></a>00130 <span class="keyword">class </span><a class="code" href="classParamSet.html">ParamSet</a>;
<a name="l00131"></a>00131 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">struct </span><a class="code" href="structParamSetItem.html">ParamSetItem</a>;
<a name="l00132"></a>00132 <span class="keyword">class </span><a class="code" href="classTextureParams.html">TextureParams</a>;
<a name="l00133"></a>00133 <span class="keyword">class </span><a class="code" href="classShape.html">Shape</a>;
<a name="l00134"></a>00134 <span class="keyword">class </span><a class="code" href="classScene.html">Scene</a>;
<a name="l00135"></a>00135 <span class="keyword">class </span><a class="code" href="classVector.html">Vector</a>;
<a name="l00136"></a>00136 <span class="keyword">class </span><a class="code" href="classPoint.html">Point</a>;
<a name="l00137"></a>00137 <span class="keyword">class </span><a class="code" href="classNormal.html">Normal</a>;
<a name="l00138"></a>00138 <span class="keyword">class </span><a class="code" href="classRay.html">Ray</a>;
<a name="l00139"></a>00139 <span class="keyword">class </span><a class="code" href="classRayDifferential.html">RayDifferential</a>;
<a name="l00140"></a>00140 <span class="keyword">class </span><a class="code" href="classBBox.html">BBox</a>;
<a name="l00141"></a>00141 <span class="keyword">class </span><a class="code" href="classTransform.html">Transform</a>;
<a name="l00142"></a>00142 <span class="keyword">struct </span><a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a>;
<a name="l00143"></a>00143 <span class="keyword">class </span><a class="code" href="classPrimitive.html">Primitive</a>;
<a name="l00144"></a>00144 <span class="keyword">struct </span><a class="code" href="structIntersection.html">Intersection</a>;
<a name="l00145"></a>00145 <span class="keyword">class </span><a class="code" href="classGeometricPrimitive.html">GeometricPrimitive</a>;
<a name="l00146"></a>00146 <span class="keyword">class </span><a class="code" href="classSpectrum.html">Spectrum</a>;
<a name="l00147"></a>00147 <span class="keyword">class </span><a class="code" href="classCamera.html">Camera</a>;
<a name="l00148"></a>00148 <span class="keyword">class </span><a class="code" href="classProjectiveCamera.html">ProjectiveCamera</a>;
<a name="l00149"></a>00149 <span class="keyword">class </span><a class="code" href="classSampler.html">Sampler</a>;
<a name="l00150"></a>00150 <span class="keyword">struct </span><a class="code" href="structSample.html">Sample</a>;
<a name="l00151"></a>00151 <span class="preprocessor">#define BC_GRID_SIZE 40</span>
<a name="l00152"></a><a class="code" href="pbrt_8h.html#5cef4d1087ceba7dd14341c40aa55608">00152</a> <span class="preprocessor"></span><span class="keyword">typedef</span> vector&lt;int&gt; <a class="code" href="pbrt_8h.html#5cef4d1087ceba7dd14341c40aa55608">SampleGrid</a>[<a class="code" href="pbrt_8h.html#4aa0727877198ee6610de47c2166da09">BC_GRID_SIZE</a>][<a class="code" href="pbrt_8h.html#4aa0727877198ee6610de47c2166da09">BC_GRID_SIZE</a>];
<a name="l00153"></a>00153 <span class="preprocessor">#define GRID(v) (int((v) * BC_GRID_SIZE))</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span><span class="keyword">class </span><a class="code" href="classFilter.html">Filter</a>;
<a name="l00155"></a>00155 <span class="keyword">class </span><a class="code" href="classFilm.html">Film</a>;
<a name="l00156"></a>00156 <span class="keyword">class </span><a class="code" href="classToneMap.html">ToneMap</a>;
<a name="l00157"></a>00157 <span class="keyword">class </span><a class="code" href="classBxDF.html">BxDF</a>;
<a name="l00158"></a>00158 <span class="keyword">class </span>BRDF;
<a name="l00159"></a>00159 <span class="keyword">class </span>BTDF;
<a name="l00160"></a>00160 <span class="keyword">class </span><a class="code" href="classFresnel.html">Fresnel</a>;
<a name="l00161"></a>00161 <span class="keyword">class </span><a class="code" href="classFresnelConductor.html">FresnelConductor</a>;
<a name="l00162"></a>00162 <span class="keyword">class </span><a class="code" href="classFresnelDielectric.html">FresnelDielectric</a>;
<a name="l00163"></a>00163 <span class="keyword">class </span><a class="code" href="classFresnelNoOp.html">FresnelNoOp</a>;
<a name="l00164"></a>00164 <span class="keyword">class </span><a class="code" href="classSpecularReflection.html">SpecularReflection</a>;
<a name="l00165"></a>00165 <span class="keyword">class </span><a class="code" href="classSpecularTransmission.html">SpecularTransmission</a>;
<a name="l00166"></a>00166 <span class="keyword">class </span><a class="code" href="classLambertian.html">Lambertian</a>;
<a name="l00167"></a>00167 <span class="keyword">class </span><a class="code" href="classOrenNayar.html">OrenNayar</a>;
<a name="l00168"></a>00168 <span class="keyword">class </span><a class="code" href="classMicrofacet.html">Microfacet</a>;
<a name="l00169"></a>00169 <span class="keyword">class </span><a class="code" href="classMicrofacetDistribution.html">MicrofacetDistribution</a>;
<a name="l00170"></a>00170 <span class="keyword">class </span><a class="code" href="classBSDF.html">BSDF</a>;
<a name="l00171"></a>00171 <span class="keyword">class </span><a class="code" href="classMaterial.html">Material</a>;
<a name="l00172"></a>00172 <span class="keyword">class </span><a class="code" href="classTextureMapping2D.html">TextureMapping2D</a>;
<a name="l00173"></a>00173 <span class="keyword">class </span><a class="code" href="classUVMapping2D.html">UVMapping2D</a>;
<a name="l00174"></a>00174 <span class="keyword">class </span><a class="code" href="classSphericalMapping2D.html">SphericalMapping2D</a>;
<a name="l00175"></a>00175 <span class="keyword">class </span><a class="code" href="classCylindricalMapping2D.html">CylindricalMapping2D</a>;
<a name="l00176"></a>00176 <span class="keyword">class </span><a class="code" href="classPlanarMapping2D.html">PlanarMapping2D</a>;
<a name="l00177"></a>00177 <span class="keyword">class </span><a class="code" href="classTextureMapping3D.html">TextureMapping3D</a>;
<a name="l00178"></a>00178 <span class="keyword">class </span><a class="code" href="classIdentityMapping3D.html">IdentityMapping3D</a>;
<a name="l00179"></a>00179 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">class </span><a class="code" href="classTexture.html">Texture</a>;
<a name="l00180"></a>00180 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#0771f1e4704c254202d0ceeb48a7a003">Noise</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y = .5f, <span class="keywordtype">float</span> z = .5f);
<a name="l00181"></a>00181 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#0771f1e4704c254202d0ceeb48a7a003">Noise</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a> &amp;P);
<a name="l00182"></a>00182 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#0f06337c23a253f6f36dac935151a9d8">FBm</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a> &amp;P, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;dpdx, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;dpdy,
<a name="l00183"></a>00183         <span class="keywordtype">float</span> omega, <span class="keywordtype">int</span> octaves);
<a name="l00184"></a>00184 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#93b43e3085d81cd42b8f75634244c929">Turbulence</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a> &amp;P, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;dpdx, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;dpdy,
<a name="l00185"></a>00185         <span class="keywordtype">float</span> omega, <span class="keywordtype">int</span> octaves);
<a name="l00186"></a>00186 <span class="keyword">class </span><a class="code" href="classVolumeRegion.html">VolumeRegion</a>;
<a name="l00187"></a>00187 <span class="keyword">class </span><a class="code" href="classLight.html">Light</a>;
<a name="l00188"></a>00188 <span class="keyword">struct </span><a class="code" href="structVisibilityTester.html">VisibilityTester</a>;
<a name="l00189"></a>00189 <span class="keyword">class </span><a class="code" href="classAreaLight.html">AreaLight</a>;
<a name="l00190"></a>00190 <span class="keyword">class </span><a class="code" href="classShapeSet.html">ShapeSet</a>;
<a name="l00191"></a>00191 <span class="keyword">class </span><a class="code" href="classSurfaceIntegrator.html">SurfaceIntegrator</a>;
<a name="l00192"></a>00192 <span class="keyword">class </span><a class="code" href="classIntegrator.html">Integrator</a>;
<a name="l00193"></a>00193 <span class="keyword">class </span><a class="code" href="classVolumeIntegrator.html">VolumeIntegrator</a>;
<a name="l00194"></a>00194 <span class="comment">// Global Constants</span>
<a name="l00195"></a>00195 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00196"></a>00196 <span class="preprocessor"></span><span class="preprocessor">#define alloca _alloca</span>
<a name="l00197"></a>00197 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00198"></a>00198 <span class="preprocessor"></span><span class="preprocessor">#ifdef M_PI</span>
<a name="l00199"></a>00199 <span class="preprocessor"></span><span class="preprocessor">#undef M_PI</span>
<a name="l00200"></a>00200 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00201"></a>00201 <span class="preprocessor"></span><span class="preprocessor">#define M_PI           3.14159265358979323846f</span>
<a name="l00202"></a>00202 <span class="preprocessor"></span><span class="preprocessor">#define INV_PI  0.31830988618379067154f</span>
<a name="l00203"></a>00203 <span class="preprocessor"></span><span class="preprocessor">#define INV_TWOPI  0.15915494309189533577f</span>
<a name="l00204"></a>00204 <span class="preprocessor"></span><span class="preprocessor">#ifndef INFINITY</span>
<a name="l00205"></a>00205 <span class="preprocessor"></span><span class="preprocessor">#define INFINITY FLT_MAX</span>
<a name="l00206"></a>00206 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00207"></a>00207 <span class="preprocessor"></span><span class="preprocessor">#define PBRT_VERSION 1.03</span>
<a name="l00208"></a>00208 <span class="preprocessor"></span><span class="preprocessor">#define RAY_EPSILON 1e-3f</span>
<a name="l00209"></a>00209 <span class="preprocessor"></span><span class="preprocessor">#define COLOR_SAMPLES 3</span>
<a name="l00210"></a>00210 <span class="preprocessor"></span><span class="comment">// Global Function Declarations</span>
<a name="l00211"></a>00211 <span class="comment">// Setup printf format</span>
<a name="l00212"></a>00212 <span class="preprocessor">#ifdef __GNUG__</span>
<a name="l00213"></a>00213 <span class="preprocessor"></span><span class="preprocessor">#define PRINTF_FUNC __attribute__ \</span>
<a name="l00214"></a>00214 <span class="preprocessor">        ((__format__ (__printf__, 1, 2)))</span>
<a name="l00215"></a>00215 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00216"></a>00216 <span class="preprocessor"></span><span class="preprocessor">#define PRINTF_FUNC</span>
<a name="l00217"></a>00217 <span class="preprocessor"></span><span class="preprocessor">#endif // __GNUG__</span>
<a name="l00218"></a>00218 <span class="preprocessor"></span><span class="keyword">extern</span> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="pbrt_8h.html#e61c03aa347d076dc427f407cfafe71f">Info</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *, ...) <a class="code" href="pbrt_8h.html#a7849f92479017625ae81d55175571e5">PRINTF_FUNC</a>;
<a name="l00219"></a>00219 extern <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="pbrt_8h.html#79abc2e750c4774bd9d433ad4f6e440a">Warning</a>(const <span class="keywordtype">char</span> *, ...) <a class="code" href="pbrt_8h.html#a7849f92479017625ae81d55175571e5">PRINTF_FUNC</a>;
<a name="l00220"></a>00220 extern <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="pbrt_8h.html#d1a16fc9ced4ddc376b9d3e6607be15e">Error</a>(const <span class="keywordtype">char</span> *, ...) PRINTF_FUNC;
<a name="l00221"></a>00221 extern <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="pbrt_8h.html#63fd51330b3b9d2663a08258601448e5">Severe</a>(const <span class="keywordtype">char</span> *, ...) PRINTF_FUNC;
<a name="l00222"></a>00222 extern <span class="keywordtype">void</span> <a class="code" href="pbrt_8h.html#c68db060238e5514e0a610cbae6ab40b">StatsPrint</a>(FILE *dest);
<a name="l00223"></a>00223 extern <span class="keywordtype">void</span> <a class="code" href="pbrt_8h.html#c1f912df42c2ae7d595973b17901a8f6">StatsCleanup</a>();
<a name="l00224"></a>00224 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> *<a class="code" href="pbrt_8h.html#6999b138e9c0d348eee4455b4ba3d624">AllocAligned</a>(<span class="keywordtype">size_t</span> size);
<a name="l00225"></a>00225 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="pbrt_8h.html#338d7748e3c01292726a6e82059d90ff">FreeAligned</a>(<span class="keywordtype">void</span> *);
<a name="l00226"></a>00226 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">bool</span> <a class="code" href="pbrt_8h.html#bc9110183d0d45769bb48ac20928a7a5">SolveLinearSystem2x2</a>(const <span class="keywordtype">float</span> A[2][2], const <span class="keywordtype">float</span> B[2],
<a name="l00227"></a>00227         <span class="keywordtype">float</span> x[2]);
<a name="l00228"></a>00228 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="pbrt_8h.html#24bf150b5ab536c63e57b778e0cc6a9d">genrand_int32</a>(<span class="keywordtype">void</span>);
<a name="l00229"></a>00229 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> extern <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#85bdeb11319d3e31ba1d5bb7767bbb2a">genrand_real1</a>(<span class="keywordtype">void</span>);
<a name="l00230"></a>00230 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> extern <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#2c84e6fc3b8989a8ca6f415aa5585e24">genrand_real2</a>(<span class="keywordtype">void</span>);
<a name="l00231"></a>00231 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="classSpectrum.html">Spectrum</a> *<a class="code" href="exrio_8cpp.html#95815745d79c6bcbc71d3373c36f3c9e">ReadImage</a>(const <span class="keywordtype">string</span> &amp;name, <span class="keywordtype">int</span> *xSize,
<a name="l00232"></a>00232         <span class="keywordtype">int</span> *ySize);
<a name="l00233"></a>00233 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="exrio_8cpp.html#adf7c9452dc5e5ece32ade3d2dde96ba">WriteRGBAImage</a>(const <span class="keywordtype">string</span> &amp;name,
<a name="l00234"></a>00234         <span class="keywordtype">float</span> *pixels, <span class="keywordtype">float</span> *alpha, <span class="keywordtype">int</span> XRes, <span class="keywordtype">int</span> YRes,
<a name="l00235"></a>00235         <span class="keywordtype">int</span> totalXRes, <span class="keywordtype">int</span> totalYRes, <span class="keywordtype">int</span> xOffset, <span class="keywordtype">int</span> yOffset);
<a name="l00236"></a>00236 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#e5c3f1cdb2efaf34dc857fc7f54aea80">pbrtInit</a>();
<a name="l00237"></a>00237 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#139af3183189ca0486eec421b13d3ff2">pbrtCleanup</a>();
<a name="l00238"></a>00238 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="classTransform.html">Transform</a> <a class="code" href="pbrt_8h.html#dcfb331b19053e5b60008c68e78f7b81">Translate</a>(const <a class="code" href="classVector.html">Vector</a> &amp;delta);
<a name="l00239"></a>00239 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="classTransform.html">Transform</a> <a class="code" href="pbrt_8h.html#f6b012272269020d52792d1ed65c7904">Scale</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">float</span> z);
<a name="l00240"></a>00240 extern <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="classTransform.html">Transform</a> <a class="code" href="pbrt_8h.html#3e45cc944e9c00d11169f9a7380a5660">RotateX</a>(<span class="keywordtype">float</span> angle);
<a name="l00241"></a>00241 extern <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="classTransform.html">Transform</a> <a class="code" href="pbrt_8h.html#fcc5ff131fc39eeaa3a19cb0eac02984">RotateY</a>(<span class="keywordtype">float</span> angle);
<a name="l00242"></a>00242 extern <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="classTransform.html">Transform</a> <a class="code" href="pbrt_8h.html#13e6b5d16eb2807a90b32b757e39aea2">RotateZ</a>(<span class="keywordtype">float</span> angle);
<a name="l00243"></a>00243 extern <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="classTransform.html">Transform</a> <a class="code" href="pbrt_8h.html#351ec748c80266cff77f6bafc8414c54">Rotate</a>(<span class="keywordtype">float</span> angle, const <a class="code" href="classVector.html">Vector</a> &amp;axis);
<a name="l00244"></a>00244 extern <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="classTransform.html">Transform</a> <a class="code" href="pbrt_8h.html#289f82edc6f111331550a6fa5b18be44">LookAt</a>(const <a class="code" href="classPoint.html">Point</a> &amp;pos, const <a class="code" href="classPoint.html">Point</a> &amp;look,
<a name="l00245"></a>00245                         const <a class="code" href="classVector.html">Vector</a> &amp;up);
<a name="l00246"></a>00246 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="classTransform.html">Transform</a> <a class="code" href="pbrt_8h.html#afa5b6be57d705879eb446aa864fc0ad">Orthographic</a>(<span class="keywordtype">float</span> znear, <span class="keywordtype">float</span> zfar);
<a name="l00247"></a>00247 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a>
<a name="l00248"></a>00248 <a class="code" href="classTransform.html">Transform</a> <a class="code" href="pbrt_8h.html#b6306bd808488c136237a0dfe1cb57e5">Perspective</a>(<span class="keywordtype">float</span> fov, <span class="keywordtype">float</span> znear, <span class="keywordtype">float</span> zfar);
<a name="l00249"></a>00249 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="classSpectrum.html">Spectrum</a> <a class="code" href="pbrt_8h.html#7643cb218ea071ca6e82084d20957c52">FrDiel</a>(<span class="keywordtype">float</span> cosi, <span class="keywordtype">float</span> cost,
<a name="l00250"></a>00250                         const <a class="code" href="classSpectrum.html">Spectrum</a> &amp;etai,
<a name="l00251"></a>00251                                                 const <a class="code" href="classSpectrum.html">Spectrum</a> &amp;etat);
<a name="l00252"></a>00252 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="classSpectrum.html">Spectrum</a> <a class="code" href="pbrt_8h.html#530c345512def4a99a7a8f600aeea045">FrCond</a>(<span class="keywordtype">float</span> cosi,
<a name="l00253"></a>00253                         const <a class="code" href="classSpectrum.html">Spectrum</a> &amp;n,
<a name="l00254"></a>00254                                                 const <a class="code" href="classSpectrum.html">Spectrum</a> &amp;k);
<a name="l00255"></a>00255 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a>
<a name="l00256"></a>00256         <a class="code" href="classSpectrum.html">Spectrum</a> <a class="code" href="pbrt_8h.html#17777aa1d14b118f9a14b54602dbe86e">FresnelApproxEta</a>(const <a class="code" href="classSpectrum.html">Spectrum</a> &amp;intensity);
<a name="l00257"></a>00257 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a>
<a name="l00258"></a>00258         <a class="code" href="classSpectrum.html">Spectrum</a> <a class="code" href="pbrt_8h.html#ca1277586505f98d80b45ee2c5f913ea">FresnelApproxK</a>(const <a class="code" href="classSpectrum.html">Spectrum</a> &amp;intensity);
<a name="l00259"></a>00259 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#b1831c563572bacc96729314872ae245">Lanczos</a>(<span class="keywordtype">float</span>, <span class="keywordtype">float</span> tau=2);
<a name="l00260"></a>00260 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="classSpectrum.html">Spectrum</a> <a class="code" href="pbrt_8h.html#c650336ad9c0beac9ea35c32eba5d255">EstimateDirect</a>(const <a class="code" href="classScene.html">Scene</a> *scene, const <a class="code" href="classLight.html">Light</a> *light, const <a class="code" href="classPoint.html">Point</a> &amp;p,
<a name="l00261"></a>00261         const <a class="code" href="classNormal.html">Normal</a> &amp;n, const <a class="code" href="classVector.html">Vector</a> &amp;wo, <a class="code" href="classBSDF.html">BSDF</a> *bsdf,
<a name="l00262"></a>00262         const <a class="code" href="structSample.html">Sample</a> *sample, <span class="keywordtype">int</span> lightSamp, <span class="keywordtype">int</span> bsdfSamp,
<a name="l00263"></a>00263         <span class="keywordtype">int</span> bsdfComponent, <a class="code" href="pbrt_8h.html#c319c165d52643e43249fe003e18bdf3">u_int</a> sampleNum);
<a name="l00264"></a>00264 extern <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="mc_8cpp.html#1cb88cade3da8d8ff8474bcfc71cbe81">ComputeStep1dCDF</a>(<span class="keywordtype">float</span> *f, <span class="keywordtype">int</span> nValues, <span class="keywordtype">float</span> *c, <span class="keywordtype">float</span> *cdf);
<a name="l00265"></a>00265 extern <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="mc_8cpp.html#22c0752ae44234ec91da37f554d988cb">SampleStep1d</a>(<span class="keywordtype">float</span> *f, <span class="keywordtype">float</span> *cdf, <span class="keywordtype">float</span> c,
<a name="l00266"></a>00266         <span class="keywordtype">int</span> nSteps, <span class="keywordtype">float</span> u, <span class="keywordtype">float</span> *weight);
<a name="l00267"></a>00267 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="mc_8cpp.html#95605832633c4524c81f2eb75c9e5cad">ConcentricSampleDisk</a>(<span class="keywordtype">float</span> u1, <span class="keywordtype">float</span> u2, <span class="keywordtype">float</span> *dx, <span class="keywordtype">float</span> *dy);
<a name="l00268"></a>00268 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="mc_8cpp.html#b268bd5ca56bf19d12051a1f36f1b4d1">UniformSampleTriangle</a>(<span class="keywordtype">float</span> ud1, <span class="keywordtype">float</span> ud2, <span class="keywordtype">float</span> *u, <span class="keywordtype">float</span> *v);
<a name="l00269"></a>00269 <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">bool</span> <a class="code" href="parser_8cpp.html#70367bb4acff51203510c2b4d8fd207e">ParseFile</a>(const <span class="keywordtype">char</span> *filename);
<a name="l00270"></a>00270 <span class="comment">// Global Classes</span>
<a name="l00271"></a><a class="code" href="structProgressReporter.html">00271</a> struct <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="structProgressReporter.html">ProgressReporter</a> {
<a name="l00272"></a>00272         <span class="comment">// ProgressReporter Public Methods</span>
<a name="l00273"></a>00273         ProgressReporter(<span class="keywordtype">int</span> totalWork, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;title,
<a name="l00274"></a>00274                 <span class="keywordtype">int</span> barLength=58);
<a name="l00275"></a>00275         ~ProgressReporter();
<a name="l00276"></a>00276         <span class="keywordtype">void</span> Update(<span class="keywordtype">int</span> num = 1) <span class="keyword">const</span>;
<a name="l00277"></a>00277         <span class="keywordtype">void</span> Done() <span class="keyword">const</span>;
<a name="l00278"></a>00278         <span class="comment">// ProgressReporter Data</span>
<a name="l00279"></a><a class="code" href="structProgressReporter.html#44353a8f72b5896d3fd8789cde6d95e0">00279</a>         <span class="keyword">const</span> <span class="keywordtype">int</span> totalPlusses;
<a name="l00280"></a><a class="code" href="structProgressReporter.html#35c61a91e01ead2633108e77bbc94592">00280</a>         <span class="keywordtype">float</span> frequency;
<a name="l00281"></a><a class="code" href="structProgressReporter.html#71ecaba625fcfd5053eb13045cb6dcba">00281</a>         <span class="keyword">mutable</span> <span class="keywordtype">float</span> count;
<a name="l00282"></a><a class="code" href="structProgressReporter.html#905a955a33e9a17f7f2cc99ce199a6da">00282</a>         <span class="keyword">mutable</span> <span class="keywordtype">int</span> plussesPrinted;
<a name="l00283"></a><a class="code" href="structProgressReporter.html#9d3ee08b2230f33fe992d5393a901288">00283</a>         <span class="keyword">mutable</span> <a class="code" href="classTimer.html">Timer</a> *timer;
<a name="l00284"></a><a class="code" href="structProgressReporter.html#a0ee06ab7e673ed06643d100762ecbc5">00284</a>         FILE *outFile;
<a name="l00285"></a><a class="code" href="structProgressReporter.html#e582732e6e138e6140eef7870ad36b15">00285</a>         <span class="keywordtype">char</span> *buf;
<a name="l00286"></a><a class="code" href="structProgressReporter.html#d668d1b76a50ec60b5f8e3d333ddacda">00286</a>         <span class="keyword">mutable</span> <span class="keywordtype">char</span> *curSpace;
<a name="l00287"></a>00287 };
<a name="l00288"></a><a class="code" href="classStatsCounter.html">00288</a> <span class="keyword">class </span><a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="classStatsCounter.html">StatsCounter</a> {
<a name="l00289"></a>00289 <span class="keyword">public</span>:
<a name="l00290"></a>00290         <span class="comment">// StatsCounter Public Methods</span>
<a name="l00291"></a>00291         <a class="code" href="classStatsCounter.html">StatsCounter</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;category, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name);
<a name="l00292"></a><a class="code" href="classStatsCounter.html#d29e7f7b194c898007442df2b77297d7">00292</a>         <span class="keywordtype">void</span> operator++() { ++num; }
<a name="l00293"></a><a class="code" href="classStatsCounter.html#c87b8286f5d848e94a1a89308377fc0a">00293</a>         <span class="keywordtype">void</span> operator++(<span class="keywordtype">int</span>) { ++num; }
<a name="l00294"></a><a class="code" href="classStatsCounter.html#8e0916b5f43cf8e8e89d5b2c3c20b87a">00294</a>         <span class="keywordtype">void</span> Max(<a class="code" href="pbrt_8h.html#8c1c8901a052f5b154294299c55e52a6">StatsCounterType</a> val) { num = max(val, num); }
<a name="l00295"></a><a class="code" href="classStatsCounter.html#24187aeeed156942e842c48bbd855bfb">00295</a>         <span class="keywordtype">void</span> Min(<a class="code" href="pbrt_8h.html#8c1c8901a052f5b154294299c55e52a6">StatsCounterType</a> val) { num = min(val, num); }
<a name="l00296"></a><a class="code" href="classStatsCounter.html#7c9f260ae7377213b0977b6400db9c55">00296</a>         operator double()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (<span class="keywordtype">double</span>)num; }
<a name="l00297"></a>00297 <span class="keyword">private</span>:
<a name="l00298"></a>00298         <span class="comment">// StatsCounter Private Data</span>
<a name="l00299"></a><a class="code" href="classStatsCounter.html#8d342c40d0ec9e1f1df06c1b9381b142">00299</a>         <a class="code" href="pbrt_8h.html#8c1c8901a052f5b154294299c55e52a6">StatsCounterType</a> num;
<a name="l00300"></a>00300 };
<a name="l00301"></a><a class="code" href="classStatsRatio.html">00301</a> <span class="keyword">class </span><a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="classStatsRatio.html">StatsRatio</a> {
<a name="l00302"></a>00302 <span class="keyword">public</span>:
<a name="l00303"></a>00303         <span class="comment">// StatsRatio Public Methods</span>
<a name="l00304"></a>00304         <a class="code" href="classStatsRatio.html">StatsRatio</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;category, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name);
<a name="l00305"></a><a class="code" href="classStatsRatio.html#c0530f7ffbb92fa6f736767f0217ed51">00305</a>         <span class="keywordtype">void</span> Add(<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b) { na += a; nb += b; }
<a name="l00306"></a>00306 <span class="keyword">private</span>:
<a name="l00307"></a>00307         <span class="comment">// StatsRatio Private Data</span>
<a name="l00308"></a><a class="code" href="classStatsRatio.html#345c11747cce856b89f60155c1e59804">00308</a>         <a class="code" href="pbrt_8h.html#8c1c8901a052f5b154294299c55e52a6">StatsCounterType</a> na, nb;
<a name="l00309"></a>00309 };
<a name="l00310"></a><a class="code" href="classStatsPercentage.html">00310</a> <span class="keyword">class </span><a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="classStatsPercentage.html">StatsPercentage</a> {
<a name="l00311"></a>00311 <span class="keyword">public</span>:
<a name="l00312"></a>00312         <span class="comment">// StatsPercentage Public Methods</span>
<a name="l00313"></a><a class="code" href="classStatsPercentage.html#4102f83517e7ab0bcc92437fde4b72fe">00313</a>         <span class="keywordtype">void</span> Add(<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b) { na += a; nb += b; }
<a name="l00314"></a>00314         <a class="code" href="classStatsPercentage.html">StatsPercentage</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;category, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name);
<a name="l00315"></a>00315 <span class="keyword">private</span>:
<a name="l00316"></a>00316         <span class="comment">// StatsPercentage Private Data</span>
<a name="l00317"></a><a class="code" href="classStatsPercentage.html#26d3ac0c5c9444511244453926ad6849">00317</a>         <a class="code" href="pbrt_8h.html#8c1c8901a052f5b154294299c55e52a6">StatsCounterType</a> na, nb;
<a name="l00318"></a>00318 };
<a name="l00319"></a><a class="code" href="classReferenceCounted.html">00319</a> <span class="keyword">class </span><a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="classReferenceCounted.html">ReferenceCounted</a> {
<a name="l00320"></a>00320 <span class="keyword">public</span>:
<a name="l00321"></a><a class="code" href="classReferenceCounted.html#5dc30ae895897b5008dc71ea26f175a1">00321</a>         <a class="code" href="classReferenceCounted.html">ReferenceCounted</a>() { nReferences = 0; }
<a name="l00322"></a><a class="code" href="classReferenceCounted.html#ce02ab417f1bb97830153e239cfa1f3a">00322</a>         <span class="keywordtype">int</span> nReferences;
<a name="l00323"></a>00323 <span class="keyword">private</span>:
<a name="l00324"></a>00324         <a class="code" href="classReferenceCounted.html">ReferenceCounted</a>(<span class="keyword">const</span> <a class="code" href="classReferenceCounted.html">ReferenceCounted</a> &amp;);
<a name="l00325"></a>00325         <a class="code" href="classReferenceCounted.html">ReferenceCounted</a> &amp;operator=(<span class="keyword">const</span> <a class="code" href="classReferenceCounted.html">ReferenceCounted</a> &amp;);
<a name="l00326"></a>00326 };
<a name="l00327"></a><a class="code" href="classReference.html">00327</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">class </span><a class="code" href="classReference.html">Reference</a> {
<a name="l00328"></a>00328 <span class="keyword">public</span>:
<a name="l00329"></a>00329         <span class="comment">// Reference Public Methods</span>
<a name="l00330"></a><a class="code" href="classReference.html#360d65733e9fb7bd0bc95b6e41a3c27c">00330</a>         <a class="code" href="classReference.html#360d65733e9fb7bd0bc95b6e41a3c27c">Reference</a>(T *p = NULL) {
<a name="l00331"></a>00331                 <a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a> = p;
<a name="l00332"></a>00332                 <span class="keywordflow">if</span> (<a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a>) ++<a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a>-&gt;nReferences;
<a name="l00333"></a>00333         }
<a name="l00334"></a><a class="code" href="classReference.html#c5825baca5e1bfb9a1eae162c7b9f0f4">00334</a>         <a class="code" href="classReference.html#360d65733e9fb7bd0bc95b6e41a3c27c">Reference</a>(<span class="keyword">const</span> <a class="code" href="classReference.html">Reference&lt;T&gt;</a> &amp;r) {
<a name="l00335"></a>00335                 <a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a> = r.<a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a>;
<a name="l00336"></a>00336                 <span class="keywordflow">if</span> (<a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a>) ++<a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a>-&gt;nReferences;
<a name="l00337"></a>00337         }
<a name="l00338"></a><a class="code" href="classReference.html#20d81720158947132919a74783ae8912">00338</a>         <a class="code" href="classReference.html">Reference</a> &amp;<a class="code" href="classReference.html#20d81720158947132919a74783ae8912">operator=</a>(<span class="keyword">const</span> <a class="code" href="classReference.html">Reference&lt;T&gt;</a> &amp;r) {
<a name="l00339"></a>00339                 <span class="keywordflow">if</span> (r.<a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a>) r.<a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a>-&gt;nReferences++;
<a name="l00340"></a>00340                 <span class="keywordflow">if</span> (<a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a> &amp;&amp; --<a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a>-&gt;nReferences == 0) <span class="keyword">delete</span> <a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a>;
<a name="l00341"></a>00341                 <a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a> = r.<a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a>;
<a name="l00342"></a>00342                 <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00343"></a>00343         }
<a name="l00344"></a><a class="code" href="classReference.html#637eccc059f1b1da1f293abf0646d7a5">00344</a>         <a class="code" href="classReference.html">Reference</a> &amp;<a class="code" href="classReference.html#20d81720158947132919a74783ae8912">operator=</a>(T *p) {
<a name="l00345"></a>00345                 <span class="keywordflow">if</span> (p) p-&gt;nReferences++;
<a name="l00346"></a>00346                 <span class="keywordflow">if</span> (<a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a> &amp;&amp; --<a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a>-&gt;nReferences == 0) <span class="keyword">delete</span> <a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a>;
<a name="l00347"></a>00347                 <a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a> = p;
<a name="l00348"></a>00348                 <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00349"></a>00349         }
<a name="l00350"></a><a class="code" href="classReference.html#f1a17e17ac2ef85b88e8dd76f29039ad">00350</a>         <a class="code" href="classReference.html#f1a17e17ac2ef85b88e8dd76f29039ad">~Reference</a>() {
<a name="l00351"></a>00351                 <span class="keywordflow">if</span> (<a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a> &amp;&amp; --<a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a>-&gt;nReferences == 0)
<a name="l00352"></a>00352                         <span class="keyword">delete</span> <a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a>;
<a name="l00353"></a>00353         }
<a name="l00354"></a><a class="code" href="classReference.html#03b968e460ce527d6be7d5d3e6dd1b18">00354</a>         T *<a class="code" href="classReference.html#03b968e460ce527d6be7d5d3e6dd1b18">operator-&gt;</a>() { <span class="keywordflow">return</span> <a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a>; }
<a name="l00355"></a><a class="code" href="classReference.html#bc5cdb64213c43c845ff2d8cfc3eb76f">00355</a>         <span class="keyword">const</span> T *<a class="code" href="classReference.html#03b968e460ce527d6be7d5d3e6dd1b18">operator-&gt;</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a>; }
<a name="l00356"></a><a class="code" href="classReference.html#7545271f2dabebc0c747a2ace0131315">00356</a>         <a class="code" href="classReference.html#7545271f2dabebc0c747a2ace0131315">operator bool</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a> != NULL; }
<a name="l00357"></a><a class="code" href="classReference.html#0d6a8f88eaf5ff09a4e1d700dd495aff">00357</a>         <span class="keywordtype">bool</span> operator&lt;(const Reference&lt;T&gt; &amp;t2) <span class="keyword">const</span> {
<a name="l00358"></a>00358                 <span class="keywordflow">return</span> <a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a> &lt; t2.ptr;
<a name="l00359"></a>00359         }
<a name="l00360"></a>00360 <span class="keyword">private</span>:
<a name="l00361"></a><a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">00361</a>         T *<a class="code" href="classReference.html#11c8248ee2b230ca16eda6f404c4142d">ptr</a>;
<a name="l00362"></a>00362 };
<a name="l00363"></a><a class="code" href="classObjectArena.html">00363</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">class </span><a class="code" href="classObjectArena.html">ObjectArena</a> {
<a name="l00364"></a>00364 <span class="keyword">public</span>:
<a name="l00365"></a>00365         <span class="comment">// ObjectArena Public Methods</span>
<a name="l00366"></a><a class="code" href="classObjectArena.html#7ca175331fbd11cc707af2175154d72b">00366</a>         <a class="code" href="classObjectArena.html#7ca175331fbd11cc707af2175154d72b">ObjectArena</a>() {
<a name="l00367"></a>00367                 <a class="code" href="classObjectArena.html#71d35a8f716c43bf5f4cf0b51a6577e2">nAvailable</a> = 0;
<a name="l00368"></a>00368         }
<a name="l00369"></a><a class="code" href="classObjectArena.html#1720d1df7cd1ae8c5f77482eb41f96e3">00369</a>         T *<a class="code" href="classObjectArena.html#1720d1df7cd1ae8c5f77482eb41f96e3">Alloc</a>() {
<a name="l00370"></a>00370                 <span class="keywordflow">if</span> (<a class="code" href="classObjectArena.html#71d35a8f716c43bf5f4cf0b51a6577e2">nAvailable</a> == 0) {
<a name="l00371"></a>00371                         <span class="keywordtype">int</span> nAlloc = max((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)16,
<a name="l00372"></a>00372                                 (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(65536/<span class="keyword">sizeof</span>(T)));
<a name="l00373"></a>00373                         <a class="code" href="classObjectArena.html#24024d60597844a3a911db99e63b986b">mem</a> = (T *)<a class="code" href="pbrt_8h.html#6999b138e9c0d348eee4455b4ba3d624">AllocAligned</a>(nAlloc * <span class="keyword">sizeof</span>(T));
<a name="l00374"></a>00374                         <a class="code" href="classObjectArena.html#71d35a8f716c43bf5f4cf0b51a6577e2">nAvailable</a> = nAlloc;
<a name="l00375"></a>00375                         <a class="code" href="classObjectArena.html#985a30a05aaf75f4593e6af656a85fb5">toDelete</a>.push_back(<a class="code" href="classObjectArena.html#24024d60597844a3a911db99e63b986b">mem</a>);
<a name="l00376"></a>00376                 }
<a name="l00377"></a>00377                 --<a class="code" href="classObjectArena.html#71d35a8f716c43bf5f4cf0b51a6577e2">nAvailable</a>;
<a name="l00378"></a>00378                 <span class="keywordflow">return</span> <a class="code" href="classObjectArena.html#24024d60597844a3a911db99e63b986b">mem</a>++;
<a name="l00379"></a>00379         }
<a name="l00380"></a><a class="code" href="classObjectArena.html#d95db2f8466f2512c0455b920f27e6b4">00380</a>         <a class="code" href="classObjectArena.html#d95db2f8466f2512c0455b920f27e6b4">operator T *</a>() {
<a name="l00381"></a>00381                 <span class="keywordflow">return</span> <a class="code" href="classObjectArena.html#1720d1df7cd1ae8c5f77482eb41f96e3">Alloc</a>();
<a name="l00382"></a>00382         }
<a name="l00383"></a><a class="code" href="classObjectArena.html#6948bf861644d64b9c6f4ab7bc175510">00383</a>         <a class="code" href="classObjectArena.html#6948bf861644d64b9c6f4ab7bc175510">~ObjectArena</a>() { <a class="code" href="classObjectArena.html#8c32ab866e5bf6d51d4f21bd787d4e5d">FreeAll</a>(); }
<a name="l00384"></a><a class="code" href="classObjectArena.html#8c32ab866e5bf6d51d4f21bd787d4e5d">00384</a>         <span class="keywordtype">void</span> <a class="code" href="classObjectArena.html#8c32ab866e5bf6d51d4f21bd787d4e5d">FreeAll</a>() {
<a name="l00385"></a>00385                 <span class="keywordflow">for</span> (<a class="code" href="pbrt_8h.html#c319c165d52643e43249fe003e18bdf3">u_int</a> i = 0; i &lt; <a class="code" href="classObjectArena.html#985a30a05aaf75f4593e6af656a85fb5">toDelete</a>.size(); ++i)
<a name="l00386"></a>00386                         <a class="code" href="pbrt_8h.html#338d7748e3c01292726a6e82059d90ff">FreeAligned</a>(<a class="code" href="classObjectArena.html#985a30a05aaf75f4593e6af656a85fb5">toDelete</a>[i]);
<a name="l00387"></a>00387                 <a class="code" href="classObjectArena.html#985a30a05aaf75f4593e6af656a85fb5">toDelete</a>.erase(<a class="code" href="classObjectArena.html#985a30a05aaf75f4593e6af656a85fb5">toDelete</a>.begin(), <a class="code" href="classObjectArena.html#985a30a05aaf75f4593e6af656a85fb5">toDelete</a>.end());
<a name="l00388"></a>00388                 <a class="code" href="classObjectArena.html#71d35a8f716c43bf5f4cf0b51a6577e2">nAvailable</a> = 0;
<a name="l00389"></a>00389         }
<a name="l00390"></a>00390 <span class="keyword">private</span>:
<a name="l00391"></a>00391         <span class="comment">// ObjectArena Private Data</span>
<a name="l00392"></a><a class="code" href="classObjectArena.html#24024d60597844a3a911db99e63b986b">00392</a>         T *<a class="code" href="classObjectArena.html#24024d60597844a3a911db99e63b986b">mem</a>;
<a name="l00393"></a><a class="code" href="classObjectArena.html#71d35a8f716c43bf5f4cf0b51a6577e2">00393</a>         <span class="keywordtype">int</span> <a class="code" href="classObjectArena.html#71d35a8f716c43bf5f4cf0b51a6577e2">nAvailable</a>;
<a name="l00394"></a><a class="code" href="classObjectArena.html#985a30a05aaf75f4593e6af656a85fb5">00394</a>         vector&lt;T *&gt; <a class="code" href="classObjectArena.html#985a30a05aaf75f4593e6af656a85fb5">toDelete</a>;
<a name="l00395"></a>00395 };
<a name="l00396"></a><a class="code" href="classMemoryArena.html">00396</a> <span class="keyword">class </span><a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="classMemoryArena.html">MemoryArena</a> {
<a name="l00397"></a>00397 <span class="keyword">public</span>:
<a name="l00398"></a>00398         <span class="comment">// MemoryArena Public Methods</span>
<a name="l00399"></a><a class="code" href="classMemoryArena.html#9ced4a55dcf83b7a521105e70321ee29">00399</a>         <a class="code" href="classMemoryArena.html">MemoryArena</a>(<a class="code" href="pbrt_8h.html#c319c165d52643e43249fe003e18bdf3">u_int</a> bs = 32768) {
<a name="l00400"></a>00400                 blockSize = bs;
<a name="l00401"></a>00401                 curBlockPos = 0;
<a name="l00402"></a>00402                 currentBlock = (<span class="keywordtype">char</span> *)<a class="code" href="pbrt_8h.html#6999b138e9c0d348eee4455b4ba3d624">AllocAligned</a>(blockSize);
<a name="l00403"></a>00403         }
<a name="l00404"></a><a class="code" href="classMemoryArena.html#e4eb8fc0a46771737d0a395f95fb5e46">00404</a>         ~<a class="code" href="classMemoryArena.html">MemoryArena</a>() {
<a name="l00405"></a>00405                 <a class="code" href="pbrt_8h.html#338d7748e3c01292726a6e82059d90ff">FreeAligned</a>(currentBlock);
<a name="l00406"></a>00406                 <span class="keywordflow">for</span> (<a class="code" href="pbrt_8h.html#c319c165d52643e43249fe003e18bdf3">u_int</a> i = 0; i &lt; usedBlocks.size(); ++i)
<a name="l00407"></a>00407                         <a class="code" href="pbrt_8h.html#338d7748e3c01292726a6e82059d90ff">FreeAligned</a>(usedBlocks[i]);
<a name="l00408"></a>00408                 <span class="keywordflow">for</span> (<a class="code" href="pbrt_8h.html#c319c165d52643e43249fe003e18bdf3">u_int</a> i = 0; i &lt; availableBlocks.size(); ++i)
<a name="l00409"></a>00409                         <a class="code" href="pbrt_8h.html#338d7748e3c01292726a6e82059d90ff">FreeAligned</a>(availableBlocks[i]);
<a name="l00410"></a>00410         }
<a name="l00411"></a><a class="code" href="classMemoryArena.html#d36b79fe2137490940c57d090cf58674">00411</a>         <span class="keywordtype">void</span> *Alloc(<a class="code" href="pbrt_8h.html#c319c165d52643e43249fe003e18bdf3">u_int</a> sz) {
<a name="l00412"></a>00412                 <span class="comment">// Round up _sz_ to minimum machine alignment</span>
<a name="l00413"></a>00413                 sz = ((sz + 7) &amp; (~7));
<a name="l00414"></a>00414                 <span class="keywordflow">if</span> (curBlockPos + sz &gt; blockSize) {
<a name="l00415"></a>00415                         <span class="comment">// Get new block of memory for _MemoryArena_</span>
<a name="l00416"></a>00416                         usedBlocks.push_back(currentBlock);
<a name="l00417"></a>00417                         <span class="keywordflow">if</span> (availableBlocks.size() &amp;&amp; sz &lt;= blockSize) {
<a name="l00418"></a>00418                                 currentBlock = availableBlocks.back();
<a name="l00419"></a>00419                                 availableBlocks.pop_back();
<a name="l00420"></a>00420                         }
<a name="l00421"></a>00421                         <span class="keywordflow">else</span>
<a name="l00422"></a>00422                                 currentBlock = (<span class="keywordtype">char</span> *)<a class="code" href="pbrt_8h.html#6999b138e9c0d348eee4455b4ba3d624">AllocAligned</a>(max(sz, blockSize));
<a name="l00423"></a>00423                         curBlockPos = 0;
<a name="l00424"></a>00424                 }
<a name="l00425"></a>00425                 <span class="keywordtype">void</span> *ret = currentBlock + curBlockPos;
<a name="l00426"></a>00426                 curBlockPos += sz;
<a name="l00427"></a>00427                 <span class="keywordflow">return</span> ret;
<a name="l00428"></a>00428         }
<a name="l00429"></a><a class="code" href="classMemoryArena.html#136db5cd5a03c84c560c25ca4ceabc1a">00429</a>         <span class="keywordtype">void</span> FreeAll() {
<a name="l00430"></a>00430                 curBlockPos = 0;
<a name="l00431"></a>00431                 <span class="keywordflow">while</span> (usedBlocks.size()) {
<a name="l00432"></a>00432                         availableBlocks.push_back(usedBlocks.back());
<a name="l00433"></a>00433                         usedBlocks.pop_back();
<a name="l00434"></a>00434                 }
<a name="l00435"></a>00435         }
<a name="l00436"></a>00436 <span class="keyword">private</span>:
<a name="l00437"></a>00437         <span class="comment">// MemoryArena Private Data</span>
<a name="l00438"></a><a class="code" href="classMemoryArena.html#5eccdbeca887376101106b478e338566">00438</a>         <a class="code" href="pbrt_8h.html#c319c165d52643e43249fe003e18bdf3">u_int</a> curBlockPos, blockSize;
<a name="l00439"></a><a class="code" href="classMemoryArena.html#4dfe8b03eced8ce7e400a9c1a8d8e405">00439</a>         <span class="keywordtype">char</span> *currentBlock;
<a name="l00440"></a><a class="code" href="classMemoryArena.html#f4d4ee70984f123cb753bea9a6491ce5">00440</a>         vector&lt;char *&gt; usedBlocks, availableBlocks;
<a name="l00441"></a>00441 };
<a name="l00442"></a><a class="code" href="classBlockedArray.html">00442</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> T, <span class="keywordtype">int</span> logBlockSize&gt; <span class="keyword">class </span><a class="code" href="classBlockedArray.html">BlockedArray</a> {
<a name="l00443"></a>00443 <span class="keyword">public</span>:
<a name="l00444"></a>00444         <span class="comment">// BlockedArray Public Methods</span>
<a name="l00445"></a><a class="code" href="classBlockedArray.html#bd4f083870f473de3ed082624a0f5a41">00445</a>         <a class="code" href="classBlockedArray.html#bd4f083870f473de3ed082624a0f5a41">BlockedArray</a>(<span class="keywordtype">int</span> nu, <span class="keywordtype">int</span> nv, <span class="keyword">const</span> T *d = NULL) {
<a name="l00446"></a>00446                 <a class="code" href="classBlockedArray.html#59138889d56a2b14db2385a70d191214">uRes</a> = nu;
<a name="l00447"></a>00447                 <a class="code" href="classBlockedArray.html#5d0e0f592958cc054664f5b27096dabb">vRes</a> = nv;
<a name="l00448"></a>00448                 <a class="code" href="classBlockedArray.html#eb518cfe9742b865cdb49f45cffed5b0">uBlocks</a> = <a class="code" href="classBlockedArray.html#d0ba29ae20aa78bc8c9c6528ab9e0a03">RoundUp</a>(<a class="code" href="classBlockedArray.html#59138889d56a2b14db2385a70d191214">uRes</a>) &gt;&gt; logBlockSize;
<a name="l00449"></a>00449                 <span class="keywordtype">int</span> nAlloc = <a class="code" href="classBlockedArray.html#d0ba29ae20aa78bc8c9c6528ab9e0a03">RoundUp</a>(<a class="code" href="classBlockedArray.html#59138889d56a2b14db2385a70d191214">uRes</a>) * <a class="code" href="classBlockedArray.html#d0ba29ae20aa78bc8c9c6528ab9e0a03">RoundUp</a>(<a class="code" href="classBlockedArray.html#5d0e0f592958cc054664f5b27096dabb">vRes</a>);
<a name="l00450"></a>00450                 <a class="code" href="classBlockedArray.html#0ad5941b7203f391fae005be2dd37cee">data</a> = (T *)<a class="code" href="pbrt_8h.html#6999b138e9c0d348eee4455b4ba3d624">AllocAligned</a>(nAlloc * <span class="keyword">sizeof</span>(T));
<a name="l00451"></a>00451                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nAlloc; ++i)
<a name="l00452"></a>00452                         <span class="keyword">new</span> (&amp;<a class="code" href="classBlockedArray.html#0ad5941b7203f391fae005be2dd37cee">data</a>[i]) T();
<a name="l00453"></a>00453                 <span class="keywordflow">if</span> (d)
<a name="l00454"></a>00454                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> v = 0; v &lt; nv; ++v)
<a name="l00455"></a>00455                                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> u = 0; u &lt; nu; ++u)
<a name="l00456"></a>00456                                         (*<span class="keyword">this</span>)(u, v) = d[v * <a class="code" href="classBlockedArray.html#59138889d56a2b14db2385a70d191214">uRes</a> + u];
<a name="l00457"></a>00457         }
<a name="l00458"></a><a class="code" href="classBlockedArray.html#6ffa335a93705a6161d62638d2b1b3b2">00458</a>         <span class="keywordtype">int</span> <a class="code" href="classBlockedArray.html#6ffa335a93705a6161d62638d2b1b3b2">BlockSize</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> 1 &lt;&lt; logBlockSize; }
<a name="l00459"></a><a class="code" href="classBlockedArray.html#d0ba29ae20aa78bc8c9c6528ab9e0a03">00459</a>         <span class="keywordtype">int</span> <a class="code" href="classBlockedArray.html#d0ba29ae20aa78bc8c9c6528ab9e0a03">RoundUp</a>(<span class="keywordtype">int</span> x)<span class="keyword"> const </span>{
<a name="l00460"></a>00460                 <span class="keywordflow">return</span> (x + <a class="code" href="classBlockedArray.html#6ffa335a93705a6161d62638d2b1b3b2">BlockSize</a>() - 1) &amp; ~(<a class="code" href="classBlockedArray.html#6ffa335a93705a6161d62638d2b1b3b2">BlockSize</a>() - 1);
<a name="l00461"></a>00461         }
<a name="l00462"></a><a class="code" href="classBlockedArray.html#84ae63abb4fad0865935237c381ed6c3">00462</a>         <span class="keywordtype">int</span> <a class="code" href="classBlockedArray.html#84ae63abb4fad0865935237c381ed6c3">uSize</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classBlockedArray.html#59138889d56a2b14db2385a70d191214">uRes</a>; }
<a name="l00463"></a><a class="code" href="classBlockedArray.html#75ebac9da54aee7b4f4765e245f2fed6">00463</a>         <span class="keywordtype">int</span> <a class="code" href="classBlockedArray.html#75ebac9da54aee7b4f4765e245f2fed6">vSize</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classBlockedArray.html#5d0e0f592958cc054664f5b27096dabb">vRes</a>; }
<a name="l00464"></a><a class="code" href="classBlockedArray.html#28365a1ee73aba3b848b25d523c48f9f">00464</a>         <a class="code" href="classBlockedArray.html#28365a1ee73aba3b848b25d523c48f9f">~BlockedArray</a>() {
<a name="l00465"></a>00465                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classBlockedArray.html#59138889d56a2b14db2385a70d191214">uRes</a> * <a class="code" href="classBlockedArray.html#5d0e0f592958cc054664f5b27096dabb">vRes</a>; ++i)
<a name="l00466"></a>00466                         <a class="code" href="classBlockedArray.html#0ad5941b7203f391fae005be2dd37cee">data</a>[i].~T();
<a name="l00467"></a>00467                 <a class="code" href="pbrt_8h.html#338d7748e3c01292726a6e82059d90ff">FreeAligned</a>(<a class="code" href="classBlockedArray.html#0ad5941b7203f391fae005be2dd37cee">data</a>);
<a name="l00468"></a>00468         }
<a name="l00469"></a><a class="code" href="classBlockedArray.html#f644816031ed873236fef0ef9ce86e25">00469</a>         <span class="keywordtype">int</span> <a class="code" href="classBlockedArray.html#f644816031ed873236fef0ef9ce86e25">Block</a>(<span class="keywordtype">int</span> a)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> a &gt;&gt; logBlockSize; }
<a name="l00470"></a><a class="code" href="classBlockedArray.html#2159ba9a6e6fbf96d58dc87c083ac68c">00470</a>         <span class="keywordtype">int</span> <a class="code" href="classBlockedArray.html#2159ba9a6e6fbf96d58dc87c083ac68c">Offset</a>(<span class="keywordtype">int</span> a)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (a &amp; (<a class="code" href="classBlockedArray.html#6ffa335a93705a6161d62638d2b1b3b2">BlockSize</a>() - 1)); }
<a name="l00471"></a><a class="code" href="classBlockedArray.html#fe12842e5d3ddbaf7cc8f51217da8bb0">00471</a>         T &amp;<a class="code" href="classBlockedArray.html#fe12842e5d3ddbaf7cc8f51217da8bb0">operator()</a>(<span class="keywordtype">int</span> u, <span class="keywordtype">int</span> v) {
<a name="l00472"></a>00472                 <span class="keywordtype">int</span> bu = <a class="code" href="classBlockedArray.html#f644816031ed873236fef0ef9ce86e25">Block</a>(u), bv = <a class="code" href="classBlockedArray.html#f644816031ed873236fef0ef9ce86e25">Block</a>(v);
<a name="l00473"></a>00473                 <span class="keywordtype">int</span> ou = <a class="code" href="classBlockedArray.html#2159ba9a6e6fbf96d58dc87c083ac68c">Offset</a>(u), ov = <a class="code" href="classBlockedArray.html#2159ba9a6e6fbf96d58dc87c083ac68c">Offset</a>(v);
<a name="l00474"></a>00474                 <span class="keywordtype">int</span> offset = <a class="code" href="classBlockedArray.html#6ffa335a93705a6161d62638d2b1b3b2">BlockSize</a>() * <a class="code" href="classBlockedArray.html#6ffa335a93705a6161d62638d2b1b3b2">BlockSize</a>() *
<a name="l00475"></a>00475                              (<a class="code" href="classBlockedArray.html#eb518cfe9742b865cdb49f45cffed5b0">uBlocks</a> * bv + bu);
<a name="l00476"></a>00476                 offset += <a class="code" href="classBlockedArray.html#6ffa335a93705a6161d62638d2b1b3b2">BlockSize</a>() * ov + ou;
<a name="l00477"></a>00477                 <span class="keywordflow">return</span> <a class="code" href="classBlockedArray.html#0ad5941b7203f391fae005be2dd37cee">data</a>[offset];
<a name="l00478"></a>00478         }
<a name="l00479"></a><a class="code" href="classBlockedArray.html#9b186fcf9032ceead39eefae795c51e4">00479</a>         <span class="keyword">const</span> T &amp;<a class="code" href="classBlockedArray.html#fe12842e5d3ddbaf7cc8f51217da8bb0">operator()</a>(<span class="keywordtype">int</span> u, <span class="keywordtype">int</span> v)<span class="keyword"> const </span>{
<a name="l00480"></a>00480                 <span class="keywordtype">int</span> bu = <a class="code" href="classBlockedArray.html#f644816031ed873236fef0ef9ce86e25">Block</a>(u), bv = <a class="code" href="classBlockedArray.html#f644816031ed873236fef0ef9ce86e25">Block</a>(v);
<a name="l00481"></a>00481                 <span class="keywordtype">int</span> ou = <a class="code" href="classBlockedArray.html#2159ba9a6e6fbf96d58dc87c083ac68c">Offset</a>(u), ov = <a class="code" href="classBlockedArray.html#2159ba9a6e6fbf96d58dc87c083ac68c">Offset</a>(v);
<a name="l00482"></a>00482                 <span class="keywordtype">int</span> offset = <a class="code" href="classBlockedArray.html#6ffa335a93705a6161d62638d2b1b3b2">BlockSize</a>() * <a class="code" href="classBlockedArray.html#6ffa335a93705a6161d62638d2b1b3b2">BlockSize</a>() * (<a class="code" href="classBlockedArray.html#eb518cfe9742b865cdb49f45cffed5b0">uBlocks</a> * bv + bu);
<a name="l00483"></a>00483                 offset += <a class="code" href="classBlockedArray.html#6ffa335a93705a6161d62638d2b1b3b2">BlockSize</a>() * ov + ou;
<a name="l00484"></a>00484                 <span class="keywordflow">return</span> <a class="code" href="classBlockedArray.html#0ad5941b7203f391fae005be2dd37cee">data</a>[offset];
<a name="l00485"></a>00485         }
<a name="l00486"></a><a class="code" href="classBlockedArray.html#3c9fc37f0e02a037b2bc12065becc3be">00486</a>         <span class="keywordtype">void</span> <a class="code" href="classBlockedArray.html#3c9fc37f0e02a037b2bc12065becc3be">GetLinearArray</a>(T *a)<span class="keyword"> const </span>{
<a name="l00487"></a>00487                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> v = 0; v &lt; <a class="code" href="classBlockedArray.html#5d0e0f592958cc054664f5b27096dabb">vRes</a>; ++v)
<a name="l00488"></a>00488                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> u = 0; u &lt; <a class="code" href="classBlockedArray.html#59138889d56a2b14db2385a70d191214">uRes</a>; ++u)
<a name="l00489"></a>00489                                 *a++ = (*<span class="keyword">this</span>)(u, v);
<a name="l00490"></a>00490         }
<a name="l00491"></a>00491 <span class="keyword">private</span>:
<a name="l00492"></a>00492         <span class="comment">// BlockedArray Private Data</span>
<a name="l00493"></a><a class="code" href="classBlockedArray.html#0ad5941b7203f391fae005be2dd37cee">00493</a>         T *<a class="code" href="classBlockedArray.html#0ad5941b7203f391fae005be2dd37cee">data</a>;
<a name="l00494"></a><a class="code" href="classBlockedArray.html#5d0e0f592958cc054664f5b27096dabb">00494</a>         <span class="keywordtype">int</span> <a class="code" href="classBlockedArray.html#59138889d56a2b14db2385a70d191214">uRes</a>, <a class="code" href="classBlockedArray.html#5d0e0f592958cc054664f5b27096dabb">vRes</a>, <a class="code" href="classBlockedArray.html#eb518cfe9742b865cdb49f45cffed5b0">uBlocks</a>;
<a name="l00495"></a>00495 };
<a name="l00496"></a><a class="code" href="structMatrix4x4.html">00496</a> <span class="keyword">struct </span><a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <a class="code" href="structMatrix4x4.html">Matrix4x4</a> : <span class="keyword">public</span> <a class="code" href="classReferenceCounted.html">ReferenceCounted</a> {
<a name="l00497"></a>00497         <span class="comment">// Matrix4x4 Public Methods</span>
<a name="l00498"></a><a class="code" href="structMatrix4x4.html#714a467ba7f85f88ebe3897b5e3580be">00498</a>         <a class="code" href="structMatrix4x4.html">Matrix4x4</a>() {
<a name="l00499"></a>00499                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; ++i)
<a name="l00500"></a>00500                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; ++j)
<a name="l00501"></a>00501                                 <span class="keywordflow">if</span> (i == j) m[i][j] = 1.;
<a name="l00502"></a>00502                                 <span class="keywordflow">else</span> m[i][j] = 0.;
<a name="l00503"></a>00503         }
<a name="l00504"></a>00504         <a class="code" href="structMatrix4x4.html">Matrix4x4</a>(<span class="keywordtype">float</span> mat[4][4]);
<a name="l00505"></a>00505         <a class="code" href="structMatrix4x4.html">Matrix4x4</a>(<span class="keywordtype">float</span> t00, <span class="keywordtype">float</span> t01, <span class="keywordtype">float</span> t02, <span class="keywordtype">float</span> t03,
<a name="l00506"></a>00506                   <span class="keywordtype">float</span> t10, <span class="keywordtype">float</span> t11, <span class="keywordtype">float</span> t12, <span class="keywordtype">float</span> t13,
<a name="l00507"></a>00507                   <span class="keywordtype">float</span> t20, <span class="keywordtype">float</span> t21, <span class="keywordtype">float</span> t22, <span class="keywordtype">float</span> t23,
<a name="l00508"></a>00508                   <span class="keywordtype">float</span> t30, <span class="keywordtype">float</span> t31, <span class="keywordtype">float</span> t32, <span class="keywordtype">float</span> t33);
<a name="l00509"></a>00509         <a class="code" href="classReference.html">Reference&lt;Matrix4x4&gt;</a> Transpose() <span class="keyword">const</span>;
<a name="l00510"></a><a class="code" href="structMatrix4x4.html#8c6c62fc1568d8f2b9b63dc50ee862a1">00510</a>         <span class="keywordtype">void</span> Print(ostream &amp;os)<span class="keyword"> const </span>{
<a name="l00511"></a>00511                 os &lt;&lt; <span class="stringliteral">"[ "</span>;
<a name="l00512"></a>00512                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; ++i) {
<a name="l00513"></a>00513                         os &lt;&lt; <span class="stringliteral">"[ "</span>;
<a name="l00514"></a>00514                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; ++j)  {
<a name="l00515"></a>00515                                 os &lt;&lt; m[i][j];
<a name="l00516"></a>00516                                 <span class="keywordflow">if</span> (j != 3) os &lt;&lt; <span class="stringliteral">", "</span>;
<a name="l00517"></a>00517                         }
<a name="l00518"></a>00518                         os &lt;&lt; <span class="stringliteral">" ] "</span>;
<a name="l00519"></a>00519                 }
<a name="l00520"></a>00520                 os &lt;&lt; <span class="stringliteral">" ] "</span>;
<a name="l00521"></a>00521         }
<a name="l00522"></a>00522         <span class="keyword">static</span> <a class="code" href="classReference.html">Reference&lt;Matrix4x4&gt;</a>
<a name="l00523"></a><a class="code" href="structMatrix4x4.html#02afdc3204111b94a50e70cd6a89656a">00523</a>                 Mul(<span class="keyword">const</span> <a class="code" href="classReference.html">Reference&lt;Matrix4x4&gt;</a> &amp;m1,
<a name="l00524"></a>00524                 <span class="keyword">const</span> <a class="code" href="classReference.html">Reference&lt;Matrix4x4&gt;</a> &amp;m2) {
<a name="l00525"></a>00525                 <span class="keywordtype">float</span> r[4][4];
<a name="l00526"></a>00526                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; ++i)
<a name="l00527"></a>00527                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; ++j)
<a name="l00528"></a>00528                                 r[i][j] = m1-&gt;m[i][0] * m2-&gt;m[0][j] +
<a name="l00529"></a>00529                                           m1-&gt;m[i][1] * m2-&gt;m[1][j] +
<a name="l00530"></a>00530                                           m1-&gt;m[i][2] * m2-&gt;m[2][j] +
<a name="l00531"></a>00531                                           m1-&gt;m[i][3] * m2-&gt;m[3][j];
<a name="l00532"></a>00532                 <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="structMatrix4x4.html">Matrix4x4</a>(r);
<a name="l00533"></a>00533         }
<a name="l00534"></a>00534         <a class="code" href="classReference.html">Reference&lt;Matrix4x4&gt;</a> Inverse() <span class="keyword">const</span>;
<a name="l00535"></a><a class="code" href="structMatrix4x4.html#34704c95239da68cb2c6bfbda06b720f">00535</a>         <span class="keywordtype">float</span> m[4][4];
<a name="l00536"></a>00536 };
<a name="l00537"></a>00537 <span class="comment">// Global Inline Functions</span>
<a name="l00538"></a>00538 <span class="preprocessor">#ifdef NDEBUG</span>
<a name="l00539"></a>00539 <span class="preprocessor"></span><span class="preprocessor">#define Assert(expr) ((void)0)</span>
<a name="l00540"></a>00540 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00541"></a>00541 <span class="preprocessor"></span><span class="preprocessor">#define Assert(expr) \</span>
<a name="l00542"></a>00542 <span class="preprocessor">    ((expr) ? (void)0 : \</span>
<a name="l00543"></a>00543 <span class="preprocessor">                Severe("Assertion \"%s\" failed in %s, line %d", \</span>
<a name="l00544"></a>00544 <span class="preprocessor">               #expr, __FILE__, __LINE__))</span>
<a name="l00545"></a>00545 <span class="preprocessor"></span><span class="preprocessor">#endif // NDEBUG</span>
<a name="l00546"></a><a class="code" href="pbrt_8h.html#0934d1ba879ec4edf23b9c3bc4e52b35">00546</a> <span class="preprocessor"></span><span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#0934d1ba879ec4edf23b9c3bc4e52b35">Lerp</a>(<span class="keywordtype">float</span> t, <span class="keywordtype">float</span> v1, <span class="keywordtype">float</span> v2) {
<a name="l00547"></a>00547         <span class="keywordflow">return</span> (1.f - t) * v1 + t * v2;
<a name="l00548"></a>00548 }
<a name="l00549"></a><a class="code" href="pbrt_8h.html#036098e5cec04b73d8720de12e8e5cd1">00549</a> <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#036098e5cec04b73d8720de12e8e5cd1">Clamp</a>(<span class="keywordtype">float</span> val, <span class="keywordtype">float</span> low, <span class="keywordtype">float</span> high) {
<a name="l00550"></a>00550         <span class="keywordflow">if</span> (val &lt; low) <span class="keywordflow">return</span> low;
<a name="l00551"></a>00551         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &gt; high) <span class="keywordflow">return</span> high;
<a name="l00552"></a>00552         <span class="keywordflow">else</span> <span class="keywordflow">return</span> val;
<a name="l00553"></a>00553 }
<a name="l00554"></a><a class="code" href="pbrt_8h.html#969988fb51f40790d3b7f5e86599fe9c">00554</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="pbrt_8h.html#036098e5cec04b73d8720de12e8e5cd1">Clamp</a>(<span class="keywordtype">int</span> val, <span class="keywordtype">int</span> low, <span class="keywordtype">int</span> high) {
<a name="l00555"></a>00555         <span class="keywordflow">if</span> (val &lt; low) <span class="keywordflow">return</span> low;
<a name="l00556"></a>00556         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &gt; high) <span class="keywordflow">return</span> high;
<a name="l00557"></a>00557         <span class="keywordflow">else</span> <span class="keywordflow">return</span> val;
<a name="l00558"></a>00558 }
<a name="l00559"></a><a class="code" href="pbrt_8h.html#32154d1b92d7e28d67e9c4f8619bb6c2">00559</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="pbrt_8h.html#32154d1b92d7e28d67e9c4f8619bb6c2">Mod</a>(<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b) {
<a name="l00560"></a>00560     <span class="keywordtype">int</span> n = int(a/b);
<a name="l00561"></a>00561     a -= n*b;
<a name="l00562"></a>00562     <span class="keywordflow">if</span> (a &lt; 0)
<a name="l00563"></a>00563         a += b;
<a name="l00564"></a>00564     <span class="keywordflow">return</span> a;
<a name="l00565"></a>00565 }
<a name="l00566"></a><a class="code" href="pbrt_8h.html#12544670622d3fbc783e1cb4d56b3a23">00566</a> <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#12544670622d3fbc783e1cb4d56b3a23">Radians</a>(<span class="keywordtype">float</span> deg) {
<a name="l00567"></a>00567         <span class="keywordflow">return</span> ((<span class="keywordtype">float</span>)<a class="code" href="pbrt_8h.html#e71449b1cc6e6250b91f539153a7a0d3">M_PI</a>/180.f) * deg;
<a name="l00568"></a>00568 }
<a name="l00569"></a><a class="code" href="pbrt_8h.html#01bc1be48d87df4426b0d127dc8fef72">00569</a> <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#01bc1be48d87df4426b0d127dc8fef72">Degrees</a>(<span class="keywordtype">float</span> rad) {
<a name="l00570"></a>00570         <span class="keywordflow">return</span> (180.f/(<span class="keywordtype">float</span>)<a class="code" href="pbrt_8h.html#e71449b1cc6e6250b91f539153a7a0d3">M_PI</a>) * rad;
<a name="l00571"></a>00571 }
<a name="l00572"></a><a class="code" href="pbrt_8h.html#30ecb93f0acfedc03c64d08cc7e44f23">00572</a> <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#30ecb93f0acfedc03c64d08cc7e44f23">Log2</a>(<span class="keywordtype">float</span> x) {
<a name="l00573"></a>00573         <span class="keyword">static</span> <span class="keywordtype">float</span> invLog2 = 1.f / logf(2.f);
<a name="l00574"></a>00574         <span class="keywordflow">return</span> logf(x) * invLog2;
<a name="l00575"></a>00575 }
<a name="l00576"></a><a class="code" href="pbrt_8h.html#8bc246329312fc639a86e37fa937b483">00576</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="pbrt_8h.html#8bc246329312fc639a86e37fa937b483">Log2Int</a>(<span class="keywordtype">float</span> v) {
<a name="l00577"></a>00577 <span class="preprocessor">#if 0</span>
<a name="l00578"></a>00578 <span class="preprocessor"></span>        <span class="keywordflow">return</span> ((*reinterpret_cast&lt;int *&gt;(&amp;v)) &gt;&gt; 23) - 127;
<a name="l00579"></a>00579 <span class="preprocessor">#else</span>
<a name="l00580"></a>00580 <span class="preprocessor"></span><span class="preprocessor">#define _doublemagicroundeps          (.5-1.4e-11)</span>
<a name="l00581"></a>00581 <span class="preprocessor"></span>        <span class="keywordflow">return</span> int(<a class="code" href="pbrt_8h.html#30ecb93f0acfedc03c64d08cc7e44f23">Log2</a>(v) + <a class="code" href="pbrt_8h.html#240cf642ca22c553b81a4dd70ff77d0b">_doublemagicroundeps</a>);
<a name="l00582"></a>00582 <span class="preprocessor">#endif</span>
<a name="l00583"></a>00583 <span class="preprocessor"></span>}
<a name="l00584"></a><a class="code" href="pbrt_8h.html#9ed3e1f1916bf19da23d9fb954d2179a">00584</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="pbrt_8h.html#9ed3e1f1916bf19da23d9fb954d2179a">IsPowerOf2</a>(<span class="keywordtype">int</span> v) {
<a name="l00585"></a>00585         <span class="keywordflow">return</span> (v &amp; (v - 1)) == 0;
<a name="l00586"></a>00586 }
<a name="l00587"></a><a class="code" href="pbrt_8h.html#8d4117d7c2f2056597da264d3c763ec6">00587</a> <span class="keyword">inline</span> <a class="code" href="pbrt_8h.html#c319c165d52643e43249fe003e18bdf3">u_int</a> <a class="code" href="pbrt_8h.html#8d4117d7c2f2056597da264d3c763ec6">RoundUpPow2</a>(<a class="code" href="pbrt_8h.html#c319c165d52643e43249fe003e18bdf3">u_int</a> v) {
<a name="l00588"></a>00588         v--;
<a name="l00589"></a>00589         v |= v &gt;&gt; 1;
<a name="l00590"></a>00590         v |= v &gt;&gt; 2;
<a name="l00591"></a>00591         v |= v &gt;&gt; 4;
<a name="l00592"></a>00592         v |= v &gt;&gt; 8;
<a name="l00593"></a>00593         v |= v &gt;&gt; 16;
<a name="l00594"></a>00594         <span class="keywordflow">return</span> v+1;
<a name="l00595"></a>00595 }
<a name="l00596"></a>00596 <span class="preprocessor">#if (defined(__linux__) &amp;&amp; defined(__i386__)) || defined(WIN32)</span>
<a name="l00597"></a>00597 <span class="preprocessor"></span><span class="comment">//#define FAST_INT 1</span>
<a name="l00598"></a>00598 <span class="preprocessor">#endif</span>
<a name="l00599"></a>00599 <span class="preprocessor"></span><span class="preprocessor">#define _doublemagicroundeps          (.5-1.4e-11)</span>
<a name="l00600"></a>00600 <span class="preprocessor"></span>        <span class="comment">//almost .5f = .5f - 1e^(number of exp bit)</span>
<a name="l00601"></a><a class="code" href="pbrt_8h.html#9fc5ba3cf5304cfa5cf04fe22fa7a0f1">00601</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="pbrt_8h.html#9fc5ba3cf5304cfa5cf04fe22fa7a0f1">Round2Int</a>(<span class="keywordtype">double</span> val) {
<a name="l00602"></a>00602 <span class="preprocessor">#ifdef FAST_INT</span>
<a name="l00603"></a>00603 <span class="preprocessor"></span><span class="preprocessor">#define _doublemagic                    double (6755399441055744.0)</span>
<a name="l00604"></a>00604 <span class="preprocessor"></span>        <span class="comment">//2^52 * 1.5,  uses limited precision to floor</span>
<a name="l00605"></a>00605         val             = val + _doublemagic;
<a name="l00606"></a>00606         <span class="keywordflow">return</span> (reinterpret_cast&lt;long*&gt;(&amp;val))[0];
<a name="l00607"></a>00607 <span class="preprocessor">#else</span>
<a name="l00608"></a>00608 <span class="preprocessor"></span>        <span class="keywordflow">return</span> int (val+<a class="code" href="pbrt_8h.html#240cf642ca22c553b81a4dd70ff77d0b">_doublemagicroundeps</a>);
<a name="l00609"></a>00609 <span class="preprocessor">#endif</span>
<a name="l00610"></a>00610 <span class="preprocessor"></span>}
<a name="l00611"></a><a class="code" href="pbrt_8h.html#83f20d5f659d8dcbbb5623d1f39cf244">00611</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="pbrt_8h.html#83f20d5f659d8dcbbb5623d1f39cf244">Float2Int</a>(<span class="keywordtype">double</span> val) {
<a name="l00612"></a>00612 <span class="preprocessor">#ifdef FAST_INT</span>
<a name="l00613"></a>00613 <span class="preprocessor"></span>        <span class="keywordflow">return</span> (val&lt;0) ?  <a class="code" href="pbrt_8h.html#9fc5ba3cf5304cfa5cf04fe22fa7a0f1">Round2Int</a>(val+<a class="code" href="pbrt_8h.html#240cf642ca22c553b81a4dd70ff77d0b">_doublemagicroundeps</a>) :
<a name="l00614"></a>00614                    <a class="code" href="pbrt_8h.html#9fc5ba3cf5304cfa5cf04fe22fa7a0f1">Round2Int</a>(val-<a class="code" href="pbrt_8h.html#240cf642ca22c553b81a4dd70ff77d0b">_doublemagicroundeps</a>);
<a name="l00615"></a>00615 <span class="preprocessor">#else</span>
<a name="l00616"></a>00616 <span class="preprocessor"></span>        <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)val;
<a name="l00617"></a>00617 <span class="preprocessor">#endif</span>
<a name="l00618"></a>00618 <span class="preprocessor"></span>}
<a name="l00619"></a><a class="code" href="pbrt_8h.html#02648670ea7bf29f5782902cd9aa87c1">00619</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="pbrt_8h.html#02648670ea7bf29f5782902cd9aa87c1">Floor2Int</a>(<span class="keywordtype">double</span> val) {
<a name="l00620"></a>00620 <span class="preprocessor">#ifdef FAST_INT</span>
<a name="l00621"></a>00621 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="pbrt_8h.html#9fc5ba3cf5304cfa5cf04fe22fa7a0f1">Round2Int</a>(val - <a class="code" href="pbrt_8h.html#240cf642ca22c553b81a4dd70ff77d0b">_doublemagicroundeps</a>);
<a name="l00622"></a>00622 <span class="preprocessor">#else</span>
<a name="l00623"></a>00623 <span class="preprocessor"></span>        <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)floor(val);
<a name="l00624"></a>00624 <span class="preprocessor">#endif</span>
<a name="l00625"></a>00625 <span class="preprocessor"></span>}
<a name="l00626"></a><a class="code" href="pbrt_8h.html#1a941973fe233e9e8179a48dff4115c8">00626</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="pbrt_8h.html#1a941973fe233e9e8179a48dff4115c8">Ceil2Int</a>(<span class="keywordtype">double</span> val) {
<a name="l00627"></a>00627 <span class="preprocessor">#ifdef FAST_INT</span>
<a name="l00628"></a>00628 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="pbrt_8h.html#9fc5ba3cf5304cfa5cf04fe22fa7a0f1">Round2Int</a>(val + <a class="code" href="pbrt_8h.html#240cf642ca22c553b81a4dd70ff77d0b">_doublemagicroundeps</a>);
<a name="l00629"></a>00629 <span class="preprocessor">#else</span>
<a name="l00630"></a>00630 <span class="preprocessor"></span>        <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)ceil(val);
<a name="l00631"></a>00631 <span class="preprocessor">#endif</span>
<a name="l00632"></a>00632 <span class="preprocessor"></span>}
<a name="l00633"></a>00633 <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#4f11994534b888fcf650c04b5d61d9d4">RandomFloat</a>();
<a name="l00634"></a>00634 <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="pbrt_8h.html#0b19ac053a77733b5f46cab820da5df5">RandomUInt</a>();
<a name="l00635"></a><a class="code" href="pbrt_8h.html#4f11994534b888fcf650c04b5d61d9d4">00635</a> <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#4f11994534b888fcf650c04b5d61d9d4">RandomFloat</a>() {
<a name="l00636"></a>00636         <span class="keywordflow">return</span> <a class="code" href="pbrt_8h.html#2c84e6fc3b8989a8ca6f415aa5585e24">genrand_real2</a>();
<a name="l00637"></a>00637 }
<a name="l00638"></a>00638 
<a name="l00639"></a><a class="code" href="pbrt_8h.html#0b19ac053a77733b5f46cab820da5df5">00639</a> <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="pbrt_8h.html#0b19ac053a77733b5f46cab820da5df5">RandomUInt</a>() {
<a name="l00640"></a>00640         <span class="keywordflow">return</span> <a class="code" href="pbrt_8h.html#24bf150b5ab536c63e57b778e0cc6a9d">genrand_int32</a>();
<a name="l00641"></a>00641 }
<a name="l00642"></a><a class="code" href="pbrt_8h.html#14bbcf80fc40915df82a84e6eb2dfb3b">00642</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="pbrt_8h.html#14bbcf80fc40915df82a84e6eb2dfb3b">Quadratic</a>(<span class="keywordtype">float</span> A, <span class="keywordtype">float</span> B, <span class="keywordtype">float</span> C, <span class="keywordtype">float</span> *t0,
<a name="l00643"></a>00643                 <span class="keywordtype">float</span> *t1) {
<a name="l00644"></a>00644         <span class="comment">// Find quadratic discriminant</span>
<a name="l00645"></a>00645         <span class="keywordtype">float</span> discrim = B * B - 4.f * A * C;
<a name="l00646"></a>00646         <span class="keywordflow">if</span> (discrim &lt; 0.) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00647"></a>00647         <span class="keywordtype">float</span> rootDiscrim = sqrtf(discrim);
<a name="l00648"></a>00648         <span class="comment">// Compute quadratic _t_ values</span>
<a name="l00649"></a>00649         <span class="keywordtype">float</span> q;
<a name="l00650"></a>00650         <span class="keywordflow">if</span> (B &lt; 0) q = -.5f * (B - rootDiscrim);
<a name="l00651"></a>00651         <span class="keywordflow">else</span>       q = -.5f * (B + rootDiscrim);
<a name="l00652"></a>00652         *t0 = q / A;
<a name="l00653"></a>00653         *t1 = C / q;
<a name="l00654"></a>00654         <span class="keywordflow">if</span> (*t0 &gt; *t1) swap(*t0, *t1);
<a name="l00655"></a>00655         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00656"></a>00656 }
<a name="l00657"></a><a class="code" href="pbrt_8h.html#332172a54ac2930e10f7a5c446cb712d">00657</a> <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#332172a54ac2930e10f7a5c446cb712d">SmoothStep</a>(<span class="keywordtype">float</span> min, <span class="keywordtype">float</span> max, <span class="keywordtype">float</span> value) {
<a name="l00658"></a>00658         <span class="keywordtype">float</span> v = <a class="code" href="pbrt_8h.html#036098e5cec04b73d8720de12e8e5cd1">Clamp</a>((value - min) / (max - min), 0.f, 1.f);
<a name="l00659"></a>00659         <span class="keywordflow">return</span> v * v * (-2.f * v  + 3.f);
<a name="l00660"></a>00660 }
<a name="l00661"></a><a class="code" href="pbrt_8h.html#26c3f0f1209fd3ae798f96096348150a">00661</a> <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#26c3f0f1209fd3ae798f96096348150a">ExponentialAverage</a>(<span class="keywordtype">float</span> avg,
<a name="l00662"></a>00662                               <span class="keywordtype">float</span> val, <span class="keywordtype">float</span> alpha) {
<a name="l00663"></a>00663         <span class="keywordflow">return</span> (1.f - alpha) * val + alpha * avg;
<a name="l00664"></a>00664 }
<a name="l00665"></a>00665 <span class="preprocessor">#endif // PBRT_PBRT_H</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Jul 20 17:31:53 2009 for pbrt by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
