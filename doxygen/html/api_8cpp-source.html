<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>pbrt: api.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>api.cpp</h1><a href="api_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment">    pbrt source code Copyright(c) 1998-2007 Matt Pharr and Greg Humphreys.</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">    This file is part of pbrt.</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">    pbrt is free software; you can redistribute it and/or modify</span>
<a name="l00008"></a>00008 <span class="comment">    it under the terms of the GNU General Public License as published by</span>
<a name="l00009"></a>00009 <span class="comment">    the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00010"></a>00010 <span class="comment">    (at your option) any later version.  Note that the text contents of</span>
<a name="l00011"></a>00011 <span class="comment">    the book "Physically Based Rendering" are *not* licensed under the</span>
<a name="l00012"></a>00012 <span class="comment">    GNU GPL.</span>
<a name="l00013"></a>00013 <span class="comment"></span>
<a name="l00014"></a>00014 <span class="comment">    pbrt is distributed in the hope that it will be useful,</span>
<a name="l00015"></a>00015 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00017"></a>00017 <span class="comment">    GNU General Public License for more details.</span>
<a name="l00018"></a>00018 <span class="comment"></span>
<a name="l00019"></a>00019 <span class="comment">    You should have received a copy of the GNU General Public License</span>
<a name="l00020"></a>00020 <span class="comment">    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00021"></a>00021 <span class="comment"></span>
<a name="l00022"></a>00022 <span class="comment"> */</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="comment">// api.cpp*</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include "<a class="code" href="api_8h.html">api.h</a>"</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="paramset_8h.html">paramset.h</a>"</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include "<a class="code" href="color_8h.html">color.h</a>"</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include "<a class="code" href="scene_8h.html">scene.h</a>"</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include "<a class="code" href="film_8h.html">film.h</a>"</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include "<a class="code" href="dynload_8h.html">dynload.h</a>"</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include "<a class="code" href="volume_8h.html">volume.h</a>"</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00033"></a>00033 <span class="keyword">using</span> std::map;
<a name="l00034"></a>00034 <span class="preprocessor">#if (_MSC_VER &gt;= 1400) // NOBOOK</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdio.h&gt;</span>     <span class="comment">// NOBOOK</span>
<a name="l00036"></a>00036 <span class="preprocessor">#define snprintf _snprintf // NOBOOK</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#endif // NOBOOK</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="comment">// API Local Classes</span>
<a name="l00039"></a><a class="code" href="structRenderOptions.html">00039</a> <span class="keyword">struct </span><a class="code" href="structRenderOptions.html">RenderOptions</a> {
<a name="l00040"></a>00040         <span class="comment">// RenderOptions Public Methods</span>
<a name="l00041"></a>00041         <a class="code" href="structRenderOptions.html#162126154e04dd34bf8fc88dc44d2ad7">RenderOptions</a>();
<a name="l00042"></a>00042         <a class="code" href="classScene.html">Scene</a> *<a class="code" href="structRenderOptions.html#8cfdd83e33309d808f6209ed975ae6f1">MakeScene</a>() <span class="keyword">const</span>;
<a name="l00043"></a>00043         <span class="comment">// RenderOptions Public Data</span>
<a name="l00044"></a><a class="code" href="structRenderOptions.html#69951a3a45c1c90b726031f824282ccf">00044</a>         <span class="keywordtype">string</span> <a class="code" href="structRenderOptions.html#69951a3a45c1c90b726031f824282ccf">FilterName</a>;
<a name="l00045"></a><a class="code" href="structRenderOptions.html#d5ceeeca176d0950ffb96314e34bdb57">00045</a>         <a class="code" href="classParamSet.html">ParamSet</a> <a class="code" href="structRenderOptions.html#d5ceeeca176d0950ffb96314e34bdb57">FilterParams</a>;
<a name="l00046"></a><a class="code" href="structRenderOptions.html#2cfa0eb4a03160527636158889948937">00046</a>         <span class="keywordtype">string</span> <a class="code" href="structRenderOptions.html#2cfa0eb4a03160527636158889948937">FilmName</a>;
<a name="l00047"></a><a class="code" href="structRenderOptions.html#c299d707a7b2e483ee6c6d68d2e417a5">00047</a>         <a class="code" href="classParamSet.html">ParamSet</a> <a class="code" href="structRenderOptions.html#c299d707a7b2e483ee6c6d68d2e417a5">FilmParams</a>;
<a name="l00048"></a><a class="code" href="structRenderOptions.html#642623bc1506b10cfde0b78c20d89bd9">00048</a>         <span class="keywordtype">string</span> <a class="code" href="structRenderOptions.html#642623bc1506b10cfde0b78c20d89bd9">SamplerName</a>;
<a name="l00049"></a><a class="code" href="structRenderOptions.html#450098350cda7a080afeba444bd7bd2a">00049</a>         <a class="code" href="classParamSet.html">ParamSet</a> <a class="code" href="structRenderOptions.html#450098350cda7a080afeba444bd7bd2a">SamplerParams</a>;
<a name="l00050"></a><a class="code" href="structRenderOptions.html#eb46e92ded99bfb0a225adb3920bb81c">00050</a>         <span class="keywordtype">string</span> <a class="code" href="structRenderOptions.html#eb46e92ded99bfb0a225adb3920bb81c">AcceleratorName</a>;
<a name="l00051"></a><a class="code" href="structRenderOptions.html#15aca450e40896f79ff59c07a64c6203">00051</a>         <a class="code" href="classParamSet.html">ParamSet</a> <a class="code" href="structRenderOptions.html#15aca450e40896f79ff59c07a64c6203">AcceleratorParams</a>;
<a name="l00052"></a><a class="code" href="structRenderOptions.html#052b8fa0982555d2625e1315abb94206">00052</a>         <span class="keywordtype">string</span> <a class="code" href="structRenderOptions.html#1573a042451ce0a079daf6bff4220dce">SurfIntegratorName</a>, <a class="code" href="structRenderOptions.html#052b8fa0982555d2625e1315abb94206">VolIntegratorName</a>;
<a name="l00053"></a><a class="code" href="structRenderOptions.html#0aa936754ee5e53126f4d8a9ac11278a">00053</a>         <a class="code" href="classParamSet.html">ParamSet</a> <a class="code" href="structRenderOptions.html#c8a050d927fef360add342440922a3c3">SurfIntegratorParams</a>, <a class="code" href="structRenderOptions.html#0aa936754ee5e53126f4d8a9ac11278a">VolIntegratorParams</a>;
<a name="l00054"></a><a class="code" href="structRenderOptions.html#80485d92c3288993a393646a98f752f8">00054</a>         <span class="keywordtype">string</span> <a class="code" href="structRenderOptions.html#80485d92c3288993a393646a98f752f8">CameraName</a>;
<a name="l00055"></a><a class="code" href="structRenderOptions.html#4150486bffb1899d99b6521e509fe059">00055</a>         <a class="code" href="classParamSet.html">ParamSet</a> <a class="code" href="structRenderOptions.html#4150486bffb1899d99b6521e509fe059">CameraParams</a>;
<a name="l00056"></a><a class="code" href="structRenderOptions.html#80dad5bbb9b375a1caf2714936ec2415">00056</a>         <a class="code" href="classTransform.html">Transform</a> <a class="code" href="structRenderOptions.html#80dad5bbb9b375a1caf2714936ec2415">WorldToCamera</a>;
<a name="l00057"></a><a class="code" href="structRenderOptions.html#7d9834c051b384033479387ed35bcc1e">00057</a>         <span class="keywordtype">bool</span> <a class="code" href="structRenderOptions.html#7d9834c051b384033479387ed35bcc1e">gotSearchPath</a>;
<a name="l00058"></a><a class="code" href="structRenderOptions.html#20d3a070ca4db89e8217b26b063d3f8c">00058</a>         <span class="keyword">mutable</span> vector&lt;Light *&gt; <a class="code" href="structRenderOptions.html#20d3a070ca4db89e8217b26b063d3f8c">lights</a>;
<a name="l00059"></a><a class="code" href="structRenderOptions.html#2e0ee53c051e1df5a1c70e4f69784d57">00059</a>         <span class="keyword">mutable</span> vector&lt;Reference&lt;Primitive&gt; &gt; <a class="code" href="structRenderOptions.html#2e0ee53c051e1df5a1c70e4f69784d57">primitives</a>;
<a name="l00060"></a><a class="code" href="structRenderOptions.html#35086e28667947f41eb7f2a5c3ef7e34">00060</a>         <span class="keyword">mutable</span> vector&lt;VolumeRegion *&gt; <a class="code" href="structRenderOptions.html#35086e28667947f41eb7f2a5c3ef7e34">volumeRegions</a>;
<a name="l00061"></a><a class="code" href="structRenderOptions.html#e079c03a8323592e076c9886acd7e458">00061</a>         map&lt;string, vector&lt;Reference&lt;Primitive&gt; &gt; &gt; <a class="code" href="structRenderOptions.html#e079c03a8323592e076c9886acd7e458">instances</a>;
<a name="l00062"></a><a class="code" href="structRenderOptions.html#de89b794a25c6e0bda54f5e2d2018c09">00062</a>         vector&lt;Reference&lt;Primitive&gt; &gt; *<a class="code" href="structRenderOptions.html#de89b794a25c6e0bda54f5e2d2018c09">currentInstance</a>;
<a name="l00063"></a>00063 };
<a name="l00064"></a><a class="code" href="structRenderOptions.html#162126154e04dd34bf8fc88dc44d2ad7">00064</a> <a class="code" href="structRenderOptions.html#162126154e04dd34bf8fc88dc44d2ad7">RenderOptions::RenderOptions</a>() {
<a name="l00065"></a>00065         <span class="comment">// RenderOptions Constructor Implementation</span>
<a name="l00066"></a>00066         <a class="code" href="structRenderOptions.html#69951a3a45c1c90b726031f824282ccf">FilterName</a> = <span class="stringliteral">"mitchell"</span>;
<a name="l00067"></a>00067         <a class="code" href="structRenderOptions.html#2cfa0eb4a03160527636158889948937">FilmName</a> = <span class="stringliteral">"image"</span>;
<a name="l00068"></a>00068         <a class="code" href="structRenderOptions.html#642623bc1506b10cfde0b78c20d89bd9">SamplerName</a> = <span class="stringliteral">"bestcandidate"</span>;
<a name="l00069"></a>00069         <a class="code" href="structRenderOptions.html#eb46e92ded99bfb0a225adb3920bb81c">AcceleratorName</a> = <span class="stringliteral">"kdtree"</span>;
<a name="l00070"></a>00070         <a class="code" href="structRenderOptions.html#1573a042451ce0a079daf6bff4220dce">SurfIntegratorName</a> = <span class="stringliteral">"directlighting"</span>;
<a name="l00071"></a>00071         <a class="code" href="structRenderOptions.html#052b8fa0982555d2625e1315abb94206">VolIntegratorName</a> = <span class="stringliteral">"emission"</span>;
<a name="l00072"></a>00072         <a class="code" href="structRenderOptions.html#80485d92c3288993a393646a98f752f8">CameraName</a> = <span class="stringliteral">"perspective"</span>;
<a name="l00073"></a>00073         <span class="keywordtype">char</span> *searchEnv = getenv(<span class="stringliteral">"PBRT_SEARCHPATH"</span>);
<a name="l00074"></a>00074         <span class="keywordflow">if</span> (searchEnv == NULL) {
<a name="l00075"></a>00075                 <a class="code" href="pbrt_8h.html#79abc2e750c4774bd9d433ad4f6e440a">Warning</a>(<span class="stringliteral">"PBRT_SEARCHPATH not set in your environment.\n"</span>
<a name="l00076"></a>00076                           <span class="stringliteral">"pbrt won't be able to find plugins if "</span>
<a name="l00077"></a>00077                           <span class="stringliteral">"no SearchPath in input file.\n"</span>
<a name="l00078"></a>00078                           <span class="stringliteral">"PBRT_SEARCHPATH should be a "</span>
<a name="l00079"></a>00079                           <span class="stringliteral">"\"%s\"-separated list of directories.\n"</span>,
<a name="l00080"></a>00080                           <a class="code" href="pbrt_8h.html#001481305b57b832d47b5c4d13fbfaac">PBRT_PATH_SEP</a>);
<a name="l00081"></a>00081                 <a class="code" href="structRenderOptions.html#7d9834c051b384033479387ed35bcc1e">gotSearchPath</a> = <span class="keyword">false</span>;
<a name="l00082"></a>00082         }
<a name="l00083"></a>00083         <span class="keywordflow">else</span> {
<a name="l00084"></a>00084                 <a class="code" href="dynload_8cpp.html#d4a57de81006840d59119e3a59e40891">UpdatePluginPath</a>(searchEnv);
<a name="l00085"></a>00085                 <a class="code" href="structRenderOptions.html#7d9834c051b384033479387ed35bcc1e">gotSearchPath</a> = <span class="keyword">true</span>;
<a name="l00086"></a>00086         }
<a name="l00087"></a>00087         <a class="code" href="structRenderOptions.html#de89b794a25c6e0bda54f5e2d2018c09">currentInstance</a> = NULL;
<a name="l00088"></a>00088 }
<a name="l00089"></a><a class="code" href="structGraphicsState.html">00089</a> <span class="keyword">struct </span><a class="code" href="structGraphicsState.html">GraphicsState</a> {
<a name="l00090"></a>00090         <span class="comment">// Graphics State Methods</span>
<a name="l00091"></a>00091         <a class="code" href="structGraphicsState.html">GraphicsState</a>();
<a name="l00092"></a>00092         <span class="comment">// Graphics State</span>
<a name="l00093"></a>00093         map&lt;string, Reference&lt;Texture&lt;float&gt; &gt; &gt;
<a name="l00094"></a><a class="code" href="structGraphicsState.html#4141b59e6b3d511e756c429d9e899025">00094</a>                 floatTextures;
<a name="l00095"></a>00095         map&lt;string, Reference&lt;Texture&lt;Spectrum&gt; &gt; &gt;
<a name="l00096"></a><a class="code" href="structGraphicsState.html#cf5b1f08c66249ada4d171c4e5b3e93a">00096</a>                 spectrumTextures;
<a name="l00097"></a><a class="code" href="structGraphicsState.html#15e5a40a5ff7f95f7a607f1f62f3bcd9">00097</a>         <a class="code" href="classParamSet.html">ParamSet</a> materialParams;
<a name="l00098"></a><a class="code" href="structGraphicsState.html#b9c4d0e4d465a5568a2413a7684ab66f">00098</a>         <span class="keywordtype">string</span> material;
<a name="l00099"></a><a class="code" href="structGraphicsState.html#3bc61d43d94cdf152056e5715d40351e">00099</a>         <a class="code" href="classParamSet.html">ParamSet</a> areaLightParams;
<a name="l00100"></a><a class="code" href="structGraphicsState.html#d3aec9365b7cd90799c07a675e33e9be">00100</a>         <span class="keywordtype">string</span> areaLight;
<a name="l00101"></a><a class="code" href="structGraphicsState.html#47ad509ac073cfe4ec9276ae9441461f">00101</a>         <span class="keywordtype">bool</span> reverseOrientation;
<a name="l00102"></a>00102 };
<a name="l00103"></a><a class="code" href="structGraphicsState.html#f874a670da3c37fbb8b3f7f07ec7e3df">00103</a> <a class="code" href="structGraphicsState.html#f874a670da3c37fbb8b3f7f07ec7e3df">GraphicsState::GraphicsState</a>() {
<a name="l00104"></a>00104         <span class="comment">// GraphicsState Constructor Implementation</span>
<a name="l00105"></a>00105         <a class="code" href="structGraphicsState.html#b9c4d0e4d465a5568a2413a7684ab66f">material</a> = <span class="stringliteral">"matte"</span>;
<a name="l00106"></a>00106         <a class="code" href="structGraphicsState.html#47ad509ac073cfe4ec9276ae9441461f">reverseOrientation</a> = <span class="keyword">false</span>;
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 <span class="comment">// API Static Data</span>
<a name="l00109"></a><a class="code" href="api_8cpp.html#5a44bd3e52f2369ff13bbbe544ff4a18">00109</a> <span class="preprocessor">#define STATE_UNINITIALIZED  0</span>
<a name="l00110"></a><a class="code" href="api_8cpp.html#962103b145f2a6f97822f310c6b1dff4">00110</a> <span class="preprocessor"></span><span class="preprocessor">#define STATE_OPTIONS_BLOCK  1</span>
<a name="l00111"></a><a class="code" href="api_8cpp.html#d420c228378d3e4fd96df3d0e42b391c">00111</a> <span class="preprocessor"></span><span class="preprocessor">#define STATE_WORLD_BLOCK    2</span>
<a name="l00112"></a><a class="code" href="api_8cpp.html#a92c19c4edc1452e4e3c599b7a7b1f62">00112</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="api_8cpp.html#a92c19c4edc1452e4e3c599b7a7b1f62">currentApiState</a> = <a class="code" href="api_8cpp.html#5a44bd3e52f2369ff13bbbe544ff4a18">STATE_UNINITIALIZED</a>;
<a name="l00113"></a><a class="code" href="api_8cpp.html#105dd8091b984d87bdc5de9607c1d058">00113</a> <span class="keyword">static</span> <a class="code" href="classTransform.html">Transform</a> <a class="code" href="api_8cpp.html#105dd8091b984d87bdc5de9607c1d058">curTransform</a>;
<a name="l00114"></a><a class="code" href="api_8cpp.html#52a67d80b6075dd954a09bc7b9d57db9">00114</a> <span class="keyword">static</span> map&lt;string, Transform&gt; <a class="code" href="api_8cpp.html#52a67d80b6075dd954a09bc7b9d57db9">namedCoordinateSystems</a>;
<a name="l00115"></a><a class="code" href="api_8cpp.html#3738de70ce459699d295b681fb2c118a">00115</a> <span class="keyword">static</span> <a class="code" href="structRenderOptions.html">RenderOptions</a> *<a class="code" href="api_8cpp.html#3738de70ce459699d295b681fb2c118a">renderOptions</a> = NULL;
<a name="l00116"></a><a class="code" href="api_8cpp.html#bd92c80979c55dc7d5eea58f645fe7d8">00116</a> <span class="keyword">static</span> <a class="code" href="structGraphicsState.html">GraphicsState</a> <a class="code" href="api_8cpp.html#bd92c80979c55dc7d5eea58f645fe7d8">graphicsState</a>;
<a name="l00117"></a><a class="code" href="api_8cpp.html#eb9b707b65603278aeaed7bb1c5fb1b1">00117</a> <span class="keyword">static</span> vector&lt;GraphicsState&gt; <a class="code" href="api_8cpp.html#eb9b707b65603278aeaed7bb1c5fb1b1">pushedGraphicsStates</a>;
<a name="l00118"></a><a class="code" href="api_8cpp.html#465158e53ec374a4f5e72dabcf5fbb85">00118</a> <span class="keyword">static</span> vector&lt;Transform&gt; <a class="code" href="api_8cpp.html#465158e53ec374a4f5e72dabcf5fbb85">pushedTransforms</a>;
<a name="l00119"></a>00119 <span class="comment">// API Macros</span>
<a name="l00120"></a><a class="code" href="api_8cpp.html#9d6c4d637cd063971c84b219d4dfa4c2">00120</a> <span class="preprocessor">#define VERIFY_INITIALIZED(func) \</span>
<a name="l00121"></a>00121 <span class="preprocessor">if (currentApiState == STATE_UNINITIALIZED) { \</span>
<a name="l00122"></a>00122 <span class="preprocessor">        Error("pbrtInit() must be before calling \"%s()\". " \</span>
<a name="l00123"></a>00123 <span class="preprocessor">                "Ignoring.", func); \</span>
<a name="l00124"></a>00124 <span class="preprocessor">        return; \</span>
<a name="l00125"></a>00125 <span class="preprocessor">} else </span><span class="comment">/* swallow trailing semicolon */</span>
<a name="l00126"></a><a class="code" href="api_8cpp.html#bc77914d12b4dacad28d57d15c8830d8">00126</a> <span class="preprocessor">#define VERIFY_OPTIONS(func) \</span>
<a name="l00127"></a>00127 <span class="preprocessor">VERIFY_INITIALIZED(func); \</span>
<a name="l00128"></a>00128 <span class="preprocessor">if (currentApiState == STATE_WORLD_BLOCK) { \</span>
<a name="l00129"></a>00129 <span class="preprocessor">        Error("Options cannot be set inside world block; " \</span>
<a name="l00130"></a>00130 <span class="preprocessor">                "\"%s\" not allowed.  Ignoring.", func); \</span>
<a name="l00131"></a>00131 <span class="preprocessor">        return; \</span>
<a name="l00132"></a>00132 <span class="preprocessor">} else </span><span class="comment">/* swallow trailing semicolon */</span>
<a name="l00133"></a><a class="code" href="api_8cpp.html#6393c87c46e2e5a4300f2750684e3213">00133</a> <span class="preprocessor">#define VERIFY_WORLD(func) \</span>
<a name="l00134"></a>00134 <span class="preprocessor">VERIFY_INITIALIZED(func); \</span>
<a name="l00135"></a>00135 <span class="preprocessor">if (currentApiState == STATE_OPTIONS_BLOCK) { \</span>
<a name="l00136"></a>00136 <span class="preprocessor">        Error("Scene description must be inside world block; " \</span>
<a name="l00137"></a>00137 <span class="preprocessor">                "\"%s\" not allowed. Ignoring.", func); \</span>
<a name="l00138"></a>00138 <span class="preprocessor">        return; \</span>
<a name="l00139"></a>00139 <span class="preprocessor">} else </span><span class="comment">/* swallow trailing semicolon */</span>
<a name="l00140"></a>00140 <span class="comment">// API Function Definitions</span>
<a name="l00141"></a><a class="code" href="pbrt_8h.html#e5c3f1cdb2efaf34dc857fc7f54aea80">00141</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#e5c3f1cdb2efaf34dc857fc7f54aea80">pbrtInit</a>() {
<a name="l00142"></a>00142         <span class="comment">// System-wide initialization</span>
<a name="l00143"></a>00143         <span class="comment">// Make sure floating point unit's rounding stuff is set</span>
<a name="l00144"></a>00144         <span class="comment">// as is expected by the fast FP-conversion routines.  In particular,</span>
<a name="l00145"></a>00145         <span class="comment">// we want double precision on Linux, not extended precision!</span>
<a name="l00146"></a>00146 <span class="preprocessor">        #ifdef FAST_INT</span>
<a name="l00147"></a>00147 <span class="preprocessor"></span><span class="preprocessor">        #if defined(__linux__) &amp;&amp; defined(__i386__)</span>
<a name="l00148"></a>00148 <span class="preprocessor"></span>        <span class="keywordtype">int</span> cword = _FPU_MASK_DM | _FPU_MASK_ZM | _FPU_MASK_OM | _FPU_MASK_PM |
<a name="l00149"></a>00149                 _FPU_MASK_UM | _FPU_MASK_IM | _FPU_DOUBLE | _FPU_RC_NEAREST;
<a name="l00150"></a>00150         _FPU_SETCW(cword);
<a name="l00151"></a>00151 <span class="preprocessor">        #endif</span>
<a name="l00152"></a>00152 <span class="preprocessor"></span><span class="preprocessor">        #if defined(WIN32)</span>
<a name="l00153"></a>00153 <span class="preprocessor"></span>        _control87(_PC_53, MCW_PC);
<a name="l00154"></a>00154 <span class="preprocessor">        #endif</span>
<a name="l00155"></a>00155 <span class="preprocessor"></span><span class="preprocessor">        #endif // FAST_INT</span>
<a name="l00156"></a>00156 <span class="preprocessor"></span>        <span class="comment">// API Initialization</span>
<a name="l00157"></a>00157         <span class="keywordflow">if</span> (<a class="code" href="api_8cpp.html#a92c19c4edc1452e4e3c599b7a7b1f62">currentApiState</a> != <a class="code" href="api_8cpp.html#5a44bd3e52f2369ff13bbbe544ff4a18">STATE_UNINITIALIZED</a>)
<a name="l00158"></a>00158                 <a class="code" href="pbrt_8h.html#d1a16fc9ced4ddc376b9d3e6607be15e">Error</a>(<span class="stringliteral">"pbrtInit() has already been called."</span>);
<a name="l00159"></a>00159         <a class="code" href="api_8cpp.html#a92c19c4edc1452e4e3c599b7a7b1f62">currentApiState</a> = <a class="code" href="api_8cpp.html#962103b145f2a6f97822f310c6b1dff4">STATE_OPTIONS_BLOCK</a>;
<a name="l00160"></a>00160         renderOptions = <span class="keyword">new</span> <a class="code" href="structRenderOptions.html">RenderOptions</a>;
<a name="l00161"></a>00161         graphicsState = <a class="code" href="structGraphicsState.html#f874a670da3c37fbb8b3f7f07ec7e3df">GraphicsState</a>();
<a name="l00162"></a>00162 }
<a name="l00163"></a><a class="code" href="pbrt_8h.html#139af3183189ca0486eec421b13d3ff2">00163</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#139af3183189ca0486eec421b13d3ff2">pbrtCleanup</a>() {
<a name="l00164"></a>00164         <a class="code" href="pbrt_8h.html#c1f912df42c2ae7d595973b17901a8f6">StatsCleanup</a>();
<a name="l00165"></a>00165         <span class="comment">// API Cleanup</span>
<a name="l00166"></a>00166         <span class="keywordflow">if</span> (<a class="code" href="api_8cpp.html#a92c19c4edc1452e4e3c599b7a7b1f62">currentApiState</a> == <a class="code" href="api_8cpp.html#5a44bd3e52f2369ff13bbbe544ff4a18">STATE_UNINITIALIZED</a>)
<a name="l00167"></a>00167                 <a class="code" href="pbrt_8h.html#d1a16fc9ced4ddc376b9d3e6607be15e">Error</a>(<span class="stringliteral">"pbrtCleanup() called without pbrtInit()."</span>);
<a name="l00168"></a>00168         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="api_8cpp.html#a92c19c4edc1452e4e3c599b7a7b1f62">currentApiState</a> == <a class="code" href="api_8cpp.html#d420c228378d3e4fd96df3d0e42b391c">STATE_WORLD_BLOCK</a>)
<a name="l00169"></a>00169                 <a class="code" href="pbrt_8h.html#d1a16fc9ced4ddc376b9d3e6607be15e">Error</a>(<span class="stringliteral">"pbrtCleanup() called while inside world block."</span>);
<a name="l00170"></a>00170         <a class="code" href="api_8cpp.html#a92c19c4edc1452e4e3c599b7a7b1f62">currentApiState</a> = <a class="code" href="api_8cpp.html#5a44bd3e52f2369ff13bbbe544ff4a18">STATE_UNINITIALIZED</a>;
<a name="l00171"></a>00171         <span class="keyword">delete</span> renderOptions;
<a name="l00172"></a>00172         renderOptions = NULL;
<a name="l00173"></a>00173 }
<a name="l00174"></a><a class="code" href="api_8h.html#5895a74255fb973a0ac47a6ebf7e76bd">00174</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#5895a74255fb973a0ac47a6ebf7e76bd">pbrtIdentity</a>() {
<a name="l00175"></a>00175         <a class="code" href="api_8cpp.html#9d6c4d637cd063971c84b219d4dfa4c2">VERIFY_INITIALIZED</a>(<span class="stringliteral">"Identity"</span>);
<a name="l00176"></a>00176         curTransform = <a class="code" href="classTransform.html">Transform</a>();
<a name="l00177"></a>00177 }
<a name="l00178"></a><a class="code" href="api_8h.html#23daf192c5660281e4822980b661b8f9">00178</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#23daf192c5660281e4822980b661b8f9">pbrtTranslate</a>(<span class="keywordtype">float</span> dx, <span class="keywordtype">float</span> dy, <span class="keywordtype">float</span> dz) {
<a name="l00179"></a>00179         <a class="code" href="api_8cpp.html#9d6c4d637cd063971c84b219d4dfa4c2">VERIFY_INITIALIZED</a>(<span class="stringliteral">"Translate"</span>);
<a name="l00180"></a>00180         curTransform =
<a name="l00181"></a>00181                 curTransform * <a class="code" href="pbrt_8h.html#dcfb331b19053e5b60008c68e78f7b81">Translate</a>(<a class="code" href="classVector.html">Vector</a>(dx, dy, dz));
<a name="l00182"></a>00182 }
<a name="l00183"></a><a class="code" href="api_8h.html#0235526d819159c06a003f1a4be430a5">00183</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#91baa8e65470296c345bd02c964d747e">pbrtTransform</a>(<span class="keywordtype">float</span> tr[16]) {
<a name="l00184"></a>00184         <a class="code" href="api_8cpp.html#9d6c4d637cd063971c84b219d4dfa4c2">VERIFY_INITIALIZED</a>(<span class="stringliteral">"Transform"</span>);
<a name="l00185"></a>00185         curTransform = <a class="code" href="classTransform.html">Transform</a>(<span class="keyword">new</span> <a class="code" href="structMatrix4x4.html">Matrix4x4</a>(
<a name="l00186"></a>00186                 tr[0], tr[4], tr[8], tr[12],
<a name="l00187"></a>00187                 tr[1], tr[5], tr[9], tr[13],
<a name="l00188"></a>00188                 tr[2], tr[6], tr[10], tr[14],
<a name="l00189"></a>00189                 tr[3], tr[7], tr[11], tr[15]));
<a name="l00190"></a>00190 }
<a name="l00191"></a><a class="code" href="api_8h.html#d33ea4d6b718c5608f71ebc64537eb57">00191</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#3d2d67a2b6589461cde666ff07f7dfd7">pbrtConcatTransform</a>(<span class="keywordtype">float</span> tr[16]) {
<a name="l00192"></a>00192         <a class="code" href="api_8cpp.html#9d6c4d637cd063971c84b219d4dfa4c2">VERIFY_INITIALIZED</a>(<span class="stringliteral">"ConcatTransform"</span>);
<a name="l00193"></a>00193         curTransform = curTransform * <a class="code" href="classTransform.html">Transform</a>(
<a name="l00194"></a>00194                 <span class="keyword">new</span> <a class="code" href="structMatrix4x4.html">Matrix4x4</a>(tr[0], tr[4], tr[8], tr[12],
<a name="l00195"></a>00195                                  tr[1], tr[5], tr[9], tr[13],
<a name="l00196"></a>00196                                  tr[2], tr[6], tr[10], tr[14],
<a name="l00197"></a>00197                                  tr[3], tr[7], tr[11], tr[15]));
<a name="l00198"></a>00198 }
<a name="l00199"></a><a class="code" href="api_8h.html#a5cf095c361ead2830dd8268a75ae1d3">00199</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#7c5554fba5144669d1f194b596e9bb06">pbrtRotate</a>(<span class="keywordtype">float</span> angle, <span class="keywordtype">float</span> dx, <span class="keywordtype">float</span> dy, <span class="keywordtype">float</span> dz) {
<a name="l00200"></a>00200         <a class="code" href="api_8cpp.html#9d6c4d637cd063971c84b219d4dfa4c2">VERIFY_INITIALIZED</a>(<span class="stringliteral">"Rotate"</span>);
<a name="l00201"></a>00201         curTransform = curTransform * <a class="code" href="pbrt_8h.html#351ec748c80266cff77f6bafc8414c54">Rotate</a>(angle, <a class="code" href="classVector.html">Vector</a>(dx, dy, dz));
<a name="l00202"></a>00202 }
<a name="l00203"></a><a class="code" href="api_8h.html#55076133fe9fd3ca15b140cebac9d8c3">00203</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#55076133fe9fd3ca15b140cebac9d8c3">pbrtScale</a>(<span class="keywordtype">float</span> sx, <span class="keywordtype">float</span> sy, <span class="keywordtype">float</span> sz) {
<a name="l00204"></a>00204         <a class="code" href="api_8cpp.html#9d6c4d637cd063971c84b219d4dfa4c2">VERIFY_INITIALIZED</a>(<span class="stringliteral">"Scale"</span>);
<a name="l00205"></a>00205         curTransform = curTransform * <a class="code" href="pbrt_8h.html#f6b012272269020d52792d1ed65c7904">Scale</a>(sx, sy, sz);
<a name="l00206"></a>00206 }
<a name="l00207"></a><a class="code" href="api_8h.html#9e89fa2375cf3f3237c95c618a3d2bb6">00207</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#9e89fa2375cf3f3237c95c618a3d2bb6">pbrtLookAt</a>(<span class="keywordtype">float</span> ex, <span class="keywordtype">float</span> ey, <span class="keywordtype">float</span> ez, <span class="keywordtype">float</span> lx, <span class="keywordtype">float</span> ly,
<a name="l00208"></a>00208         <span class="keywordtype">float</span> lz, <span class="keywordtype">float</span> ux, <span class="keywordtype">float</span> uy, <span class="keywordtype">float</span> uz) {
<a name="l00209"></a>00209         <a class="code" href="api_8cpp.html#9d6c4d637cd063971c84b219d4dfa4c2">VERIFY_INITIALIZED</a>(<span class="stringliteral">"LookAt"</span>);
<a name="l00210"></a>00210         curTransform = curTransform * <a class="code" href="pbrt_8h.html#289f82edc6f111331550a6fa5b18be44">LookAt</a>(<a class="code" href="classPoint.html">Point</a>(ex, ey, ez), <a class="code" href="classPoint.html">Point</a>(lx, ly, lz),
<a name="l00211"></a>00211                 <a class="code" href="classVector.html">Vector</a>(ux, uy, uz));
<a name="l00212"></a>00212 }
<a name="l00213"></a><a class="code" href="api_8h.html#8f1d6edc295243c6afc3ad42b3a37854">00213</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#96101c90caa8636658a463fb75b80a79">pbrtCoordinateSystem</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name) {
<a name="l00214"></a>00214         <a class="code" href="api_8cpp.html#9d6c4d637cd063971c84b219d4dfa4c2">VERIFY_INITIALIZED</a>(<span class="stringliteral">"CoordinateSystem"</span>);
<a name="l00215"></a>00215         <a class="code" href="api_8cpp.html#52a67d80b6075dd954a09bc7b9d57db9">namedCoordinateSystems</a>[name] = curTransform;
<a name="l00216"></a>00216 }
<a name="l00217"></a><a class="code" href="api_8h.html#b44e2452db0f0db41e332abdb236be66">00217</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#b3b57ab7572f80753f8ad537ad98690f">pbrtCoordSysTransform</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name) {
<a name="l00218"></a>00218         <a class="code" href="api_8cpp.html#9d6c4d637cd063971c84b219d4dfa4c2">VERIFY_INITIALIZED</a>(<span class="stringliteral">"CoordSysTransform"</span>);
<a name="l00219"></a>00219         <span class="keywordflow">if</span> (<a class="code" href="api_8cpp.html#52a67d80b6075dd954a09bc7b9d57db9">namedCoordinateSystems</a>.find(name) !=
<a name="l00220"></a>00220             <a class="code" href="api_8cpp.html#52a67d80b6075dd954a09bc7b9d57db9">namedCoordinateSystems</a>.end())
<a name="l00221"></a>00221                 curTransform = <a class="code" href="api_8cpp.html#52a67d80b6075dd954a09bc7b9d57db9">namedCoordinateSystems</a>[name];
<a name="l00222"></a>00222 }
<a name="l00223"></a><a class="code" href="api_8h.html#d9c33eb1b7e7965b5813f2b9988aaffd">00223</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#d9c33eb1b7e7965b5813f2b9988aaffd">pbrtPixelFilter</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name,
<a name="l00224"></a>00224                            <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
<a name="l00225"></a>00225         <a class="code" href="api_8cpp.html#bc77914d12b4dacad28d57d15c8830d8">VERIFY_OPTIONS</a>(<span class="stringliteral">"PixelFilter"</span>);
<a name="l00226"></a>00226         renderOptions-&gt;<a class="code" href="structRenderOptions.html#69951a3a45c1c90b726031f824282ccf">FilterName</a> = name;
<a name="l00227"></a>00227         renderOptions-&gt;<a class="code" href="structRenderOptions.html#d5ceeeca176d0950ffb96314e34bdb57">FilterParams</a> = params;
<a name="l00228"></a>00228 }
<a name="l00229"></a><a class="code" href="api_8h.html#43b713abb2646e7997526f94fd3cb7fc">00229</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#43b713abb2646e7997526f94fd3cb7fc">pbrtFilm</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;type, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
<a name="l00230"></a>00230         <a class="code" href="api_8cpp.html#bc77914d12b4dacad28d57d15c8830d8">VERIFY_OPTIONS</a>(<span class="stringliteral">"Film"</span>);
<a name="l00231"></a>00231         renderOptions-&gt;<a class="code" href="structRenderOptions.html#c299d707a7b2e483ee6c6d68d2e417a5">FilmParams</a> = params;
<a name="l00232"></a>00232         renderOptions-&gt;<a class="code" href="structRenderOptions.html#2cfa0eb4a03160527636158889948937">FilmName</a> = type;
<a name="l00233"></a>00233 }
<a name="l00234"></a><a class="code" href="api_8h.html#5566f7e6bcb068114645438b9534f7d3">00234</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#5566f7e6bcb068114645438b9534f7d3">pbrtSampler</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
<a name="l00235"></a>00235         <a class="code" href="api_8cpp.html#bc77914d12b4dacad28d57d15c8830d8">VERIFY_OPTIONS</a>(<span class="stringliteral">"Sampler"</span>);
<a name="l00236"></a>00236         renderOptions-&gt;<a class="code" href="structRenderOptions.html#642623bc1506b10cfde0b78c20d89bd9">SamplerName</a> = name;
<a name="l00237"></a>00237         renderOptions-&gt;<a class="code" href="structRenderOptions.html#450098350cda7a080afeba444bd7bd2a">SamplerParams</a> = params;
<a name="l00238"></a>00238 }
<a name="l00239"></a><a class="code" href="api_8h.html#a9eda8d21165877950578c43d35e8a9f">00239</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#a9eda8d21165877950578c43d35e8a9f">pbrtAccelerator</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
<a name="l00240"></a>00240         <a class="code" href="api_8cpp.html#bc77914d12b4dacad28d57d15c8830d8">VERIFY_OPTIONS</a>(<span class="stringliteral">"Accelerator"</span>);
<a name="l00241"></a>00241         renderOptions-&gt;<a class="code" href="structRenderOptions.html#eb46e92ded99bfb0a225adb3920bb81c">AcceleratorName</a> = name;
<a name="l00242"></a>00242         renderOptions-&gt;<a class="code" href="structRenderOptions.html#15aca450e40896f79ff59c07a64c6203">AcceleratorParams</a> = params;
<a name="l00243"></a>00243 }
<a name="l00244"></a><a class="code" href="api_8h.html#14669b01f1ced85c43335e861330288d">00244</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#14669b01f1ced85c43335e861330288d">pbrtSurfaceIntegrator</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
<a name="l00245"></a>00245         <a class="code" href="api_8cpp.html#bc77914d12b4dacad28d57d15c8830d8">VERIFY_OPTIONS</a>(<span class="stringliteral">"SurfaceIntegrator"</span>);
<a name="l00246"></a>00246         renderOptions-&gt;<a class="code" href="structRenderOptions.html#1573a042451ce0a079daf6bff4220dce">SurfIntegratorName</a> = name;
<a name="l00247"></a>00247         renderOptions-&gt;<a class="code" href="structRenderOptions.html#c8a050d927fef360add342440922a3c3">SurfIntegratorParams</a> = params;
<a name="l00248"></a>00248 }
<a name="l00249"></a><a class="code" href="api_8h.html#4b05e33f37d09819132edd53d0cb7a52">00249</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#4b05e33f37d09819132edd53d0cb7a52">pbrtVolumeIntegrator</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
<a name="l00250"></a>00250         <a class="code" href="api_8cpp.html#bc77914d12b4dacad28d57d15c8830d8">VERIFY_OPTIONS</a>(<span class="stringliteral">"VolumeIntegrator"</span>);
<a name="l00251"></a>00251         renderOptions-&gt;<a class="code" href="structRenderOptions.html#052b8fa0982555d2625e1315abb94206">VolIntegratorName</a> = name;
<a name="l00252"></a>00252         renderOptions-&gt;<a class="code" href="structRenderOptions.html#0aa936754ee5e53126f4d8a9ac11278a">VolIntegratorParams</a> = params;
<a name="l00253"></a>00253 }
<a name="l00254"></a><a class="code" href="api_8h.html#0584ea1b05ad5b271b89dc650f483337">00254</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#9b5c26835d5568f81a69ef6bf802b11b">pbrtCamera</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name,
<a name="l00255"></a>00255                        <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
<a name="l00256"></a>00256         <a class="code" href="api_8cpp.html#bc77914d12b4dacad28d57d15c8830d8">VERIFY_OPTIONS</a>(<span class="stringliteral">"Camera"</span>);
<a name="l00257"></a>00257         renderOptions-&gt;<a class="code" href="structRenderOptions.html#80485d92c3288993a393646a98f752f8">CameraName</a> = name;
<a name="l00258"></a>00258         renderOptions-&gt;<a class="code" href="structRenderOptions.html#4150486bffb1899d99b6521e509fe059">CameraParams</a> = params;
<a name="l00259"></a>00259         renderOptions-&gt;<a class="code" href="structRenderOptions.html#80dad5bbb9b375a1caf2714936ec2415">WorldToCamera</a> = curTransform;
<a name="l00260"></a>00260         <a class="code" href="api_8cpp.html#52a67d80b6075dd954a09bc7b9d57db9">namedCoordinateSystems</a>[<span class="stringliteral">"camera"</span>] =
<a name="l00261"></a>00261                 curTransform.<a class="code" href="classTransform.html#ced6cc3fb16b20846fcee5aaf6432f49">GetInverse</a>();
<a name="l00262"></a>00262 }
<a name="l00263"></a><a class="code" href="api_8h.html#1b734cc71d84afca730f19ae68e6e927">00263</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#1b734cc71d84afca730f19ae68e6e927">pbrtSearchPath</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;path) {
<a name="l00264"></a>00264         <a class="code" href="api_8cpp.html#bc77914d12b4dacad28d57d15c8830d8">VERIFY_OPTIONS</a>(<span class="stringliteral">"SearchPath"</span>);
<a name="l00265"></a>00265         <a class="code" href="dynload_8cpp.html#d4a57de81006840d59119e3a59e40891">UpdatePluginPath</a>(path);
<a name="l00266"></a>00266         renderOptions-&gt;<a class="code" href="structRenderOptions.html#7d9834c051b384033479387ed35bcc1e">gotSearchPath</a> = <span class="keyword">true</span>;
<a name="l00267"></a>00267 }
<a name="l00268"></a><a class="code" href="api_8h.html#9c6919b67febd0bf74c5342721a09211">00268</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#9c6919b67febd0bf74c5342721a09211">pbrtWorldBegin</a>() {
<a name="l00269"></a>00269         <a class="code" href="api_8cpp.html#bc77914d12b4dacad28d57d15c8830d8">VERIFY_OPTIONS</a>(<span class="stringliteral">"WorldBegin"</span>);
<a name="l00270"></a>00270         <a class="code" href="api_8cpp.html#a92c19c4edc1452e4e3c599b7a7b1f62">currentApiState</a> = <a class="code" href="api_8cpp.html#d420c228378d3e4fd96df3d0e42b391c">STATE_WORLD_BLOCK</a>;
<a name="l00271"></a>00271         curTransform = <a class="code" href="classTransform.html">Transform</a>();
<a name="l00272"></a>00272         <a class="code" href="api_8cpp.html#52a67d80b6075dd954a09bc7b9d57db9">namedCoordinateSystems</a>[<span class="stringliteral">"world"</span>] = curTransform;
<a name="l00273"></a>00273 }
<a name="l00274"></a><a class="code" href="api_8h.html#108e79a9f50e7da7b73bc212bc261ddd">00274</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#108e79a9f50e7da7b73bc212bc261ddd">pbrtAttributeBegin</a>() {
<a name="l00275"></a>00275         <a class="code" href="api_8cpp.html#6393c87c46e2e5a4300f2750684e3213">VERIFY_WORLD</a>(<span class="stringliteral">"AttributeBegin"</span>);
<a name="l00276"></a>00276         <a class="code" href="api_8cpp.html#eb9b707b65603278aeaed7bb1c5fb1b1">pushedGraphicsStates</a>.push_back(graphicsState);
<a name="l00277"></a>00277         <a class="code" href="api_8cpp.html#465158e53ec374a4f5e72dabcf5fbb85">pushedTransforms</a>.push_back(curTransform);
<a name="l00278"></a>00278 }
<a name="l00279"></a><a class="code" href="api_8h.html#145ad60a978c92159b0646ba5748d843">00279</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#145ad60a978c92159b0646ba5748d843">pbrtAttributeEnd</a>() {
<a name="l00280"></a>00280         <a class="code" href="api_8cpp.html#6393c87c46e2e5a4300f2750684e3213">VERIFY_WORLD</a>(<span class="stringliteral">"AttributeEnd"</span>);
<a name="l00281"></a>00281         <span class="keywordflow">if</span> (!<a class="code" href="api_8cpp.html#eb9b707b65603278aeaed7bb1c5fb1b1">pushedGraphicsStates</a>.size()) {
<a name="l00282"></a>00282                 <a class="code" href="pbrt_8h.html#d1a16fc9ced4ddc376b9d3e6607be15e">Error</a>(<span class="stringliteral">"Unmatched pbrtAttributeEnd() encountered. "</span>
<a name="l00283"></a>00283                         <span class="stringliteral">"Ignoring it."</span>);
<a name="l00284"></a>00284                 <span class="keywordflow">return</span>;
<a name="l00285"></a>00285         }
<a name="l00286"></a>00286         graphicsState = <a class="code" href="api_8cpp.html#eb9b707b65603278aeaed7bb1c5fb1b1">pushedGraphicsStates</a>.back();
<a name="l00287"></a>00287         curTransform = <a class="code" href="api_8cpp.html#465158e53ec374a4f5e72dabcf5fbb85">pushedTransforms</a>.back();
<a name="l00288"></a>00288         <a class="code" href="api_8cpp.html#eb9b707b65603278aeaed7bb1c5fb1b1">pushedGraphicsStates</a>.pop_back();
<a name="l00289"></a>00289         <a class="code" href="api_8cpp.html#465158e53ec374a4f5e72dabcf5fbb85">pushedTransforms</a>.pop_back();
<a name="l00290"></a>00290 }
<a name="l00291"></a><a class="code" href="api_8h.html#3fb1a11677d95111554fb1f93e8a2eb3">00291</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#3fb1a11677d95111554fb1f93e8a2eb3">pbrtTransformBegin</a>() {
<a name="l00292"></a>00292         <a class="code" href="api_8cpp.html#6393c87c46e2e5a4300f2750684e3213">VERIFY_WORLD</a>(<span class="stringliteral">"TransformBegin"</span>);
<a name="l00293"></a>00293         <a class="code" href="api_8cpp.html#465158e53ec374a4f5e72dabcf5fbb85">pushedTransforms</a>.push_back(curTransform);
<a name="l00294"></a>00294 }
<a name="l00295"></a><a class="code" href="api_8h.html#cee2d0c4954495370a227dd6d3ca6c0e">00295</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#cee2d0c4954495370a227dd6d3ca6c0e">pbrtTransformEnd</a>() {
<a name="l00296"></a>00296         <a class="code" href="api_8cpp.html#6393c87c46e2e5a4300f2750684e3213">VERIFY_WORLD</a>(<span class="stringliteral">"TransformEnd"</span>);
<a name="l00297"></a>00297         <span class="keywordflow">if</span> (!<a class="code" href="api_8cpp.html#465158e53ec374a4f5e72dabcf5fbb85">pushedTransforms</a>.size()) {
<a name="l00298"></a>00298                 <a class="code" href="pbrt_8h.html#d1a16fc9ced4ddc376b9d3e6607be15e">Error</a>(<span class="stringliteral">"Unmatched pbrtTransformEnd() encountered. "</span>
<a name="l00299"></a>00299                         <span class="stringliteral">"Ignoring it."</span>);
<a name="l00300"></a>00300                 <span class="keywordflow">return</span>;
<a name="l00301"></a>00301         }
<a name="l00302"></a>00302         curTransform = <a class="code" href="api_8cpp.html#465158e53ec374a4f5e72dabcf5fbb85">pushedTransforms</a>.back();
<a name="l00303"></a>00303         <a class="code" href="api_8cpp.html#465158e53ec374a4f5e72dabcf5fbb85">pushedTransforms</a>.pop_back();
<a name="l00304"></a>00304 }
<a name="l00305"></a><a class="code" href="api_8h.html#2f475bb780a0e2be8971ef88ed315756">00305</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#2f475bb780a0e2be8971ef88ed315756">pbrtTexture</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name,
<a name="l00306"></a>00306                          <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;type,
<a name="l00307"></a>00307                                                  <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;texname,
<a name="l00308"></a>00308                                                  <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
<a name="l00309"></a>00309         <a class="code" href="api_8cpp.html#6393c87c46e2e5a4300f2750684e3213">VERIFY_WORLD</a>(<span class="stringliteral">"Texture"</span>);
<a name="l00310"></a>00310         <a class="code" href="classTextureParams.html">TextureParams</a> tp(params, params,
<a name="l00311"></a>00311                          graphicsState.<a class="code" href="structGraphicsState.html#4141b59e6b3d511e756c429d9e899025">floatTextures</a>,
<a name="l00312"></a>00312                              graphicsState.<a class="code" href="structGraphicsState.html#cf5b1f08c66249ada4d171c4e5b3e93a">spectrumTextures</a>);
<a name="l00313"></a>00313         <span class="keywordflow">if</span> (type == <span class="stringliteral">"float"</span>)  {
<a name="l00314"></a>00314                 <span class="comment">// Create _float_ texture and store in _floatTextures_</span>
<a name="l00315"></a>00315                 <span class="keywordflow">if</span> (graphicsState.<a class="code" href="structGraphicsState.html#4141b59e6b3d511e756c429d9e899025">floatTextures</a>.find(name) !=
<a name="l00316"></a>00316                     graphicsState.<a class="code" href="structGraphicsState.html#4141b59e6b3d511e756c429d9e899025">floatTextures</a>.end())
<a name="l00317"></a>00317                         <a class="code" href="pbrt_8h.html#79abc2e750c4774bd9d433ad4f6e440a">Warning</a>(<span class="stringliteral">"Texture \"%s\" being redefined"</span>, name.c_str());
<a name="l00318"></a>00318                 <a class="code" href="classReference.html">Reference&lt;Texture&lt;float&gt;</a> &gt; ft = <a class="code" href="dynload_8cpp.html#d4aa26279a607bbda12342799892168c">MakeFloatTexture</a>(texname,
<a name="l00319"></a>00319                         curTransform, tp);
<a name="l00320"></a>00320                 <span class="keywordflow">if</span> (ft) graphicsState.<a class="code" href="structGraphicsState.html#4141b59e6b3d511e756c429d9e899025">floatTextures</a>[name] = ft;
<a name="l00321"></a>00321         }
<a name="l00322"></a>00322         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <span class="stringliteral">"color"</span>)  {
<a name="l00323"></a>00323                 <span class="comment">// Create _color_ texture and store in _spectrumTextures_</span>
<a name="l00324"></a>00324                 <span class="keywordflow">if</span> (graphicsState.<a class="code" href="structGraphicsState.html#cf5b1f08c66249ada4d171c4e5b3e93a">spectrumTextures</a>.find(name) != graphicsState.<a class="code" href="structGraphicsState.html#cf5b1f08c66249ada4d171c4e5b3e93a">spectrumTextures</a>.end())
<a name="l00325"></a>00325                         <a class="code" href="pbrt_8h.html#79abc2e750c4774bd9d433ad4f6e440a">Warning</a>(<span class="stringliteral">"Texture \"%s\" being redefined"</span>, name.c_str());
<a name="l00326"></a>00326                 <a class="code" href="classReference.html">Reference&lt;Texture&lt;Spectrum&gt;</a> &gt; st = <a class="code" href="dynload_8cpp.html#44357f358b90505fe4602ccd18f68b7f">MakeSpectrumTexture</a>(texname,
<a name="l00327"></a>00327                         curTransform, tp);
<a name="l00328"></a>00328                 <span class="keywordflow">if</span> (st) graphicsState.<a class="code" href="structGraphicsState.html#cf5b1f08c66249ada4d171c4e5b3e93a">spectrumTextures</a>[name] = st;
<a name="l00329"></a>00329         }
<a name="l00330"></a>00330         <span class="keywordflow">else</span>
<a name="l00331"></a>00331                 <a class="code" href="pbrt_8h.html#d1a16fc9ced4ddc376b9d3e6607be15e">Error</a>(<span class="stringliteral">"Texture type \"%s\" unknown."</span>, type.c_str());
<a name="l00332"></a>00332 }
<a name="l00333"></a><a class="code" href="api_8h.html#59f03f444feae646c7bf695409de4862">00333</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#59f03f444feae646c7bf695409de4862">pbrtMaterial</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name, <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
<a name="l00334"></a>00334         <a class="code" href="api_8cpp.html#6393c87c46e2e5a4300f2750684e3213">VERIFY_WORLD</a>(<span class="stringliteral">"Material"</span>);
<a name="l00335"></a>00335         graphicsState.<a class="code" href="structGraphicsState.html#b9c4d0e4d465a5568a2413a7684ab66f">material</a> = name;
<a name="l00336"></a>00336         graphicsState.<a class="code" href="structGraphicsState.html#15e5a40a5ff7f95f7a607f1f62f3bcd9">materialParams</a> = params;
<a name="l00337"></a>00337 }
<a name="l00338"></a><a class="code" href="api_8h.html#f7d6e34a7cc461d0d6e64742719705c2">00338</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#f7d6e34a7cc461d0d6e64742719705c2">pbrtLightSource</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name,
<a name="l00339"></a>00339                              <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
<a name="l00340"></a>00340         <a class="code" href="api_8cpp.html#6393c87c46e2e5a4300f2750684e3213">VERIFY_WORLD</a>(<span class="stringliteral">"LightSource"</span>);
<a name="l00341"></a>00341         <a class="code" href="classLight.html">Light</a> *lt = <a class="code" href="dynload_8cpp.html#8a522099c834cc9cf195deb0d1194ffe">MakeLight</a>(name, curTransform, params);
<a name="l00342"></a>00342         <span class="keywordflow">if</span> (lt == NULL)
<a name="l00343"></a>00343                 <a class="code" href="pbrt_8h.html#d1a16fc9ced4ddc376b9d3e6607be15e">Error</a>(<span class="stringliteral">"pbrtLightSource: light type "</span>
<a name="l00344"></a>00344                       <span class="stringliteral">"\"%s\" unknown."</span>, name.c_str());
<a name="l00345"></a>00345         <span class="keywordflow">else</span>
<a name="l00346"></a>00346                 renderOptions-&gt;<a class="code" href="structRenderOptions.html#20d3a070ca4db89e8217b26b063d3f8c">lights</a>.push_back(lt);
<a name="l00347"></a>00347 }
<a name="l00348"></a><a class="code" href="api_8h.html#632d45b55b076ba28b97d3eddfbddc48">00348</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#632d45b55b076ba28b97d3eddfbddc48">pbrtAreaLightSource</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name,
<a name="l00349"></a>00349                                  <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
<a name="l00350"></a>00350         <a class="code" href="api_8cpp.html#6393c87c46e2e5a4300f2750684e3213">VERIFY_WORLD</a>(<span class="stringliteral">"AreaLightSource"</span>);
<a name="l00351"></a>00351         graphicsState.<a class="code" href="structGraphicsState.html#d3aec9365b7cd90799c07a675e33e9be">areaLight</a> = name;
<a name="l00352"></a>00352         graphicsState.<a class="code" href="structGraphicsState.html#3bc61d43d94cdf152056e5715d40351e">areaLightParams</a> = params;
<a name="l00353"></a>00353 }
<a name="l00354"></a><a class="code" href="api_8h.html#4d8bed8ae6899c2083fbc7f50abd8040">00354</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#4d8bed8ae6899c2083fbc7f50abd8040">pbrtShape</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name,
<a name="l00355"></a>00355                        <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
<a name="l00356"></a>00356         <a class="code" href="api_8cpp.html#6393c87c46e2e5a4300f2750684e3213">VERIFY_WORLD</a>(<span class="stringliteral">"Shape"</span>);
<a name="l00357"></a>00357         <a class="code" href="classReference.html">Reference&lt;Shape&gt;</a> shape = <a class="code" href="dynload_8cpp.html#7cafb1faa059017c7ee7e46bb3fd4fec">MakeShape</a>(name,
<a name="l00358"></a>00358                 curTransform, graphicsState.<a class="code" href="structGraphicsState.html#47ad509ac073cfe4ec9276ae9441461f">reverseOrientation</a>,
<a name="l00359"></a>00359                 params);
<a name="l00360"></a>00360         <span class="keywordflow">if</span> (!shape) <span class="keywordflow">return</span>;
<a name="l00361"></a>00361         params.<a class="code" href="classParamSet.html#b800cdc8a8244c54094ba036da81d73f">ReportUnused</a>();
<a name="l00362"></a>00362         <span class="comment">// Initialize area light for shape</span>
<a name="l00363"></a>00363         <a class="code" href="classAreaLight.html">AreaLight</a> *area = NULL;
<a name="l00364"></a>00364         <span class="keywordflow">if</span> (graphicsState.<a class="code" href="structGraphicsState.html#d3aec9365b7cd90799c07a675e33e9be">areaLight</a> != <span class="stringliteral">""</span>)
<a name="l00365"></a>00365                 area = <a class="code" href="dynload_8cpp.html#0763cd2c6d9dc6e76b56f8b80e142588">MakeAreaLight</a>(graphicsState.<a class="code" href="structGraphicsState.html#d3aec9365b7cd90799c07a675e33e9be">areaLight</a>,
<a name="l00366"></a>00366                 curTransform, graphicsState.<a class="code" href="structGraphicsState.html#3bc61d43d94cdf152056e5715d40351e">areaLightParams</a>, shape);
<a name="l00367"></a>00367         <span class="comment">// Initialize material for shape</span>
<a name="l00368"></a>00368         <a class="code" href="classTextureParams.html">TextureParams</a> mp(params,
<a name="l00369"></a>00369                          graphicsState.<a class="code" href="structGraphicsState.html#15e5a40a5ff7f95f7a607f1f62f3bcd9">materialParams</a>,
<a name="l00370"></a>00370                                          graphicsState.<a class="code" href="structGraphicsState.html#4141b59e6b3d511e756c429d9e899025">floatTextures</a>,
<a name="l00371"></a>00371                                          graphicsState.<a class="code" href="structGraphicsState.html#cf5b1f08c66249ada4d171c4e5b3e93a">spectrumTextures</a>);
<a name="l00372"></a>00372         <a class="code" href="classReference.html">Reference&lt;Texture&lt;float&gt;</a> &gt; bump = NULL;
<a name="l00373"></a>00373         <a class="code" href="classReference.html">Reference&lt;Material&gt;</a> mtl =
<a name="l00374"></a>00374                 <a class="code" href="dynload_8cpp.html#95748922b726956271bc1feaecb0ee0b">MakeMaterial</a>(graphicsState.<a class="code" href="structGraphicsState.html#b9c4d0e4d465a5568a2413a7684ab66f">material</a>,
<a name="l00375"></a>00375                              curTransform, mp);
<a name="l00376"></a>00376         <span class="keywordflow">if</span> (!mtl)
<a name="l00377"></a>00377                 mtl = <a class="code" href="dynload_8cpp.html#95748922b726956271bc1feaecb0ee0b">MakeMaterial</a>(<span class="stringliteral">"matte"</span>, curTransform, mp);
<a name="l00378"></a>00378         <span class="keywordflow">if</span> (!mtl)
<a name="l00379"></a>00379                 <a class="code" href="pbrt_8h.html#63fd51330b3b9d2663a08258601448e5">Severe</a>(<span class="stringliteral">"Unable to create \"matte\" material?!"</span>);
<a name="l00380"></a>00380         <span class="comment">// Create primitive and add to scene or current instance</span>
<a name="l00381"></a>00381         <a class="code" href="classReference.html">Reference&lt;Primitive&gt;</a> prim =
<a name="l00382"></a>00382                 <span class="keyword">new</span> <a class="code" href="classGeometricPrimitive.html">GeometricPrimitive</a>(shape, mtl, area);
<a name="l00383"></a>00383         <span class="keywordflow">if</span> (renderOptions-&gt;<a class="code" href="structRenderOptions.html#de89b794a25c6e0bda54f5e2d2018c09">currentInstance</a>) {
<a name="l00384"></a>00384                 <span class="keywordflow">if</span> (area)
<a name="l00385"></a>00385                         <a class="code" href="pbrt_8h.html#79abc2e750c4774bd9d433ad4f6e440a">Warning</a>(<span class="stringliteral">"Area lights not supported "</span>
<a name="l00386"></a>00386                                 <span class="stringliteral">"with object instancing"</span>);
<a name="l00387"></a>00387                 renderOptions-&gt;<a class="code" href="structRenderOptions.html#de89b794a25c6e0bda54f5e2d2018c09">currentInstance</a>-&gt;push_back(prim);
<a name="l00388"></a>00388         }
<a name="l00389"></a>00389         <span class="keywordflow">else</span> {
<a name="l00390"></a>00390                 renderOptions-&gt;<a class="code" href="structRenderOptions.html#2e0ee53c051e1df5a1c70e4f69784d57">primitives</a>.push_back(prim);
<a name="l00391"></a>00391                 <span class="keywordflow">if</span> (area != NULL) {
<a name="l00392"></a>00392                         <span class="comment">// Add area light for primitive to light vector</span>
<a name="l00393"></a>00393                         renderOptions-&gt;<a class="code" href="structRenderOptions.html#20d3a070ca4db89e8217b26b063d3f8c">lights</a>.push_back(area);
<a name="l00394"></a>00394                 }
<a name="l00395"></a>00395         }
<a name="l00396"></a>00396 }
<a name="l00397"></a><a class="code" href="api_8h.html#f76f4a72c20f95bb76f45f3ea3eec516">00397</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#f76f4a72c20f95bb76f45f3ea3eec516">pbrtReverseOrientation</a>() {
<a name="l00398"></a>00398         <a class="code" href="api_8cpp.html#6393c87c46e2e5a4300f2750684e3213">VERIFY_WORLD</a>(<span class="stringliteral">"ReverseOrientation"</span>);
<a name="l00399"></a>00399         graphicsState.<a class="code" href="structGraphicsState.html#47ad509ac073cfe4ec9276ae9441461f">reverseOrientation</a> =
<a name="l00400"></a>00400                 !graphicsState.<a class="code" href="structGraphicsState.html#47ad509ac073cfe4ec9276ae9441461f">reverseOrientation</a>;
<a name="l00401"></a>00401 }
<a name="l00402"></a><a class="code" href="api_8h.html#36a5c800c9ed92eaf20990d1a438cbdc">00402</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#36a5c800c9ed92eaf20990d1a438cbdc">pbrtVolume</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name,
<a name="l00403"></a>00403                         <span class="keyword">const</span> <a class="code" href="classParamSet.html">ParamSet</a> &amp;params) {
<a name="l00404"></a>00404         <a class="code" href="api_8cpp.html#6393c87c46e2e5a4300f2750684e3213">VERIFY_WORLD</a>(<span class="stringliteral">"Volume"</span>);
<a name="l00405"></a>00405         <a class="code" href="classVolumeRegion.html">VolumeRegion</a> *vr = <a class="code" href="dynload_8cpp.html#be490847f8087704749d562a1b94ee87">MakeVolumeRegion</a>(name,
<a name="l00406"></a>00406                 curTransform, params);
<a name="l00407"></a>00407         <span class="keywordflow">if</span> (vr) renderOptions-&gt;<a class="code" href="structRenderOptions.html#35086e28667947f41eb7f2a5c3ef7e34">volumeRegions</a>.push_back(vr);
<a name="l00408"></a>00408 }
<a name="l00409"></a><a class="code" href="api_8h.html#40532d51b4a5b9012844f31ee93605f4">00409</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#40532d51b4a5b9012844f31ee93605f4">pbrtObjectBegin</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name) {
<a name="l00410"></a>00410         <a class="code" href="api_8cpp.html#6393c87c46e2e5a4300f2750684e3213">VERIFY_WORLD</a>(<span class="stringliteral">"ObjectBegin"</span>);
<a name="l00411"></a>00411         <a class="code" href="api_8cpp.html#108e79a9f50e7da7b73bc212bc261ddd">pbrtAttributeBegin</a>();
<a name="l00412"></a>00412         <span class="keywordflow">if</span> (renderOptions-&gt;<a class="code" href="structRenderOptions.html#de89b794a25c6e0bda54f5e2d2018c09">currentInstance</a>)
<a name="l00413"></a>00413                 <a class="code" href="pbrt_8h.html#d1a16fc9ced4ddc376b9d3e6607be15e">Error</a>(<span class="stringliteral">"ObjectBegin called inside "</span>
<a name="l00414"></a>00414                       <span class="stringliteral">"of instance definition"</span>);
<a name="l00415"></a>00415         renderOptions-&gt;<a class="code" href="structRenderOptions.html#e079c03a8323592e076c9886acd7e458">instances</a>[name] =
<a name="l00416"></a>00416                 vector&lt;Reference&lt;Primitive&gt; &gt;();
<a name="l00417"></a>00417         renderOptions-&gt;<a class="code" href="structRenderOptions.html#de89b794a25c6e0bda54f5e2d2018c09">currentInstance</a> =
<a name="l00418"></a>00418                 &amp;renderOptions-&gt;<a class="code" href="structRenderOptions.html#e079c03a8323592e076c9886acd7e458">instances</a>[name];
<a name="l00419"></a>00419 }
<a name="l00420"></a><a class="code" href="api_8h.html#92389a6e11dce061b29ba0f7f6af521a">00420</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#92389a6e11dce061b29ba0f7f6af521a">pbrtObjectEnd</a>() {
<a name="l00421"></a>00421         <a class="code" href="api_8cpp.html#6393c87c46e2e5a4300f2750684e3213">VERIFY_WORLD</a>(<span class="stringliteral">"ObjectEnd"</span>);
<a name="l00422"></a>00422         <span class="keywordflow">if</span> (!renderOptions-&gt;<a class="code" href="structRenderOptions.html#de89b794a25c6e0bda54f5e2d2018c09">currentInstance</a>)
<a name="l00423"></a>00423                 <a class="code" href="pbrt_8h.html#d1a16fc9ced4ddc376b9d3e6607be15e">Error</a>(<span class="stringliteral">"ObjectEnd called outside "</span>
<a name="l00424"></a>00424                       <span class="stringliteral">"of instance definition"</span>);
<a name="l00425"></a>00425         renderOptions-&gt;<a class="code" href="structRenderOptions.html#de89b794a25c6e0bda54f5e2d2018c09">currentInstance</a> = NULL;
<a name="l00426"></a>00426         <a class="code" href="api_8cpp.html#145ad60a978c92159b0646ba5748d843">pbrtAttributeEnd</a>();
<a name="l00427"></a>00427 }
<a name="l00428"></a><a class="code" href="api_8h.html#1ff50382ad5cfef4799fc65462f73a1d">00428</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#1ff50382ad5cfef4799fc65462f73a1d">pbrtObjectInstance</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;name) {
<a name="l00429"></a>00429         <a class="code" href="api_8cpp.html#6393c87c46e2e5a4300f2750684e3213">VERIFY_WORLD</a>(<span class="stringliteral">"ObjectInstance"</span>);
<a name="l00430"></a>00430         <span class="comment">// Object instance error checking</span>
<a name="l00431"></a>00431         <span class="keywordflow">if</span> (renderOptions-&gt;<a class="code" href="structRenderOptions.html#de89b794a25c6e0bda54f5e2d2018c09">currentInstance</a>) {
<a name="l00432"></a>00432                 <a class="code" href="pbrt_8h.html#d1a16fc9ced4ddc376b9d3e6607be15e">Error</a>(<span class="stringliteral">"ObjectInstance can't be called inside instance definition"</span>);
<a name="l00433"></a>00433                 <span class="keywordflow">return</span>;
<a name="l00434"></a>00434         }
<a name="l00435"></a>00435         <span class="keywordflow">if</span> (renderOptions-&gt;<a class="code" href="structRenderOptions.html#e079c03a8323592e076c9886acd7e458">instances</a>.find(name) == renderOptions-&gt;<a class="code" href="structRenderOptions.html#e079c03a8323592e076c9886acd7e458">instances</a>.end()) {
<a name="l00436"></a>00436                 <a class="code" href="pbrt_8h.html#d1a16fc9ced4ddc376b9d3e6607be15e">Error</a>(<span class="stringliteral">"Unable to find instance named \"%s\""</span>, name.c_str());
<a name="l00437"></a>00437                 <span class="keywordflow">return</span>;
<a name="l00438"></a>00438         }
<a name="l00439"></a>00439         vector&lt;Reference&lt;Primitive&gt; &gt; &amp;in =
<a name="l00440"></a>00440                 renderOptions-&gt;<a class="code" href="structRenderOptions.html#e079c03a8323592e076c9886acd7e458">instances</a>[name];
<a name="l00441"></a>00441         <span class="keywordflow">if</span> (in.size() == 0) <span class="keywordflow">return</span>;
<a name="l00442"></a>00442         <span class="keywordflow">if</span> (in.size() &gt; 1 || !in[0]-&gt;CanIntersect()) {
<a name="l00443"></a>00443                 <span class="comment">// Refine instance _Primitive_s and create aggregate</span>
<a name="l00444"></a>00444                 <a class="code" href="classReference.html">Reference&lt;Primitive&gt;</a> accel =
<a name="l00445"></a>00445                         <a class="code" href="dynload_8cpp.html#0585380e67f525bc7fe06188103ab5d6">MakeAccelerator</a>(renderOptions-&gt;<a class="code" href="structRenderOptions.html#eb46e92ded99bfb0a225adb3920bb81c">AcceleratorName</a>,
<a name="l00446"></a>00446                                        in, renderOptions-&gt;<a class="code" href="structRenderOptions.html#15aca450e40896f79ff59c07a64c6203">AcceleratorParams</a>);
<a name="l00447"></a>00447                 <span class="keywordflow">if</span> (!accel)
<a name="l00448"></a>00448                         accel = <a class="code" href="dynload_8cpp.html#0585380e67f525bc7fe06188103ab5d6">MakeAccelerator</a>(<span class="stringliteral">"kdtree"</span>, in, <a class="code" href="classParamSet.html">ParamSet</a>());
<a name="l00449"></a>00449                 <span class="keywordflow">if</span> (!accel)
<a name="l00450"></a>00450                         <a class="code" href="pbrt_8h.html#63fd51330b3b9d2663a08258601448e5">Severe</a>(<span class="stringliteral">"Unable to find \"kdtree\" accelerator"</span>);
<a name="l00451"></a>00451                 in.erase(in.begin(), in.end());
<a name="l00452"></a>00452                 in.push_back(accel);
<a name="l00453"></a>00453         }
<a name="l00454"></a>00454         <a class="code" href="classReference.html">Reference&lt;Primitive&gt;</a> prim = <span class="keyword">new</span> <a class="code" href="classInstancePrimitive.html">InstancePrimitive</a>(in[0],
<a name="l00455"></a>00455                 curTransform);
<a name="l00456"></a>00456         renderOptions-&gt;<a class="code" href="structRenderOptions.html#2e0ee53c051e1df5a1c70e4f69784d57">primitives</a>.push_back(prim);
<a name="l00457"></a>00457 }
<a name="l00458"></a><a class="code" href="api_8h.html#c18bd5ec5612a826982ff0d70c3a3062">00458</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">void</span> <a class="code" href="api_8cpp.html#c18bd5ec5612a826982ff0d70c3a3062">pbrtWorldEnd</a>() {
<a name="l00459"></a>00459         <a class="code" href="api_8cpp.html#6393c87c46e2e5a4300f2750684e3213">VERIFY_WORLD</a>(<span class="stringliteral">"WorldEnd"</span>);
<a name="l00460"></a>00460         <span class="comment">// Ensure the search path was set</span>
<a name="l00461"></a>00461         <span class="keywordflow">if</span> (!renderOptions-&gt;<a class="code" href="structRenderOptions.html#7d9834c051b384033479387ed35bcc1e">gotSearchPath</a>)
<a name="l00462"></a>00462                 <a class="code" href="pbrt_8h.html#63fd51330b3b9d2663a08258601448e5">Severe</a>(<span class="stringliteral">"PBRT_SEARCHPATH environment variable "</span>
<a name="l00463"></a>00463                                   <span class="stringliteral">"wasn't set and a plug-in\n"</span>
<a name="l00464"></a>00464                                       <span class="stringliteral">"search path wasn't given in the "</span>
<a name="l00465"></a>00465                                                   <span class="stringliteral">"input (with the SearchPath "</span>
<a name="l00466"></a>00466                                                   <span class="stringliteral">"directive).\n"</span>);
<a name="l00467"></a>00467         <span class="comment">// Ensure there are no pushed graphics states</span>
<a name="l00468"></a>00468         <span class="keywordflow">while</span> (<a class="code" href="api_8cpp.html#eb9b707b65603278aeaed7bb1c5fb1b1">pushedGraphicsStates</a>.size()) {
<a name="l00469"></a>00469                 <a class="code" href="pbrt_8h.html#79abc2e750c4774bd9d433ad4f6e440a">Warning</a>(<span class="stringliteral">"Missing end to pbrtAttributeBegin()"</span>);
<a name="l00470"></a>00470                 <a class="code" href="api_8cpp.html#eb9b707b65603278aeaed7bb1c5fb1b1">pushedGraphicsStates</a>.pop_back();
<a name="l00471"></a>00471                 <a class="code" href="api_8cpp.html#465158e53ec374a4f5e72dabcf5fbb85">pushedTransforms</a>.pop_back();
<a name="l00472"></a>00472         }
<a name="l00473"></a>00473         <span class="comment">// Create scene and render</span>
<a name="l00474"></a>00474         <a class="code" href="classScene.html">Scene</a> *scene = renderOptions-&gt;<a class="code" href="structRenderOptions.html#8cfdd83e33309d808f6209ed975ae6f1">MakeScene</a>();
<a name="l00475"></a>00475         <span class="keywordflow">if</span> (scene) scene-&gt;<a class="code" href="classScene.html#91913b921d41d374e00eac347358dc14">Render</a>();
<a name="l00476"></a>00476         <span class="keyword">delete</span> scene;
<a name="l00477"></a>00477         <span class="comment">// Clean up after rendering</span>
<a name="l00478"></a>00478         <a class="code" href="api_8cpp.html#a92c19c4edc1452e4e3c599b7a7b1f62">currentApiState</a> = <a class="code" href="api_8cpp.html#962103b145f2a6f97822f310c6b1dff4">STATE_OPTIONS_BLOCK</a>;
<a name="l00479"></a>00479         <a class="code" href="pbrt_8h.html#c68db060238e5514e0a610cbae6ab40b">StatsPrint</a>(stdout);
<a name="l00480"></a>00480         curTransform = <a class="code" href="classTransform.html">Transform</a>();
<a name="l00481"></a>00481         <a class="code" href="api_8cpp.html#52a67d80b6075dd954a09bc7b9d57db9">namedCoordinateSystems</a>.erase(<a class="code" href="api_8cpp.html#52a67d80b6075dd954a09bc7b9d57db9">namedCoordinateSystems</a>.begin(),
<a name="l00482"></a>00482                 <a class="code" href="api_8cpp.html#52a67d80b6075dd954a09bc7b9d57db9">namedCoordinateSystems</a>.end());
<a name="l00483"></a>00483 }
<a name="l00484"></a><a class="code" href="structRenderOptions.html#8cfdd83e33309d808f6209ed975ae6f1">00484</a> <a class="code" href="classScene.html">Scene</a> *<a class="code" href="structRenderOptions.html#8cfdd83e33309d808f6209ed975ae6f1">RenderOptions::MakeScene</a>()<span class="keyword"> const </span>{
<a name="l00485"></a>00485         <span class="comment">// Create scene objects from API settings</span>
<a name="l00486"></a>00486         <a class="code" href="classFilter.html">Filter</a> *filter = <a class="code" href="dynload_8cpp.html#f792af289b463e7636f1a8d6ea4f15ce">MakeFilter</a>(<a class="code" href="structRenderOptions.html#69951a3a45c1c90b726031f824282ccf">FilterName</a>, <a class="code" href="structRenderOptions.html#d5ceeeca176d0950ffb96314e34bdb57">FilterParams</a>);
<a name="l00487"></a>00487         <a class="code" href="classFilm.html">Film</a> *film = <a class="code" href="dynload_8cpp.html#a5a01a92056db78e6f87cc641a9f18a7">MakeFilm</a>(<a class="code" href="structRenderOptions.html#2cfa0eb4a03160527636158889948937">FilmName</a>, <a class="code" href="structRenderOptions.html#c299d707a7b2e483ee6c6d68d2e417a5">FilmParams</a>, filter);
<a name="l00488"></a>00488         <a class="code" href="classCamera.html">Camera</a> *camera = <a class="code" href="dynload_8cpp.html#6cda1b7040d7b6d0a65a36bae8bc129a">MakeCamera</a>(<a class="code" href="structRenderOptions.html#80485d92c3288993a393646a98f752f8">CameraName</a>, <a class="code" href="structRenderOptions.html#4150486bffb1899d99b6521e509fe059">CameraParams</a>,
<a name="l00489"></a>00489                 <a class="code" href="structRenderOptions.html#80dad5bbb9b375a1caf2714936ec2415">WorldToCamera</a>, film);
<a name="l00490"></a>00490         <a class="code" href="classSampler.html">Sampler</a> *sampler = <a class="code" href="dynload_8cpp.html#b59a99fb1ab41cea016ac90759b83933">MakeSampler</a>(<a class="code" href="structRenderOptions.html#642623bc1506b10cfde0b78c20d89bd9">SamplerName</a>, <a class="code" href="structRenderOptions.html#450098350cda7a080afeba444bd7bd2a">SamplerParams</a>, film);
<a name="l00491"></a>00491         <a class="code" href="classSurfaceIntegrator.html">SurfaceIntegrator</a> *surfaceIntegrator = <a class="code" href="dynload_8cpp.html#ce4ff1a1ea9dad444b0fdbde0bbd8f2d">MakeSurfaceIntegrator</a>(<a class="code" href="structRenderOptions.html#1573a042451ce0a079daf6bff4220dce">SurfIntegratorName</a>,
<a name="l00492"></a>00492                 <a class="code" href="structRenderOptions.html#c8a050d927fef360add342440922a3c3">SurfIntegratorParams</a>);
<a name="l00493"></a>00493         <a class="code" href="classVolumeIntegrator.html">VolumeIntegrator</a> *volumeIntegrator = <a class="code" href="dynload_8cpp.html#3b07879af708b94fe81a259ee06f00b0">MakeVolumeIntegrator</a>(<a class="code" href="structRenderOptions.html#052b8fa0982555d2625e1315abb94206">VolIntegratorName</a>,
<a name="l00494"></a>00494                 <a class="code" href="structRenderOptions.html#0aa936754ee5e53126f4d8a9ac11278a">VolIntegratorParams</a>);
<a name="l00495"></a>00495         <a class="code" href="classPrimitive.html">Primitive</a> *accelerator = <a class="code" href="dynload_8cpp.html#0585380e67f525bc7fe06188103ab5d6">MakeAccelerator</a>(<a class="code" href="structRenderOptions.html#eb46e92ded99bfb0a225adb3920bb81c">AcceleratorName</a>,
<a name="l00496"></a>00496                 <a class="code" href="structRenderOptions.html#2e0ee53c051e1df5a1c70e4f69784d57">primitives</a>, <a class="code" href="structRenderOptions.html#15aca450e40896f79ff59c07a64c6203">AcceleratorParams</a>);
<a name="l00497"></a>00497         <span class="keywordflow">if</span> (!accelerator) {
<a name="l00498"></a>00498                 <a class="code" href="classParamSet.html">ParamSet</a> ps;
<a name="l00499"></a>00499                 accelerator = <a class="code" href="dynload_8cpp.html#0585380e67f525bc7fe06188103ab5d6">MakeAccelerator</a>(<span class="stringliteral">"kdtree"</span>, <a class="code" href="structRenderOptions.html#2e0ee53c051e1df5a1c70e4f69784d57">primitives</a>, ps);
<a name="l00500"></a>00500         }
<a name="l00501"></a>00501         <span class="keywordflow">if</span> (!accelerator)
<a name="l00502"></a>00502                 <a class="code" href="pbrt_8h.html#63fd51330b3b9d2663a08258601448e5">Severe</a>(<span class="stringliteral">"Unable to find \"kdtree\" accelerator"</span>);
<a name="l00503"></a>00503         <span class="comment">// Initialize _volumeRegion_ from volume region(s)</span>
<a name="l00504"></a>00504         <a class="code" href="classVolumeRegion.html">VolumeRegion</a> *volumeRegion;
<a name="l00505"></a>00505         <span class="keywordflow">if</span> (<a class="code" href="structRenderOptions.html#35086e28667947f41eb7f2a5c3ef7e34">volumeRegions</a>.size() == 0)
<a name="l00506"></a>00506                 volumeRegion = NULL;
<a name="l00507"></a>00507         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="structRenderOptions.html#35086e28667947f41eb7f2a5c3ef7e34">volumeRegions</a>.size() == 1)
<a name="l00508"></a>00508                 volumeRegion = <a class="code" href="structRenderOptions.html#35086e28667947f41eb7f2a5c3ef7e34">volumeRegions</a>[0];
<a name="l00509"></a>00509         <span class="keywordflow">else</span>
<a name="l00510"></a>00510                 volumeRegion = <span class="keyword">new</span> <a class="code" href="classAggregateVolume.html">AggregateVolume</a>(<a class="code" href="structRenderOptions.html#35086e28667947f41eb7f2a5c3ef7e34">volumeRegions</a>);
<a name="l00511"></a>00511         <span class="comment">// Make sure all plugins initialized properly</span>
<a name="l00512"></a>00512         <span class="keywordflow">if</span> (!camera || !sampler || !film || !accelerator ||
<a name="l00513"></a>00513                 !filter || !surfaceIntegrator || !volumeIntegrator) {
<a name="l00514"></a>00514                 <a class="code" href="pbrt_8h.html#63fd51330b3b9d2663a08258601448e5">Severe</a>(<span class="stringliteral">"Unable to create scene due "</span>
<a name="l00515"></a>00515                        <span class="stringliteral">"to missing plug-ins"</span>);
<a name="l00516"></a>00516                 <span class="keywordflow">return</span> NULL;
<a name="l00517"></a>00517         }
<a name="l00518"></a>00518         <a class="code" href="classScene.html">Scene</a> *ret = <span class="keyword">new</span> <a class="code" href="classScene.html">Scene</a>(camera,
<a name="l00519"></a>00519             surfaceIntegrator, volumeIntegrator,
<a name="l00520"></a>00520                 sampler, accelerator, <a class="code" href="structRenderOptions.html#20d3a070ca4db89e8217b26b063d3f8c">lights</a>, volumeRegion);
<a name="l00521"></a>00521         <span class="comment">// Erase primitives, lights, and volume regions from _RenderOptions_</span>
<a name="l00522"></a>00522         <a class="code" href="structRenderOptions.html#2e0ee53c051e1df5a1c70e4f69784d57">primitives</a>.erase(<a class="code" href="structRenderOptions.html#2e0ee53c051e1df5a1c70e4f69784d57">primitives</a>.begin(),
<a name="l00523"></a>00523                         <a class="code" href="structRenderOptions.html#2e0ee53c051e1df5a1c70e4f69784d57">primitives</a>.end());
<a name="l00524"></a>00524         <a class="code" href="structRenderOptions.html#20d3a070ca4db89e8217b26b063d3f8c">lights</a>.erase(<a class="code" href="structRenderOptions.html#20d3a070ca4db89e8217b26b063d3f8c">lights</a>.begin(),
<a name="l00525"></a>00525                     <a class="code" href="structRenderOptions.html#20d3a070ca4db89e8217b26b063d3f8c">lights</a>.end());
<a name="l00526"></a>00526         <a class="code" href="structRenderOptions.html#35086e28667947f41eb7f2a5c3ef7e34">volumeRegions</a>.erase(<a class="code" href="structRenderOptions.html#35086e28667947f41eb7f2a5c3ef7e34">volumeRegions</a>.begin(),
<a name="l00527"></a>00527                           <a class="code" href="structRenderOptions.html#35086e28667947f41eb7f2a5c3ef7e34">volumeRegions</a>.end());
<a name="l00528"></a>00528         <span class="keywordflow">return</span> ret;
<a name="l00529"></a>00529 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Jul 20 17:31:52 2009 for pbrt by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
