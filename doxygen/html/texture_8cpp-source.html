<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>pbrt: texture.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>texture.cpp</h1><a href="texture_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment">    pbrt source code Copyright(c) 1998-2007 Matt Pharr and Greg Humphreys.</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">    This file is part of pbrt.</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">    pbrt is free software; you can redistribute it and/or modify</span>
<a name="l00008"></a>00008 <span class="comment">    it under the terms of the GNU General Public License as published by</span>
<a name="l00009"></a>00009 <span class="comment">    the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00010"></a>00010 <span class="comment">    (at your option) any later version.  Note that the text contents of</span>
<a name="l00011"></a>00011 <span class="comment">    the book "Physically Based Rendering" are *not* licensed under the</span>
<a name="l00012"></a>00012 <span class="comment">    GNU GPL.</span>
<a name="l00013"></a>00013 <span class="comment"></span>
<a name="l00014"></a>00014 <span class="comment">    pbrt is distributed in the hope that it will be useful,</span>
<a name="l00015"></a>00015 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00017"></a>00017 <span class="comment">    GNU General Public License for more details.</span>
<a name="l00018"></a>00018 <span class="comment"></span>
<a name="l00019"></a>00019 <span class="comment">    You should have received a copy of the GNU General Public License</span>
<a name="l00020"></a>00020 <span class="comment">    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00021"></a>00021 <span class="comment"></span>
<a name="l00022"></a>00022 <span class="comment"> */</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="comment">// texture.cpp*</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include "<a class="code" href="texture_8h.html">texture.h</a>"</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="shape_8h.html">shape.h</a>"</span>
<a name="l00027"></a>00027 <span class="comment">// Texture Forward Declarations</span>
<a name="l00028"></a>00028 <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="texture_8cpp.html#ff527fea996399744c73d9b725ab2b18">Grad</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> z, <span class="keywordtype">float</span> dx, <span class="keywordtype">float</span> dy, <span class="keywordtype">float</span> dz);
<a name="l00029"></a>00029 <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="texture_8cpp.html#e19d140d9bb1c1aeee1b53930ea92c47">NoiseWeight</a>(<span class="keywordtype">float</span> t);
<a name="l00030"></a>00030 <span class="comment">// Perlin Noise Data</span>
<a name="l00031"></a><a class="code" href="texture_8cpp.html#73c24ec2895ffcf60c8be74591d2b84b">00031</a> <span class="preprocessor">#define NOISE_PERM_SIZE 256</span>
<a name="l00032"></a><a class="code" href="texture_8cpp.html#1629bb8689a10baf6fa717863ff66ab1">00032</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="texture_8cpp.html#1629bb8689a10baf6fa717863ff66ab1">NoisePerm</a>[2 * <a class="code" href="texture_8cpp.html#73c24ec2895ffcf60c8be74591d2b84b">NOISE_PERM_SIZE</a>] = {
<a name="l00033"></a>00033         151, 160, 137, 91, 90, 15, 131, 13, 201, 95, 96,
<a name="l00034"></a>00034         53, 194, 233, 7, 225, 140, 36, 103, 30, 69, 142,
<a name="l00035"></a>00035         <span class="comment">// Rest of noise permutation table</span>
<a name="l00036"></a>00036         8, 99, 37, 240, 21, 10, 23,
<a name="l00037"></a>00037            190,  6, 148, 247, 120, 234, 75, 0, 26, 197, 62, 94, 252, 219, 203, 117, 35, 11, 32, 57, 177, 33,
<a name="l00038"></a>00038            88, 237, 149, 56, 87, 174, 20, 125, 136, 171, 168,  68, 175, 74, 165, 71, 134, 139, 48, 27, 166,
<a name="l00039"></a>00039            77, 146, 158, 231, 83, 111, 229, 122, 60, 211, 133, 230, 220, 105, 92, 41, 55, 46, 245, 40, 244,
<a name="l00040"></a>00040            102, 143, 54,  65, 25, 63, 161,  1, 216, 80, 73, 209, 76, 132, 187, 208,  89, 18, 169, 200, 196,
<a name="l00041"></a>00041            135, 130, 116, 188, 159, 86, 164, 100, 109, 198, 173, 186,  3, 64, 52, 217, 226, 250, 124, 123,
<a name="l00042"></a>00042            5, 202, 38, 147, 118, 126, 255, 82, 85, 212, 207, 206, 59, 227, 47, 16, 58, 17, 182, 189, 28, 42,
<a name="l00043"></a>00043            223, 183, 170, 213, 119, 248, 152,  2, 44, 154, 163,  70, 221, 153, 101, 155, 167,  43, 172, 9,
<a name="l00044"></a>00044            129, 22, 39, 253,  19, 98, 108, 110, 79, 113, 224, 232, 178, 185,  112, 104, 218, 246, 97, 228,
<a name="l00045"></a>00045            251, 34, 242, 193, 238, 210, 144, 12, 191, 179, 162, 241,  81, 51, 145, 235, 249, 14, 239, 107,
<a name="l00046"></a>00046            49, 192, 214,  31, 181, 199, 106, 157, 184,  84, 204, 176, 115, 121, 50, 45, 127,  4, 150, 254,
<a name="l00047"></a>00047            138, 236, 205, 93, 222, 114, 67, 29, 24, 72, 243, 141, 128, 195, 78, 66, 215, 61, 156, 180,
<a name="l00048"></a>00048            151, 160, 137, 91, 90, 15,
<a name="l00049"></a>00049            131, 13, 201, 95, 96, 53, 194, 233, 7, 225, 140, 36, 103, 30, 69, 142, 8, 99, 37, 240, 21, 10, 23,
<a name="l00050"></a>00050            190,  6, 148, 247, 120, 234, 75, 0, 26, 197, 62, 94, 252, 219, 203, 117, 35, 11, 32, 57, 177, 33,
<a name="l00051"></a>00051            88, 237, 149, 56, 87, 174, 20, 125, 136, 171, 168,  68, 175, 74, 165, 71, 134, 139, 48, 27, 166,
<a name="l00052"></a>00052            77, 146, 158, 231, 83, 111, 229, 122, 60, 211, 133, 230, 220, 105, 92, 41, 55, 46, 245, 40, 244,
<a name="l00053"></a>00053            102, 143, 54,  65, 25, 63, 161,  1, 216, 80, 73, 209, 76, 132, 187, 208,  89, 18, 169, 200, 196,
<a name="l00054"></a>00054            135, 130, 116, 188, 159, 86, 164, 100, 109, 198, 173, 186,  3, 64, 52, 217, 226, 250, 124, 123,
<a name="l00055"></a>00055            5, 202, 38, 147, 118, 126, 255, 82, 85, 212, 207, 206, 59, 227, 47, 16, 58, 17, 182, 189, 28, 42,
<a name="l00056"></a>00056            223, 183, 170, 213, 119, 248, 152,  2, 44, 154, 163,  70, 221, 153, 101, 155, 167,  43, 172, 9,
<a name="l00057"></a>00057            129, 22, 39, 253,  19, 98, 108, 110, 79, 113, 224, 232, 178, 185,  112, 104, 218, 246, 97, 228,
<a name="l00058"></a>00058            251, 34, 242, 193, 238, 210, 144, 12, 191, 179, 162, 241,  81, 51, 145, 235, 249, 14, 239, 107,
<a name="l00059"></a>00059            49, 192, 214,  31, 181, 199, 106, 157, 184,  84, 204, 176, 115, 121, 50, 45, 127,  4, 150, 254,
<a name="l00060"></a>00060            138, 236, 205, 93, 222, 114, 67, 29, 24, 72, 243, 141, 128, 195, 78, 66, 215, 61, 156, 180
<a name="l00061"></a>00061 };
<a name="l00062"></a>00062 <span class="comment">// Texture Method Definitions</span>
<a name="l00063"></a><a class="code" href="classUVMapping2D.html#476b2b4b957e94ef3b2f5694d94bed86">00063</a> <a class="code" href="classUVMapping2D.html#476b2b4b957e94ef3b2f5694d94bed86">UVMapping2D::UVMapping2D</a>(<span class="keywordtype">float</span> _su, <span class="keywordtype">float</span> _sv,
<a name="l00064"></a>00064                 <span class="keywordtype">float</span> _du, <span class="keywordtype">float</span> _dv) {
<a name="l00065"></a>00065         <a class="code" href="classUVMapping2D.html#557114c91408fbf014c71f2527ed5e87">su</a> = _su; <a class="code" href="classUVMapping2D.html#5f8e52e9f398c39e730118ac203acd48">sv</a> = _sv;
<a name="l00066"></a>00066         <a class="code" href="classUVMapping2D.html#8aa93b3c5f134984c91e557ded6c1183">du</a> = _du; <a class="code" href="classUVMapping2D.html#291320c8fbf8fa6fc2999ffaa9cbf8a4">dv</a> = _dv;
<a name="l00067"></a>00067 }
<a name="l00068"></a><a class="code" href="classUVMapping2D.html#00bb5a465b07a075e6fbb926b813f163">00068</a> <span class="keywordtype">void</span> <a class="code" href="classUVMapping2D.html#00bb5a465b07a075e6fbb926b813f163">UVMapping2D::Map</a>(<span class="keyword">const</span> <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> &amp;dg,
<a name="l00069"></a>00069                 <span class="keywordtype">float</span> *s, <span class="keywordtype">float</span> *t, <span class="keywordtype">float</span> *dsdx, <span class="keywordtype">float</span> *dtdx,
<a name="l00070"></a>00070                 <span class="keywordtype">float</span> *dsdy, <span class="keywordtype">float</span> *dtdy)<span class="keyword"> const </span>{
<a name="l00071"></a>00071         *s = <a class="code" href="classUVMapping2D.html#557114c91408fbf014c71f2527ed5e87">su</a> * dg.<a class="code" href="structDifferentialGeometry.html#25fb75c2f13a530489cd1776171d3736">u</a> + <a class="code" href="classUVMapping2D.html#8aa93b3c5f134984c91e557ded6c1183">du</a>;
<a name="l00072"></a>00072         *t = <a class="code" href="classUVMapping2D.html#5f8e52e9f398c39e730118ac203acd48">sv</a> * dg.<a class="code" href="structDifferentialGeometry.html#ad45a8e22d41f9c7116211c3f2372550">v</a> + <a class="code" href="classUVMapping2D.html#291320c8fbf8fa6fc2999ffaa9cbf8a4">dv</a>;
<a name="l00073"></a>00073         <span class="comment">// Compute texture differentials for 2D identity mapping</span>
<a name="l00074"></a>00074         *dsdx = <a class="code" href="classUVMapping2D.html#557114c91408fbf014c71f2527ed5e87">su</a> * dg.<a class="code" href="structDifferentialGeometry.html#ee263cfa99de799c049e33b552ff0b82">dudx</a>;
<a name="l00075"></a>00075         *dtdx = <a class="code" href="classUVMapping2D.html#5f8e52e9f398c39e730118ac203acd48">sv</a> * dg.<a class="code" href="structDifferentialGeometry.html#f0d770bd2370babb99b4eda972a757e2">dvdx</a>;
<a name="l00076"></a>00076         *dsdy = <a class="code" href="classUVMapping2D.html#557114c91408fbf014c71f2527ed5e87">su</a> * dg.<a class="code" href="structDifferentialGeometry.html#57f8e45c2aa405802f25f1921ba27edd">dudy</a>;
<a name="l00077"></a>00077         *dtdy = <a class="code" href="classUVMapping2D.html#5f8e52e9f398c39e730118ac203acd48">sv</a> * dg.<a class="code" href="structDifferentialGeometry.html#7343b4a399c5001c92fad44696060142">dvdy</a>;
<a name="l00078"></a>00078 }
<a name="l00079"></a><a class="code" href="classSphericalMapping2D.html#a46a607d1dedc377d23e8895529eb5fd">00079</a> <span class="keywordtype">void</span> <a class="code" href="classSphericalMapping2D.html#a46a607d1dedc377d23e8895529eb5fd">SphericalMapping2D::Map</a>(<span class="keyword">const</span> <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> &amp;dg,
<a name="l00080"></a>00080                 <span class="keywordtype">float</span> *s, <span class="keywordtype">float</span> *t, <span class="keywordtype">float</span> *dsdx, <span class="keywordtype">float</span> *dtdx,
<a name="l00081"></a>00081                 <span class="keywordtype">float</span> *dsdy, <span class="keywordtype">float</span> *dtdy)<span class="keyword"> const </span>{
<a name="l00082"></a>00082         <a class="code" href="classSphericalMapping2D.html#e641dda147c86178bb0f961690eac452">sphere</a>(dg.<a class="code" href="structDifferentialGeometry.html#3d5353db1c1a6a93ef6da642d064f46e">p</a>, s, t);
<a name="l00083"></a>00083         <span class="comment">// Compute texture coordinate differentials for sphere $(u,v)$ mapping</span>
<a name="l00084"></a>00084         <span class="keywordtype">float</span> sx, tx, sy, ty;
<a name="l00085"></a>00085         <span class="keyword">const</span> <span class="keywordtype">float</span> delta = .1f;
<a name="l00086"></a>00086         <a class="code" href="classSphericalMapping2D.html#e641dda147c86178bb0f961690eac452">sphere</a>(dg.<a class="code" href="structDifferentialGeometry.html#3d5353db1c1a6a93ef6da642d064f46e">p</a> + delta * dg.<a class="code" href="structDifferentialGeometry.html#307387af96b1b7a98358ea448114d697">dpdx</a>, &amp;sx, &amp;tx);
<a name="l00087"></a>00087         *dsdx = (sx - *s) / delta;
<a name="l00088"></a>00088         *dtdx = (tx - *t) / delta;
<a name="l00089"></a>00089         <span class="keywordflow">if</span> (*dtdx &gt; .5) *dtdx = 1.f - *dtdx;
<a name="l00090"></a>00090         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*dtdx &lt; -.5f) *dtdx = -(*dtdx + 1);
<a name="l00091"></a>00091         <a class="code" href="classSphericalMapping2D.html#e641dda147c86178bb0f961690eac452">sphere</a>(dg.<a class="code" href="structDifferentialGeometry.html#3d5353db1c1a6a93ef6da642d064f46e">p</a> + delta * dg.<a class="code" href="structDifferentialGeometry.html#d3e6794a920835d56713b3659437fc00">dpdy</a>, &amp;sy, &amp;ty);
<a name="l00092"></a>00092         *dsdy = (sy - *s) / delta;
<a name="l00093"></a>00093         *dtdy = (ty - *t) / delta;
<a name="l00094"></a>00094         <span class="keywordflow">if</span> (*dtdy &gt; .5) *dtdy = 1.f - *dtdy;
<a name="l00095"></a>00095         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*dtdy &lt; -.5f) *dtdy = -(*dtdy + 1);
<a name="l00096"></a>00096 }
<a name="l00097"></a><a class="code" href="classSphericalMapping2D.html#e641dda147c86178bb0f961690eac452">00097</a> <span class="keywordtype">void</span> <a class="code" href="classSphericalMapping2D.html#e641dda147c86178bb0f961690eac452">SphericalMapping2D::sphere</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a> &amp;p, <span class="keywordtype">float</span> *s,
<a name="l00098"></a>00098                 <span class="keywordtype">float</span> *t)<span class="keyword"> const </span>{
<a name="l00099"></a>00099         <a class="code" href="classVector.html">Vector</a> vec =
<a name="l00100"></a>00100                 <a class="code" href="geometry_8h.html#46448bfa3df1c2de5e3b763f163866a4">Normalize</a>(<a class="code" href="classSphericalMapping2D.html#d2b5782ebcd309284baa18bdb24500fd">WorldToTexture</a>(p) - <a class="code" href="classPoint.html">Point</a>(0,0,0));
<a name="l00101"></a>00101         <span class="keywordtype">float</span> theta = <a class="code" href="geometry_8h.html#f7d36bef020e06d4c8da4dde7d14264e">SphericalTheta</a>(vec);
<a name="l00102"></a>00102         <span class="keywordtype">float</span> phi = <a class="code" href="geometry_8h.html#c4ad8b957b2a7f90df704d7e6a635a3c">SphericalPhi</a>(vec);
<a name="l00103"></a>00103         *s = theta * <a class="code" href="pbrt_8h.html#ebad45bfa06a5d66805c5813fbc59f4b">INV_PI</a>;
<a name="l00104"></a>00104         *t = phi * <a class="code" href="pbrt_8h.html#42177ad937b6de334f376c039189e067">INV_TWOPI</a>;
<a name="l00105"></a>00105 }
<a name="l00106"></a>00106 <span class="keywordtype">void</span>
<a name="l00107"></a><a class="code" href="classCylindricalMapping2D.html#fc2736d1db97018700c6501d1dee68b2">00107</a> <a class="code" href="classCylindricalMapping2D.html#fc2736d1db97018700c6501d1dee68b2">CylindricalMapping2D::Map</a>(<span class="keyword">const</span> <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> &amp;dg,
<a name="l00108"></a>00108                 <span class="keywordtype">float</span> *s, <span class="keywordtype">float</span> *t, <span class="keywordtype">float</span> *dsdx, <span class="keywordtype">float</span> *dtdx,
<a name="l00109"></a>00109                 <span class="keywordtype">float</span> *dsdy, <span class="keywordtype">float</span> *dtdy)<span class="keyword"> const </span>{
<a name="l00110"></a>00110         <a class="code" href="classCylindricalMapping2D.html#0f6d8284ed22adf83a5f10fb1d5c356e">cylinder</a>(dg.<a class="code" href="structDifferentialGeometry.html#3d5353db1c1a6a93ef6da642d064f46e">p</a>, s, t);
<a name="l00111"></a>00111         <span class="comment">// Compute texture coordinate differentials for cylinder $(u,v)$ mapping</span>
<a name="l00112"></a>00112         <span class="keywordtype">float</span> sx, tx, sy, ty;
<a name="l00113"></a>00113         <span class="keyword">const</span> <span class="keywordtype">float</span> delta = .01f;
<a name="l00114"></a>00114         <a class="code" href="classCylindricalMapping2D.html#0f6d8284ed22adf83a5f10fb1d5c356e">cylinder</a>(dg.<a class="code" href="structDifferentialGeometry.html#3d5353db1c1a6a93ef6da642d064f46e">p</a> + delta * dg.<a class="code" href="structDifferentialGeometry.html#307387af96b1b7a98358ea448114d697">dpdx</a>, &amp;sx, &amp;tx);
<a name="l00115"></a>00115         *dsdx = (sx - *s) / delta;
<a name="l00116"></a>00116         *dtdx = (tx - *t) / delta;
<a name="l00117"></a>00117         <span class="keywordflow">if</span> (*dtdx &gt; .5) *dtdx = 1.f - *dtdx;
<a name="l00118"></a>00118         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*dtdx &lt; -.5f) *dtdx = -(*dtdx + 1);
<a name="l00119"></a>00119         <a class="code" href="classCylindricalMapping2D.html#0f6d8284ed22adf83a5f10fb1d5c356e">cylinder</a>(dg.<a class="code" href="structDifferentialGeometry.html#3d5353db1c1a6a93ef6da642d064f46e">p</a> + delta * dg.<a class="code" href="structDifferentialGeometry.html#d3e6794a920835d56713b3659437fc00">dpdy</a>, &amp;sy, &amp;ty);
<a name="l00120"></a>00120         *dsdy = (sy - *s) / delta;
<a name="l00121"></a>00121         *dtdy = (ty - *t) / delta;
<a name="l00122"></a>00122         <span class="keywordflow">if</span> (*dtdy &gt; .5) *dtdy = 1.f - *dtdy;
<a name="l00123"></a>00123         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*dtdy &lt; -.5f) *dtdy = -(*dtdy + 1);
<a name="l00124"></a>00124 }
<a name="l00125"></a><a class="code" href="classCylindricalMapping2D.html#0f6d8284ed22adf83a5f10fb1d5c356e">00125</a> <span class="keywordtype">void</span> <a class="code" href="classCylindricalMapping2D.html#0f6d8284ed22adf83a5f10fb1d5c356e">CylindricalMapping2D::cylinder</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a> &amp;p,
<a name="l00126"></a>00126                 <span class="keywordtype">float</span> *s, <span class="keywordtype">float</span> *t)<span class="keyword"> const </span>{
<a name="l00127"></a>00127         <a class="code" href="classVector.html">Vector</a> vec =
<a name="l00128"></a>00128                 <a class="code" href="geometry_8h.html#46448bfa3df1c2de5e3b763f163866a4">Normalize</a>(<a class="code" href="classCylindricalMapping2D.html#5a6988c208364a3f6263049958fde9f0">WorldToTexture</a>(p) - <a class="code" href="classPoint.html">Point</a>(0,0,0));
<a name="l00129"></a>00129         *s = (<a class="code" href="pbrt_8h.html#e71449b1cc6e6250b91f539153a7a0d3">M_PI</a> + atan2f(vec.<a class="code" href="classVector.html#81be9102fca6d9beea3efef522c4c09d">y</a>, vec.<a class="code" href="classVector.html#ca49165049a1e21ae47afcfc078819ed">x</a>)) / (2.f * <a class="code" href="pbrt_8h.html#e71449b1cc6e6250b91f539153a7a0d3">M_PI</a>);
<a name="l00130"></a>00130         *t = vec.<a class="code" href="classVector.html#0e84237d0830d5c459bfa5676b5fbfba">z</a>;
<a name="l00131"></a>00131 }
<a name="l00132"></a><a class="code" href="classPlanarMapping2D.html#11a82e25a951c3cc5b80cda8d28b67c0">00132</a> <a class="code" href="classPlanarMapping2D.html#11a82e25a951c3cc5b80cda8d28b67c0">PlanarMapping2D::PlanarMapping2D</a>(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;_v1,
<a name="l00133"></a>00133                 <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;_v2, <span class="keywordtype">float</span> _ds, <span class="keywordtype">float</span> _dt) {
<a name="l00134"></a>00134         <a class="code" href="classPlanarMapping2D.html#02b2eaad4f38f2c1ceecf69290c4ed12">vs</a> = _v1;
<a name="l00135"></a>00135         <a class="code" href="classPlanarMapping2D.html#0a8919131a5e20d0bd80d2cbb3a5be4b">vt</a> = _v2;
<a name="l00136"></a>00136         <a class="code" href="classPlanarMapping2D.html#311ec53ab63498e3cc64b532a8a31919">ds</a> = _ds;
<a name="l00137"></a>00137         <a class="code" href="classPlanarMapping2D.html#c4f5d955578c78440a9a266a507e7ba9">dt</a> = _dt;
<a name="l00138"></a>00138 }
<a name="l00139"></a><a class="code" href="classPlanarMapping2D.html#8716d2c7a18f5f5ac7eaef56a53c8d85">00139</a> <span class="keywordtype">void</span> <a class="code" href="classPlanarMapping2D.html#8716d2c7a18f5f5ac7eaef56a53c8d85">PlanarMapping2D::Map</a>(<span class="keyword">const</span> <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> &amp;dg,
<a name="l00140"></a>00140                 <span class="keywordtype">float</span> *s, <span class="keywordtype">float</span> *t, <span class="keywordtype">float</span> *dsdx, <span class="keywordtype">float</span> *dtdx,
<a name="l00141"></a>00141                 <span class="keywordtype">float</span> *dsdy, <span class="keywordtype">float</span> *dtdy)<span class="keyword"> const </span>{
<a name="l00142"></a>00142         <a class="code" href="classVector.html">Vector</a> vec = dg.<a class="code" href="structDifferentialGeometry.html#3d5353db1c1a6a93ef6da642d064f46e">p</a> - <a class="code" href="classPoint.html">Point</a>(0,0,0);
<a name="l00143"></a>00143         *s = <a class="code" href="classPlanarMapping2D.html#311ec53ab63498e3cc64b532a8a31919">ds</a> + <a class="code" href="geometry_8h.html#ad0d36688d190693f70a5c9ef9342914">Dot</a>(vec, <a class="code" href="classPlanarMapping2D.html#02b2eaad4f38f2c1ceecf69290c4ed12">vs</a>);
<a name="l00144"></a>00144         *t = <a class="code" href="classPlanarMapping2D.html#c4f5d955578c78440a9a266a507e7ba9">dt</a> + <a class="code" href="geometry_8h.html#ad0d36688d190693f70a5c9ef9342914">Dot</a>(vec, <a class="code" href="classPlanarMapping2D.html#0a8919131a5e20d0bd80d2cbb3a5be4b">vt</a>);
<a name="l00145"></a>00145         *dsdx = <a class="code" href="geometry_8h.html#ad0d36688d190693f70a5c9ef9342914">Dot</a>(dg.<a class="code" href="structDifferentialGeometry.html#307387af96b1b7a98358ea448114d697">dpdx</a>, <a class="code" href="classPlanarMapping2D.html#02b2eaad4f38f2c1ceecf69290c4ed12">vs</a>);
<a name="l00146"></a>00146         *dtdx = <a class="code" href="geometry_8h.html#ad0d36688d190693f70a5c9ef9342914">Dot</a>(dg.<a class="code" href="structDifferentialGeometry.html#307387af96b1b7a98358ea448114d697">dpdx</a>, <a class="code" href="classPlanarMapping2D.html#0a8919131a5e20d0bd80d2cbb3a5be4b">vt</a>);
<a name="l00147"></a>00147         *dsdy = <a class="code" href="geometry_8h.html#ad0d36688d190693f70a5c9ef9342914">Dot</a>(dg.<a class="code" href="structDifferentialGeometry.html#d3e6794a920835d56713b3659437fc00">dpdy</a>, <a class="code" href="classPlanarMapping2D.html#02b2eaad4f38f2c1ceecf69290c4ed12">vs</a>);
<a name="l00148"></a>00148         *dtdy = <a class="code" href="geometry_8h.html#ad0d36688d190693f70a5c9ef9342914">Dot</a>(dg.<a class="code" href="structDifferentialGeometry.html#d3e6794a920835d56713b3659437fc00">dpdy</a>, <a class="code" href="classPlanarMapping2D.html#0a8919131a5e20d0bd80d2cbb3a5be4b">vt</a>);
<a name="l00149"></a>00149 }
<a name="l00150"></a><a class="code" href="classIdentityMapping3D.html#e39b6eb0d02a00e4016bcaae1bd9fd54">00150</a> <a class="code" href="classPoint.html">Point</a> <a class="code" href="classIdentityMapping3D.html#e39b6eb0d02a00e4016bcaae1bd9fd54">IdentityMapping3D::Map</a>(<span class="keyword">const</span> <a class="code" href="structDifferentialGeometry.html">DifferentialGeometry</a> &amp;dg,
<a name="l00151"></a>00151                 <a class="code" href="classVector.html">Vector</a> *dpdx, <a class="code" href="classVector.html">Vector</a> *dpdy)<span class="keyword"> const </span>{
<a name="l00152"></a>00152         *dpdx = <a class="code" href="classIdentityMapping3D.html#8b3ea7a34da65c1ea913c669c9cbe25c">WorldToTexture</a>(dg.<a class="code" href="structDifferentialGeometry.html#307387af96b1b7a98358ea448114d697">dpdx</a>);
<a name="l00153"></a>00153         *dpdy = <a class="code" href="classIdentityMapping3D.html#8b3ea7a34da65c1ea913c669c9cbe25c">WorldToTexture</a>(dg.<a class="code" href="structDifferentialGeometry.html#d3e6794a920835d56713b3659437fc00">dpdy</a>);
<a name="l00154"></a>00154         <span class="keywordflow">return</span> <a class="code" href="classIdentityMapping3D.html#8b3ea7a34da65c1ea913c669c9cbe25c">WorldToTexture</a>(dg.<a class="code" href="structDifferentialGeometry.html#3d5353db1c1a6a93ef6da642d064f46e">p</a>);
<a name="l00155"></a>00155 }
<a name="l00156"></a><a class="code" href="texture_8cpp.html#ef6673a0a598b7cd4a795f7fd53a64a4">00156</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#0771f1e4704c254202d0ceeb48a7a003">Noise</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">float</span> z) {
<a name="l00157"></a>00157         <span class="comment">// Compute noise cell coordinates and offsets</span>
<a name="l00158"></a>00158         <span class="keywordtype">int</span> ix = <a class="code" href="pbrt_8h.html#02648670ea7bf29f5782902cd9aa87c1">Floor2Int</a>(x);
<a name="l00159"></a>00159         <span class="keywordtype">int</span> iy = <a class="code" href="pbrt_8h.html#02648670ea7bf29f5782902cd9aa87c1">Floor2Int</a>(y);
<a name="l00160"></a>00160         <span class="keywordtype">int</span> iz = <a class="code" href="pbrt_8h.html#02648670ea7bf29f5782902cd9aa87c1">Floor2Int</a>(z);
<a name="l00161"></a>00161         <span class="keywordtype">float</span> dx = x - ix, dy = y - iy, dz = z - iz;
<a name="l00162"></a>00162         <span class="comment">// Compute gradient weights</span>
<a name="l00163"></a>00163         ix &amp;= (<a class="code" href="texture_8cpp.html#73c24ec2895ffcf60c8be74591d2b84b">NOISE_PERM_SIZE</a>-1);
<a name="l00164"></a>00164         iy &amp;= (<a class="code" href="texture_8cpp.html#73c24ec2895ffcf60c8be74591d2b84b">NOISE_PERM_SIZE</a>-1);
<a name="l00165"></a>00165         iz &amp;= (<a class="code" href="texture_8cpp.html#73c24ec2895ffcf60c8be74591d2b84b">NOISE_PERM_SIZE</a>-1);
<a name="l00166"></a>00166         <span class="keywordtype">float</span> w000 = <a class="code" href="texture_8cpp.html#ff527fea996399744c73d9b725ab2b18">Grad</a>(ix,   iy,   iz,   dx,   dy,   dz);
<a name="l00167"></a>00167         <span class="keywordtype">float</span> w100 = <a class="code" href="texture_8cpp.html#ff527fea996399744c73d9b725ab2b18">Grad</a>(ix+1, iy,   iz,   dx-1, dy,   dz);
<a name="l00168"></a>00168         <span class="keywordtype">float</span> w010 = <a class="code" href="texture_8cpp.html#ff527fea996399744c73d9b725ab2b18">Grad</a>(ix,   iy+1, iz,   dx,   dy-1, dz);
<a name="l00169"></a>00169         <span class="keywordtype">float</span> w110 = <a class="code" href="texture_8cpp.html#ff527fea996399744c73d9b725ab2b18">Grad</a>(ix+1, iy+1, iz,   dx-1, dy-1, dz);
<a name="l00170"></a>00170         <span class="keywordtype">float</span> w001 = <a class="code" href="texture_8cpp.html#ff527fea996399744c73d9b725ab2b18">Grad</a>(ix,   iy,   iz+1, dx,   dy,   dz-1);
<a name="l00171"></a>00171         <span class="keywordtype">float</span> w101 = <a class="code" href="texture_8cpp.html#ff527fea996399744c73d9b725ab2b18">Grad</a>(ix+1, iy,   iz+1, dx-1, dy,   dz-1);
<a name="l00172"></a>00172         <span class="keywordtype">float</span> w011 = <a class="code" href="texture_8cpp.html#ff527fea996399744c73d9b725ab2b18">Grad</a>(ix,   iy+1, iz+1, dx,   dy-1, dz-1);
<a name="l00173"></a>00173         <span class="keywordtype">float</span> w111 = <a class="code" href="texture_8cpp.html#ff527fea996399744c73d9b725ab2b18">Grad</a>(ix+1, iy+1, iz+1, dx-1, dy-1, dz-1);
<a name="l00174"></a>00174         <span class="comment">// Compute trilinear interpolation of weights</span>
<a name="l00175"></a>00175         <span class="keywordtype">float</span> wx = <a class="code" href="texture_8cpp.html#e19d140d9bb1c1aeee1b53930ea92c47">NoiseWeight</a>(dx);
<a name="l00176"></a>00176         <span class="keywordtype">float</span> wy = <a class="code" href="texture_8cpp.html#e19d140d9bb1c1aeee1b53930ea92c47">NoiseWeight</a>(dy);
<a name="l00177"></a>00177         <span class="keywordtype">float</span> wz = <a class="code" href="texture_8cpp.html#e19d140d9bb1c1aeee1b53930ea92c47">NoiseWeight</a>(dz);
<a name="l00178"></a>00178         <span class="keywordtype">float</span> x00 = <a class="code" href="pbrt_8h.html#0934d1ba879ec4edf23b9c3bc4e52b35">Lerp</a>(wx, w000, w100);
<a name="l00179"></a>00179         <span class="keywordtype">float</span> x10 = <a class="code" href="pbrt_8h.html#0934d1ba879ec4edf23b9c3bc4e52b35">Lerp</a>(wx, w010, w110);
<a name="l00180"></a>00180         <span class="keywordtype">float</span> x01 = <a class="code" href="pbrt_8h.html#0934d1ba879ec4edf23b9c3bc4e52b35">Lerp</a>(wx, w001, w101);
<a name="l00181"></a>00181         <span class="keywordtype">float</span> x11 = <a class="code" href="pbrt_8h.html#0934d1ba879ec4edf23b9c3bc4e52b35">Lerp</a>(wx, w011, w111);
<a name="l00182"></a>00182         <span class="keywordtype">float</span> y0 = <a class="code" href="pbrt_8h.html#0934d1ba879ec4edf23b9c3bc4e52b35">Lerp</a>(wy, x00, x10);
<a name="l00183"></a>00183         <span class="keywordtype">float</span> y1 = <a class="code" href="pbrt_8h.html#0934d1ba879ec4edf23b9c3bc4e52b35">Lerp</a>(wy, x01, x11);
<a name="l00184"></a>00184         <span class="keywordflow">return</span> <a class="code" href="pbrt_8h.html#0934d1ba879ec4edf23b9c3bc4e52b35">Lerp</a>(wz, y0, y1);
<a name="l00185"></a>00185 }
<a name="l00186"></a><a class="code" href="texture_8cpp.html#48864166089b6538961eb341fb439c50">00186</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#0771f1e4704c254202d0ceeb48a7a003">Noise</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a> &amp;P) {
<a name="l00187"></a>00187         <span class="keywordflow">return</span> <a class="code" href="pbrt_8h.html#0771f1e4704c254202d0ceeb48a7a003">Noise</a>(P.<a class="code" href="classPoint.html#05dfe2dfbde813ad234b514f30e662f1">x</a>, P.<a class="code" href="classPoint.html#6101960c8d2d4e8ea1d32c9234bbeb8d">y</a>, P.<a class="code" href="classPoint.html#9a666531e0e99adff132be93d2407d0c">z</a>);
<a name="l00188"></a>00188 }
<a name="l00189"></a><a class="code" href="texture_8cpp.html#ff527fea996399744c73d9b725ab2b18">00189</a> <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="texture_8cpp.html#ff527fea996399744c73d9b725ab2b18">Grad</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> z, <span class="keywordtype">float</span> dx,
<a name="l00190"></a>00190                 <span class="keywordtype">float</span> dy, <span class="keywordtype">float</span> dz) {
<a name="l00191"></a>00191         <span class="keywordtype">int</span> h = <a class="code" href="texture_8cpp.html#1629bb8689a10baf6fa717863ff66ab1">NoisePerm</a>[<a class="code" href="texture_8cpp.html#1629bb8689a10baf6fa717863ff66ab1">NoisePerm</a>[<a class="code" href="texture_8cpp.html#1629bb8689a10baf6fa717863ff66ab1">NoisePerm</a>[x]+y]+z];
<a name="l00192"></a>00192         h &amp;= 15;
<a name="l00193"></a>00193         <span class="keywordtype">float</span> u = h&lt;8 || h==12 || h==13 ? dx : dy;
<a name="l00194"></a>00194         <span class="keywordtype">float</span> v = h&lt;4 || h==12 || h==13 ? dy : dz;
<a name="l00195"></a>00195         <span class="keywordflow">return</span> ((h&amp;1) ? -u : u) + ((h&amp;2) ? -v : v);
<a name="l00196"></a>00196 }
<a name="l00197"></a><a class="code" href="texture_8cpp.html#e19d140d9bb1c1aeee1b53930ea92c47">00197</a> <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="texture_8cpp.html#e19d140d9bb1c1aeee1b53930ea92c47">NoiseWeight</a>(<span class="keywordtype">float</span> t) {
<a name="l00198"></a>00198         <span class="keywordtype">float</span> t3 = t*t*t;
<a name="l00199"></a>00199         <span class="keywordtype">float</span> t4 = t3*t;
<a name="l00200"></a>00200         <span class="keywordflow">return</span> 6.f*t4*t - 15.f*t4 + 10.f*t3;
<a name="l00201"></a>00201 }
<a name="l00202"></a><a class="code" href="texture_8cpp.html#b5abc017d136687f0f3cc64253596743">00202</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#0f06337c23a253f6f36dac935151a9d8">FBm</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a> &amp;P, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;dpdx,
<a name="l00203"></a>00203                 <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;dpdy, <span class="keywordtype">float</span> omega, <span class="keywordtype">int</span> maxOctaves) {
<a name="l00204"></a>00204         <span class="comment">// Compute number of octaves for anti-aliased FBm</span>
<a name="l00205"></a>00205         <span class="keywordtype">float</span> s2 = max(dpdx.<a class="code" href="classVector.html#ec3bb73ea534625c3ac821648a4b5c70">LengthSquared</a>(), dpdy.<a class="code" href="classVector.html#ec3bb73ea534625c3ac821648a4b5c70">LengthSquared</a>());
<a name="l00206"></a>00206         <span class="keywordtype">float</span> foctaves = min((<span class="keywordtype">float</span>)maxOctaves,
<a name="l00207"></a>00207                              1.f - .5f * <a class="code" href="pbrt_8h.html#30ecb93f0acfedc03c64d08cc7e44f23">Log2</a>(s2));
<a name="l00208"></a>00208         <span class="keywordtype">int</span> octaves = <a class="code" href="pbrt_8h.html#02648670ea7bf29f5782902cd9aa87c1">Floor2Int</a>(foctaves);
<a name="l00209"></a>00209         <span class="comment">// Compute sum of octaves of noise for FBm</span>
<a name="l00210"></a>00210         <span class="keywordtype">float</span> sum = 0., lambda = 1., o = 1.;
<a name="l00211"></a>00211         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; octaves; ++i) {
<a name="l00212"></a>00212                 sum += o * <a class="code" href="pbrt_8h.html#0771f1e4704c254202d0ceeb48a7a003">Noise</a>(lambda * P);
<a name="l00213"></a>00213                 lambda *= 1.99f;
<a name="l00214"></a>00214                 o *= omega;
<a name="l00215"></a>00215         }
<a name="l00216"></a>00216         <span class="keywordtype">float</span> partialOctave = foctaves - octaves;
<a name="l00217"></a>00217         sum += o * <a class="code" href="pbrt_8h.html#332172a54ac2930e10f7a5c446cb712d">SmoothStep</a>(.3f, .7f, partialOctave) *
<a name="l00218"></a>00218                <a class="code" href="pbrt_8h.html#0771f1e4704c254202d0ceeb48a7a003">Noise</a>(lambda * P);
<a name="l00219"></a>00219         <span class="keywordflow">return</span> sum;
<a name="l00220"></a>00220 }
<a name="l00221"></a><a class="code" href="texture_8cpp.html#11858115343a504eff32a804eea94fc7">00221</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#93b43e3085d81cd42b8f75634244c929">Turbulence</a>(<span class="keyword">const</span> <a class="code" href="classPoint.html">Point</a> &amp;P, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;dpdx,
<a name="l00222"></a>00222                 <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a> &amp;dpdy, <span class="keywordtype">float</span> omega, <span class="keywordtype">int</span> maxOctaves) {
<a name="l00223"></a>00223         <span class="comment">// Compute number of octaves for anti-aliased FBm</span>
<a name="l00224"></a>00224         <span class="keywordtype">float</span> s2 = max(dpdx.<a class="code" href="classVector.html#ec3bb73ea534625c3ac821648a4b5c70">LengthSquared</a>(), dpdy.<a class="code" href="classVector.html#ec3bb73ea534625c3ac821648a4b5c70">LengthSquared</a>());
<a name="l00225"></a>00225         <span class="keywordtype">float</span> foctaves = min((<span class="keywordtype">float</span>)maxOctaves,
<a name="l00226"></a>00226                              1.f - .5f * <a class="code" href="pbrt_8h.html#30ecb93f0acfedc03c64d08cc7e44f23">Log2</a>(s2));
<a name="l00227"></a>00227         <span class="keywordtype">int</span> octaves = <a class="code" href="pbrt_8h.html#02648670ea7bf29f5782902cd9aa87c1">Floor2Int</a>(foctaves);
<a name="l00228"></a>00228         <span class="comment">// Compute sum of octaves of noise for turbulence</span>
<a name="l00229"></a>00229         <span class="keywordtype">float</span> sum = 0., lambda = 1., o = 1.;
<a name="l00230"></a>00230         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; octaves; ++i) {
<a name="l00231"></a>00231                 sum += o * fabsf(<a class="code" href="pbrt_8h.html#0771f1e4704c254202d0ceeb48a7a003">Noise</a>(lambda * P));
<a name="l00232"></a>00232                 lambda *= 1.99f;
<a name="l00233"></a>00233                 o *= omega;
<a name="l00234"></a>00234         }
<a name="l00235"></a>00235         <span class="keywordtype">float</span> partialOctave = foctaves - octaves;
<a name="l00236"></a>00236         sum += o * <a class="code" href="pbrt_8h.html#332172a54ac2930e10f7a5c446cb712d">SmoothStep</a>(.3f, .7f, partialOctave) *
<a name="l00237"></a>00237                fabsf(<a class="code" href="pbrt_8h.html#0771f1e4704c254202d0ceeb48a7a003">Noise</a>(lambda * P));
<a name="l00238"></a>00238         <span class="keywordflow">return</span> sum;
<a name="l00239"></a>00239 }
<a name="l00240"></a>00240 <span class="comment">// Texture Function Definitions</span>
<a name="l00241"></a><a class="code" href="texture_8cpp.html#3ff4b3791ee4987f7aca1b66c5d352a7">00241</a> <a class="code" href="pbrt_8h.html#1ca894daa11d476d9e76947dceaf0255">COREDLL</a> <span class="keywordtype">float</span> <a class="code" href="pbrt_8h.html#b1831c563572bacc96729314872ae245">Lanczos</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> tau) {
<a name="l00242"></a>00242         x = fabsf(x);
<a name="l00243"></a>00243         <span class="keywordflow">if</span> (x &lt; 1e-5) <span class="keywordflow">return</span> 1;
<a name="l00244"></a>00244         <span class="keywordflow">if</span> (x &gt; 1.)    <span class="keywordflow">return</span> 0;
<a name="l00245"></a>00245         x *= <a class="code" href="pbrt_8h.html#e71449b1cc6e6250b91f539153a7a0d3">M_PI</a>;
<a name="l00246"></a>00246         <span class="keywordtype">float</span> s = sinf(x * tau) / (x * tau);
<a name="l00247"></a>00247         <span class="keywordtype">float</span> lanczos = sinf(x) / x;
<a name="l00248"></a>00248         <span class="keywordflow">return</span> s * lanczos;
<a name="l00249"></a>00249 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Jul 20 17:31:53 2009 for pbrt by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
